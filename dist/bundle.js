/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var e={};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++r)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const s=e[t],i=t+1<e.length,o=i?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,u=s>>2,h=(3&s)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(e,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(e):this.encodeByteArray(t(e),n)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const s=e[n++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=e[n++];t[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(i>>10)),t[r++]=String.fromCharCode(56320+(1023&i))}else{const i=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==o||null==a||null==c)throw new r;const u=i<<2|o>>4;if(s.push(u),64!==a){const e=o<<4&240|a>>2;if(s.push(e),64!==c){const e=a<<6&192|c;s.push(e)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const s=function(e){return function(e){const r=t(e);return n.encodeByteArray(r,!0)}(e).replace(/\./g,"")},i=function(e){try{return n.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},o=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e.g)return e.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&i(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},a=e=>{var t,n;return null===(n=null===(t=o())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},c=e=>{const t=a(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},u=()=>{var e;return null===(e=o())||void 0===e?void 0:e.config},h=e=>{var t;return null===(t=o())||void 0===t?void 0:t[`_${e}`]};class l{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function d(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[s(JSON.stringify({alg:"none",type:"JWT"})),s(JSON.stringify(o)),""].join(".")}function f(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function p(){try{return"object"==typeof indexedDB}catch(e){return!1}}class g extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,m.prototype.create)}}class m{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],i=s?function(e,t){return e.replace(y,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new g(r,o,n)}}const y=/\{\$([^}]+)}/g;function v(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const s of n){if(!r.includes(s))return!1;const n=e[s],i=t[s];if(w(n)&&w(i)){if(!v(n,i))return!1}else if(n!==i)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function w(e){return null!==e&&"object"==typeof e}function _(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function E(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}})),t}function b(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class T{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");r=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===r.next&&(r.next=I),void 0===r.error&&(r.error=I),void 0===r.complete&&(r.complete=I);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}})),this.observers.push(r),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function I(){}function S(e){return e&&e._delegate?e._delegate:e}class C{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const A="[DEFAULT]";class k{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new l;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:A})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=A){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=A){return this.instances.has(e)}getOptions(e=A){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===A?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=A){return this.component?this.component.multipleInstances?e:A:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class R{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new k(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const N=[];var D,O;(O=D||(D={}))[O.DEBUG=0]="DEBUG",O[O.VERBOSE=1]="VERBOSE",O[O.INFO=2]="INFO",O[O.WARN=3]="WARN",O[O.ERROR=4]="ERROR",O[O.SILENT=5]="SILENT";const P={debug:D.DEBUG,verbose:D.VERBOSE,info:D.INFO,warn:D.WARN,error:D.ERROR,silent:D.SILENT},L=D.INFO,x={[D.DEBUG]:"log",[D.VERBOSE]:"log",[D.INFO]:"info",[D.WARN]:"warn",[D.ERROR]:"error"},M=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),s=x[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${r}]  ${e.name}:`,...n)};class U{constructor(e){this.name=e,this._logLevel=L,this._logHandler=M,this._userLogHandler=null,N.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in D))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?P[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,D.DEBUG,...e),this._logHandler(this,D.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,D.VERBOSE,...e),this._logHandler(this,D.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,D.INFO,...e),this._logHandler(this,D.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,D.WARN,...e),this._logHandler(this,D.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,D.ERROR,...e),this._logHandler(this,D.ERROR,...e)}}const F=(e,t)=>t.some((t=>e instanceof t));let V,B;const j=new WeakMap,q=new WeakMap,$=new WeakMap,z=new WeakMap,K=new WeakMap;let H={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return q.get(e);if("objectStoreNames"===t)return e.objectStoreNames||$.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return W(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function G(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(B||(B=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(Q(this),e),W(j.get(this))}:function(...e){return W(t.apply(Q(this),e))}:function(e,...n){const r=t.call(Q(this),e,...n);return $.set(r,e.sort?e.sort():[e]),W(r)}:(e instanceof IDBTransaction&&function(e){if(q.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",i),e.removeEventListener("abort",i)},s=()=>{t(),r()},i=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",s),e.addEventListener("error",i),e.addEventListener("abort",i)}));q.set(e,t)}(e),F(e,V||(V=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,H):e);var t}function W(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",s),e.removeEventListener("error",i)},s=()=>{t(W(e.result)),r()},i=()=>{n(e.error),r()};e.addEventListener("success",s),e.addEventListener("error",i)}));return t.then((t=>{t instanceof IDBCursor&&j.set(t,e)})).catch((()=>{})),K.set(t,e),t}(e);if(z.has(e))return z.get(e);const t=G(e);return t!==e&&(z.set(e,t),K.set(t,e)),t}const Q=e=>K.get(e),J=["get","getKey","getAll","getAllKeys","count"],X=["put","add","delete","clear"],Y=new Map;function Z(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Y.get(t))return Y.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,s=X.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!J.includes(n))return;const i=async function(e,...t){const i=this.transaction(e,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&i.done]))[0]};return Y.set(t,i),i}var ee;ee=H,H={...ee,get:(e,t,n)=>Z(e,t)||ee.get(e,t,n),has:(e,t)=>!!Z(e,t)||ee.has(e,t)};class te{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const ne="@firebase/app",re="0.9.29",se=new U("@firebase/app"),ie="[DEFAULT]",oe={[ne]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ae=new Map,ce=new Map;function ue(e,t){try{e.container.addComponent(t)}catch(n){se.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function he(e){const t=e.name;if(ce.has(t))return se.debug(`There were multiple attempts to register component ${t}.`),!1;ce.set(t,e);for(const t of ae.values())ue(t,e);return!0}function le(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const de=new m("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class fe{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new C("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw de.create("app-deleted",{appName:this._name})}}const pe="10.9.0";function ge(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const r=Object.assign({name:ie,automaticDataCollectionEnabled:!1},t),s=r.name;if("string"!=typeof s||!s)throw de.create("bad-app-name",{appName:String(s)});if(n||(n=u()),!n)throw de.create("no-options");const i=ae.get(s);if(i){if(v(n,i.options)&&v(r,i.config))return i;throw de.create("duplicate-app",{appName:s})}const o=new R(s);for(const e of ce.values())o.addComponent(e);const a=new fe(n,r,o);return ae.set(s,a),a}function me(e=ie){const t=ae.get(e);if(!t&&e===ie&&u())return ge();if(!t)throw de.create("no-app",{appName:e});return t}function ye(e,t,n){var r;let s=null!==(r=oe[e])&&void 0!==r?r:e;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=t.match(/\s|\//);if(i||o){const e=[`Unable to register library "${s}" with version "${t}":`];return i&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void se.warn(e.join(" "))}he(new C(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}const ve="firebase-heartbeat-database",we=1,_e="firebase-heartbeat-store";let Ee=null;function be(){return Ee||(Ee=function(e,t,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(e,t),a=W(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(W(o.result),e.oldVersion,e.newVersion,W(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{i&&e.addEventListener("close",(()=>i())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(ve,we,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(_e)}catch(e){console.warn(e)}}}).catch((e=>{throw de.create("idb-open",{originalErrorMessage:e.message})}))),Ee}async function Te(e,t){try{const n=(await be()).transaction(_e,"readwrite"),r=n.objectStore(_e);await r.put(t,Ie(e)),await n.done}catch(e){if(e instanceof g)se.warn(e.message);else{const t=de.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});se.warn(t.message)}}}function Ie(e){return`${e.name}!${e.options.appId}`}class Se{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Ae(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Ce();if((null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Ce(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const s of e){const e=n.find((e=>e.agent===s.agent));if(e){if(e.dates.push(s.date),ke(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),ke(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=s(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Ce(){return(new Date).toISOString().substring(0,10)}class Ae{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!p()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await be()).transaction(_e),n=await t.objectStore(_e).get(Ie(e));return await t.done,n}catch(e){if(e instanceof g)se.warn(e.message);else{const t=de.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});se.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Te(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Te(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function ke(e){return s(JSON.stringify({version:2,heartbeats:e})).length}he(new C("platform-logger",(e=>new te(e)),"PRIVATE")),he(new C("heartbeat",(e=>new Se(e)),"PRIVATE")),ye(ne,re,""),ye(ne,re,"esm2017"),ye("fire-js",""),ye("firebase","10.9.0","app");var Re,Ne="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},De={},Oe=Oe||{},Pe=Ne||self;function Le(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function xe(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Me="closure_uid_"+(1e9*Math.random()>>>0),Ue=0;function Fe(e,t,n){return e.call.apply(e.bind,arguments)}function Ve(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Be(e,t,n){return(Be=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Fe:Ve).apply(null,arguments)}function je(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function qe(e,t){function n(){}n.prototype=t.prototype,e.$=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.ac=function(e,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return t.prototype[n].apply(e,s)}}function $e(){this.s=this.s,this.o=this.o}$e.prototype.s=!1,$e.prototype.sa=function(){var e;!this.s&&(this.s=!0,this.N(),0)&&(e=this,Object.prototype.hasOwnProperty.call(e,Me)&&e[Me]||(e[Me]=++Ue))},$e.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ze=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"==typeof e)return"string"!=typeof t||1!=t.length?-1:e.indexOf(t,0);for(let n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function Ke(e){const t=e.length;if(0<t){const n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function He(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(Le(n)){const t=e.length||0,r=n.length||0;e.length=t+r;for(let s=0;s<r;s++)e[t+s]=n[s]}else e.push(n)}}function Ge(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Ge.prototype.h=function(){this.defaultPrevented=!0};var We=function(){if(!Pe.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};Pe.addEventListener("test",e,t),Pe.removeEventListener("test",e,t)}catch(e){}return e}();function Qe(e){return/^[\s\xa0]*$/.test(e)}function Je(){var e=Pe.navigator;return e&&(e=e.userAgent)?e:""}function Xe(e){return-1!=Je().indexOf(e)}function Ye(e){return Ye[" "](e),e}Ye[" "]=function(){};var Ze,et,tt,nt=Xe("Opera"),rt=Xe("Trident")||Xe("MSIE"),st=Xe("Edge"),it=st||rt,ot=Xe("Gecko")&&!(-1!=Je().toLowerCase().indexOf("webkit")&&!Xe("Edge"))&&!(Xe("Trident")||Xe("MSIE"))&&!Xe("Edge"),at=-1!=Je().toLowerCase().indexOf("webkit")&&!Xe("Edge");function ct(){var e=Pe.document;return e?e.documentMode:void 0}e:{var ut="",ht=(et=Je(),ot?/rv:([^\);]+)(\)|;)/.exec(et):st?/Edge\/([\d\.]+)/.exec(et):rt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(et):at?/WebKit\/(\S+)/.exec(et):nt?/(?:Version)[ \/]?(\S+)/.exec(et):void 0);if(ht&&(ut=ht?ht[1]:""),rt){var lt=ct();if(null!=lt&&lt>parseFloat(ut)){Ze=String(lt);break e}}Ze=ut}Pe.document&&rt?tt=ct()||parseInt(Ze,10)||void 0:tt=void 0;var dt=tt;function ft(e,t){if(Ge.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(ot){e:{try{Ye(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:pt[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&ft.$.h.call(this)}}qe(ft,Ge);var pt={2:"touch",3:"pen",4:"mouse"};ft.prototype.h=function(){ft.$.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var gt="closure_listenable_"+(1e6*Math.random()|0),mt=0;function yt(e,t,n,r,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.la=s,this.key=++mt,this.fa=this.ia=!1}function vt(e){e.fa=!0,e.listener=null,e.proxy=null,e.src=null,e.la=null}function wt(e,t,n){for(const r in e)t.call(n,e[r],r,e)}function _t(e){const t={};for(const n in e)t[n]=e[n];return t}const Et="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function bt(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t],r)e[n]=r[n];for(let t=0;t<Et.length;t++)n=Et[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Tt(e){this.src=e,this.g={},this.h=0}function It(e,t){var n=t.type;if(n in e.g){var r,s=e.g[n],i=ze(s,t);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(vt(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function St(e,t,n,r){for(var s=0;s<e.length;++s){var i=e[s];if(!i.fa&&i.listener==t&&i.capture==!!n&&i.la==r)return s}return-1}Tt.prototype.add=function(e,t,n,r,s){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=St(e,t,r,s);return-1<o?(t=e[o],n||(t.ia=!1)):((t=new yt(t,this.src,i,!!r,s)).ia=n,e.push(t)),t};var Ct="closure_lm_"+(1e6*Math.random()|0),At={};function kt(e,t,n,r,s){if(r&&r.once)return Nt(e,t,n,r,s);if(Array.isArray(t)){for(var i=0;i<t.length;i++)kt(e,t[i],n,r,s);return null}return n=Ut(n),e&&e[gt]?e.O(t,n,xe(r)?!!r.capture:!!r,s):Rt(e,t,n,!1,r,s)}function Rt(e,t,n,r,s,i){if(!t)throw Error("Invalid event type");var o=xe(s)?!!s.capture:!!s,a=xt(e);if(a||(e[Ct]=a=new Tt(e)),(n=a.add(t,n,r,o,i)).proxy)return n;if(r=function(){const e=Lt;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)We||(s=o),void 0===s&&(s=!1),e.addEventListener(t.toString(),r,s);else if(e.attachEvent)e.attachEvent(Pt(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Nt(e,t,n,r,s){if(Array.isArray(t)){for(var i=0;i<t.length;i++)Nt(e,t[i],n,r,s);return null}return n=Ut(n),e&&e[gt]?e.P(t,n,xe(r)?!!r.capture:!!r,s):Rt(e,t,n,!0,r,s)}function Dt(e,t,n,r,s){if(Array.isArray(t))for(var i=0;i<t.length;i++)Dt(e,t[i],n,r,s);else r=xe(r)?!!r.capture:!!r,n=Ut(n),e&&e[gt]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=St(i=e.g[t],n,r,s))&&(vt(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete e.g[t],e.h--))):e&&(e=xt(e))&&(t=e.g[t.toString()],e=-1,t&&(e=St(t,n,r,s)),(n=-1<e?t[e]:null)&&Ot(n))}function Ot(e){if("number"!=typeof e&&e&&!e.fa){var t=e.src;if(t&&t[gt])It(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Pt(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=xt(t))?(It(n,e),0==n.h&&(n.src=null,t[Ct]=null)):vt(e)}}}function Pt(e){return e in At?At[e]:At[e]="on"+e}function Lt(e,t){if(e.fa)e=!0;else{t=new ft(t,this);var n=e.listener,r=e.la||e.src;e.ia&&Ot(e),e=n.call(r,t)}return e}function xt(e){return(e=e[Ct])instanceof Tt?e:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(e){return"function"==typeof e?e:(e[Mt]||(e[Mt]=function(t){return e.handleEvent(t)}),e[Mt])}function Ft(){$e.call(this),this.i=new Tt(this),this.S=this,this.J=null}function Vt(e,t){var n,r=e.J;if(r)for(n=[];r;r=r.J)n.push(r);if(e=e.S,r=t.type||t,"string"==typeof t)t=new Ge(t,e);else if(t instanceof Ge)t.target=t.target||e;else{var s=t;bt(t=new Ge(r,e),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=t.g=n[i];s=Bt(o,r,!0,t)&&s}if(s=Bt(o=t.g=e,r,!0,t)&&s,s=Bt(o,r,!1,t)&&s,n)for(i=0;i<n.length;i++)s=Bt(o=t.g=n[i],r,!1,t)&&s}function Bt(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&It(e.i,o),s=!1!==a.call(c,r)&&s}}return s&&!r.defaultPrevented}qe(Ft,$e),Ft.prototype[gt]=!0,Ft.prototype.removeEventListener=function(e,t,n,r){Dt(this,e,t,n,r)},Ft.prototype.N=function(){if(Ft.$.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)vt(n[r]);delete t.g[e],t.h--}}this.J=null},Ft.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Ft.prototype.P=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var jt=Pe.JSON.stringify;function qt(){var e=Qt;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var $t=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new zt),(e=>e.reset()));class zt{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Kt(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function Ht(e){Pe.setTimeout((()=>{throw e}),0)}let Gt,Wt=!1,Qt=new class{constructor(){this.h=this.g=null}add(e,t){const n=$t.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},Jt=()=>{const e=Pe.Promise.resolve(void 0);Gt=()=>{e.then(Xt)}};var Xt=()=>{for(var e;e=qt();){try{e.h.call(e.g)}catch(e){Ht(e)}var t=$t;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Wt=!1};function Yt(e,t){Ft.call(this),this.h=e||1,this.g=t||Pe,this.j=Be(this.qb,this),this.l=Date.now()}function Zt(e){e.ga=!1,e.T&&(e.g.clearTimeout(e.T),e.T=null)}function en(e,t,n){if("function"==typeof e)n&&(e=Be(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Be(e.handleEvent,e)}return 2147483647<Number(t)?-1:Pe.setTimeout(e,t||0)}function tn(e){e.g=en((()=>{e.g=null,e.i&&(e.i=!1,tn(e))}),e.j);const t=e.h;e.h=null,e.m.apply(null,t)}qe(Yt,Ft),(Re=Yt.prototype).ga=!1,Re.T=null,Re.qb=function(){if(this.ga){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-e):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Vt(this,"tick"),this.ga&&(Zt(this),this.start()))}},Re.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Re.N=function(){Yt.$.N.call(this),Zt(this),delete this.g};class nn extends $e{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:tn(this)}N(){super.N(),this.g&&(Pe.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function rn(e){$e.call(this),this.h=e,this.g={}}qe(rn,$e);var sn=[];function on(e,t,n,r){Array.isArray(n)||(n&&(sn[0]=n.toString()),n=sn);for(var s=0;s<n.length;s++){var i=kt(t,n[s],r||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function an(e){wt(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Ot(e)}),e),e.g={}}function cn(){this.g=!0}function un(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return jt(n)}catch(e){return t}}(e,n)+(r?" "+r:"")}))}rn.prototype.N=function(){rn.$.N.call(this),an(this)},rn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},cn.prototype.Ea=function(){this.g=!1},cn.prototype.info=function(){};var hn={},ln=null;function dn(){return ln=ln||new Ft}function fn(e){Ge.call(this,hn.Ta,e)}function pn(e){const t=dn();Vt(t,new fn(t))}function gn(e,t){Ge.call(this,hn.STAT_EVENT,e),this.stat=t}function mn(e){const t=dn();Vt(t,new gn(t,e))}function yn(e,t){Ge.call(this,hn.Ua,e),this.size=t}function vn(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return Pe.setTimeout((function(){e()}),t)}hn.Ta="serverreachability",qe(fn,Ge),hn.STAT_EVENT="statevent",qe(gn,Ge),hn.Ua="timingevent",qe(yn,Ge);var wn={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},_n={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function En(){}function bn(e){return e.h||(e.h=e.i())}function Tn(){}En.prototype.h=null;var In,Sn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Cn(){Ge.call(this,"d")}function An(){Ge.call(this,"c")}function kn(){}function Rn(e,t,n,r){this.l=e,this.j=t,this.m=n,this.W=r||1,this.U=new rn(this),this.P=Dn,e=it?125:void 0,this.V=new Yt(e),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Nn}function Nn(){this.i=null,this.g="",this.h=!1}qe(Cn,Ge),qe(An,Ge),qe(kn,En),kn.prototype.g=function(){return new XMLHttpRequest},kn.prototype.i=function(){return{}},In=new kn;var Dn=45e3,On={},Pn={};function Ln(e,t,n){e.L=1,e.A=Zn(Wn(t)),e.u=n,e.S=!0,xn(e,null)}function xn(e,t){e.G=Date.now(),Vn(e),e.B=Wn(e.A);var n=e.B,r=e.W;Array.isArray(r)||(r=[String(r)]),dr(n.i,"t",r),e.o=0,n=e.l.J,e.h=new Nn,e.g=ls(e.l,n?t:null,!e.u),0<e.O&&(e.M=new nn(Be(e.Pa,e,e.g),e.O)),on(e.U,e.g,"readystatechange",e.nb),t=e.I?_t(e.I):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ha(e.B,e.v,e.u,t)):(e.v="GET",e.g.ha(e.B,e.v,null,t)),pn(),function(e,t,n,r,s,i){e.info((function(){if(e.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.v,e.B,e.m,e.W,e.u)}function Mn(e){return!!e.g&&"GET"==e.v&&2!=e.L&&e.l.Ha}function Un(e,t,n){let r,s=!0;for(;!e.J&&e.o<n.length;){if(r=Fn(e,n),r==Pn){4==t&&(e.s=4,mn(14),s=!1),un(e.j,e.m,null,"[Incomplete Response]");break}if(r==On){e.s=4,mn(15),un(e.j,e.m,n,"[Invalid Chunk]"),s=!1;break}un(e.j,e.m,r,null),zn(e,r)}Mn(e)&&0!=e.o&&(e.h.g=e.h.g.slice(e.o),e.o=0),4!=t||0!=n.length||e.h.h||(e.s=1,mn(16),s=!1),e.i=e.i&&s,s?0<n.length&&!e.ba&&(e.ba=!0,(t=e.l).g==e&&t.ca&&!t.M&&(t.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),rs(t),t.M=!0,mn(11))):(un(e.j,e.m,n,"[Invalid Chunked Response]"),$n(e),qn(e))}function Fn(e,t){var n=e.o,r=t.indexOf("\n",n);return-1==r?Pn:(n=Number(t.substring(n,r)),isNaN(n)?On:(r+=1)+n>t.length?Pn:(t=t.slice(r,r+n),e.o=r+n,t))}function Vn(e){e.Y=Date.now()+e.P,Bn(e,e.P)}function Bn(e,t){if(null!=e.C)throw Error("WatchDog timer not null");e.C=vn(Be(e.lb,e),t)}function jn(e){e.C&&(Pe.clearTimeout(e.C),e.C=null)}function qn(e){0==e.l.H||e.J||os(e.l,e)}function $n(e){jn(e);var t=e.M;t&&"function"==typeof t.sa&&t.sa(),e.M=null,Zt(e.V),an(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.sa())}function zn(e,t){try{var n=e.l;if(0!=n.H&&(n.g==e||vr(n.i,e)))if(!e.K&&vr(n.i,e)&&3==n.H){try{var r=n.Ja.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.G+3e3<e.G))break e;is(n),Qr(n)}ns(n),mn(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&0==n.A&&!n.v&&(n.v=vn(Be(n.ib,n),6e3));if(1>=yr(n.i)&&n.oa){try{n.oa()}catch(e){}n.oa=void 0}}else cs(n,11)}else if((e.K||n.g==e)&&is(n),!Qe(t))for(s=n.Ja.g.parse(t),t=0;t<s.length;t++){let u=s[t];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const t=u[3];null!=t&&(n.ra=t,n.l.info("VER="+n.ra));const s=u[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=e.g;if(l){const e=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var i=r.i;i.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(wr(i,i.h),i.h=null))}if(r.F){const e=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.Da=e,Yn(r.I,r.F,e))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-e.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=e;if((r=n).wa=hs(r,r.J?r.pa:null,r.Y),o.K){_r(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(jn(a),Vn(a)),r.g=o}else ts(r);0<n.j.length&&Xr(n)}else"stop"!=u[0]&&"close"!=u[0]||cs(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?cs(n,7):Wr(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}pn()}catch(e){}}function Kn(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Le(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.ta&&"function"==typeof e.ta)return e.ta();if(!e.Z||"function"!=typeof e.Z){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(Le(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const r in e)t[n++]=r;return t}}}(e),r=function(e){if(e.Z&&"function"==typeof e.Z)return e.Z();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(Le(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),s=r.length,i=0;i<s;i++)t.call(void 0,r[i],n&&n[i],e)}(Re=Rn.prototype).setTimeout=function(e){this.P=e},Re.nb=function(e){e=e.target;const t=this.M;t&&3==qr(e)?t.l():this.Pa(e)},Re.Pa=function(e){try{if(e==this.g)e:{const h=qr(this.g);var t=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||it||this.g&&(this.h.h||this.g.ja()||$r(this.g)))){this.J||4!=h||7==t||pn(),jn(this);var n=this.g.da();this.ca=n;t:if(Mn(this)){var r=$r(this.g);e="";var s=r.length,i=4==qr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){$n(this),qn(this);var o="";break t}this.h.i=new Pe.TextDecoder}for(t=0;t<s;t++)this.h.h=!0,e+=this.h.i.decode(r[t],{stream:i&&t==s-1});r.length=0,this.h.g+=e,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(e,t,n,r,s,i,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+i+" "+o}))}(this.j,this.v,this.B,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Qe(a)){var u=a;break t}}u=null}if(!(n=u)){this.i=!1,this.s=3,mn(12),$n(this),qn(this);break e}un(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,zn(this,n)}this.S?(Un(this,h,o),it&&this.i&&3==h&&(on(this.U,this.V,"tick",this.mb),this.V.start())):(un(this.j,this.m,o,null),zn(this,o)),4==h&&$n(this),this.i&&!this.J&&(4==h?os(this.l,this):(this.i=!1,Vn(this)))}else(function(e){const t={};e=(e.g&&2<=qr(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(Qe(e[r]))continue;var n=Kt(e[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=t[s]||[];t[s]=i,i.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,mn(12)):(this.s=0,mn(13)),$n(this),qn(this)}}}catch(e){}},Re.mb=function(){if(this.g){var e=qr(this.g),t=this.g.ja();this.o<t.length&&(jn(this),Un(this,e,t),this.i&&4!=e&&Vn(this))}},Re.cancel=function(){this.J=!0,$n(this)},Re.lb=function(){this.C=null;const e=Date.now();0<=e-this.Y?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.B),2!=this.L&&(pn(),mn(17)),$n(this),this.s=2,qn(this)):Bn(this,this.Y-e)};var Hn=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Gn(e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Gn){this.h=e.h,Qn(this,e.j),this.s=e.s,this.g=e.g,Jn(this,e.m),this.l=e.l;var t=e.i,n=new cr;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Xn(this,n),this.o=e.o}else e&&(t=String(e).match(Hn))?(this.h=!1,Qn(this,t[1]||"",!0),this.s=er(t[2]||""),this.g=er(t[3]||"",!0),Jn(this,t[4]),this.l=er(t[5]||"",!0),Xn(this,t[6]||"",!0),this.o=er(t[7]||"")):(this.h=!1,this.i=new cr(null,this.h))}function Wn(e){return new Gn(e)}function Qn(e,t,n){e.j=n?er(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Jn(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Xn(e,t,n){t instanceof cr?(e.i=t,function(e,t){t&&!e.j&&(ur(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(hr(this,t),dr(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=tr(t,or)),e.i=new cr(t,e.h))}function Yn(e,t,n){e.i.set(t,n)}function Zn(e){return Yn(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function er(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function tr(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,nr),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function nr(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Gn.prototype.toString=function(){var e=[],t=this.j;t&&e.push(tr(t,rr,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push(tr(t,rr,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(tr(n,"/"==n.charAt(0)?ir:sr,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",tr(n,ar)),e.join("")};var rr=/[#\/\?@]/g,sr=/[#\?:]/g,ir=/[#\?]/g,or=/[#\?@]/g,ar=/#/g;function cr(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ur(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),s=null;if(0<=r){var i=e[n].substring(0,r);s=e[n].substring(r+1)}else i=e[n];t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function hr(e,t){ur(e),t=fr(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function lr(e,t){return ur(e),t=fr(e,t),e.g.has(t)}function dr(e,t,n){hr(e,t),0<n.length&&(e.i=null,e.g.set(fr(e,t),Ke(n)),e.h+=n.length)}function fr(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function pr(e){this.l=e||gr,e=Pe.PerformanceNavigationTiming?0<(e=Pe.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(Pe.g&&Pe.g.Ka&&Pe.g.Ka()&&Pe.g.Ka().dc),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(Re=cr.prototype).add=function(e,t){ur(this),this.i=null,e=fr(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Re.forEach=function(e,t){ur(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},Re.ta=function(){ur(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let r=0;r<t.length;r++){const s=e[r];for(let e=0;e<s.length;e++)n.push(t[r])}return n},Re.Z=function(e){ur(this);let t=[];if("string"==typeof e)lr(this,e)&&(t=t.concat(this.g.get(fr(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},Re.set=function(e,t){return ur(this),this.i=null,lr(this,e=fr(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Re.get=function(e,t){return e&&0<(e=this.Z(e)).length?String(e[0]):t},Re.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var r=t[n];const i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),e.push(s)}}return this.i=e.join("&")};var gr=10;function mr(e){return!!e.h||!!e.g&&e.g.size>=e.j}function yr(e){return e.h?1:e.g?e.g.size:0}function vr(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function wr(e,t){e.g?e.g.add(t):e.h=t}function _r(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Er(e){if(null!=e.h)return e.i.concat(e.h.F);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.F);return t}return Ke(e.i)}pr.prototype.cancel=function(){if(this.i=Er(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var br=class{stringify(e){return Pe.JSON.stringify(e,void 0)}parse(e){return Pe.JSON.parse(e,void 0)}};function Tr(){this.g=new br}function Ir(e,t,n){const r=n||"";try{Kn(e,(function(e,n){let s=e;xe(e)&&(s=jt(e)),t.push(r+n+"="+encodeURIComponent(s))}))}catch(e){throw t.push(r+"type="+encodeURIComponent("_badmap")),e}}function Sr(e,t,n,r,s){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,s(r)}catch(e){}}function Cr(e){this.l=e.ec||null,this.j=e.ob||!1}function Ar(e,t){Ft.call(this),this.F=e,this.u=t,this.m=void 0,this.readyState=kr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}qe(Cr,En),Cr.prototype.g=function(){return new Ar(this.l,this.j)},Cr.prototype.i=function(e){return function(){return e}}({}),qe(Ar,Ft);var kr=0;function Rr(e){e.j.read().then(e.Xa.bind(e)).catch(e.ka.bind(e))}function Nr(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Dr(e)}function Dr(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Re=Ar.prototype).open=function(e,t){if(this.readyState!=kr)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Dr(this)},Re.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.F||Pe).fetch(new Request(this.B,t)).then(this.$a.bind(this),this.ka.bind(this))},Re.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Nr(this)),this.readyState=kr},Re.$a=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Dr(this)),this.g&&(this.readyState=3,Dr(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Pe.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Rr(this)}else e.text().then(this.Za.bind(this),this.ka.bind(this))},Re.Xa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Nr(this):Dr(this),3==this.readyState&&Rr(this)}},Re.Za=function(e){this.g&&(this.response=this.responseText=e,Nr(this))},Re.Ya=function(e){this.g&&(this.response=e,Nr(this))},Re.ka=function(){this.g&&Nr(this)},Re.setRequestHeader=function(e,t){this.v.append(e,t)},Re.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Re.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Ar.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var Or=Pe.JSON.parse;function Pr(e){Ft.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Lr,this.L=this.M=!1}qe(Pr,Ft);var Lr="",xr=/^https?$/i,Mr=["POST","PUT"];function Ur(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Fr(e),Br(e)}function Fr(e){e.F||(e.F=!0,Vt(e,"complete"),Vt(e,"error"))}function Vr(e){if(e.h&&void 0!==Oe&&(!e.C[1]||4!=qr(e)||2!=e.da()))if(e.v&&4==qr(e))en(e.La,0,e);else if(Vt(e,"readystatechange"),4==qr(e)){e.h=!1;try{const o=e.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===o){var s=String(e.I).match(Hn)[1]||null;!s&&Pe.self&&Pe.self.location&&(s=Pe.self.location.protocol.slice(0,-1)),r=!xr.test(s?s.toLowerCase():"")}n=r}if(n)Vt(e,"complete"),Vt(e,"success");else{e.m=6;try{var i=2<qr(e)?e.g.statusText:""}catch(e){i=""}e.j=i+" ["+e.da()+"]",Fr(e)}}finally{Br(e)}}}function Br(e,t){if(e.g){jr(e);const n=e.g,r=e.C[0]?()=>{}:null;e.g=null,e.C=null,t||Vt(e,"ready");try{n.onreadystatechange=r}catch(e){}}}function jr(e){e.g&&e.L&&(e.g.ontimeout=null),e.A&&(Pe.clearTimeout(e.A),e.A=null)}function qr(e){return e.g?e.g.readyState:0}function $r(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.K){case Lr:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function zr(e){let t="";return wt(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Kr(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=zr(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):Yn(e,t,n))}function Hr(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Gr(e){this.Ga=0,this.j=[],this.l=new cn,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Hr("failFast",!1,e),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Hr("baseRetryDelayMs",5e3,e),this.hb=Hr("retryDelaySeedMs",1e4,e),this.eb=Hr("forwardChannelMaxRetries",2,e),this.xa=Hr("forwardChannelRequestTimeoutMs",2e4,e),this.va=e&&e.xmlHttpFactory||void 0,this.Ha=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.i=new pr(e&&e.concurrentRequestLimit),this.Ja=new Tr,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=e&&e.bc||!1,e&&e.Ea&&this.l.Ea(),e&&e.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&e&&e.detectBufferingProxy||!1,this.qa=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.qa=e.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Wr(e){if(Jr(e),3==e.H){var t=e.W++,n=Wn(e.I);if(Yn(n,"SID",e.K),Yn(n,"RID",t),Yn(n,"TYPE","terminate"),Zr(e,n),(t=new Rn(e,e.l,t)).L=2,t.A=Zn(Wn(n)),n=!1,Pe.navigator&&Pe.navigator.sendBeacon)try{n=Pe.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&Pe.Image&&((new Image).src=t.A,n=!0),n||(t.g=ls(t.l,null),t.g.ha(t.A)),t.G=Date.now(),Vn(t)}us(e)}function Qr(e){e.g&&(rs(e),e.g.cancel(),e.g=null)}function Jr(e){Qr(e),e.u&&(Pe.clearTimeout(e.u),e.u=null),is(e),e.i.cancel(),e.m&&("number"==typeof e.m&&Pe.clearTimeout(e.m),e.m=null)}function Xr(e){if(!mr(e.i)&&!e.m){e.m=!0;var t=e.Na;Gt||Jt(),Wt||(Gt(),Wt=!0),Qt.add(t,e),e.C=0}}function Yr(e,t){var n;n=t?t.m:e.W++;const r=Wn(e.I);Yn(r,"SID",e.K),Yn(r,"RID",n),Yn(r,"AID",e.V),Zr(e,r),e.o&&e.s&&Kr(r,e.o,e.s),n=new Rn(e,e.l,n,e.C+1),null===e.o&&(n.I=e.s),t&&(e.j=t.F.concat(e.j)),t=es(e,n,1e3),n.setTimeout(Math.round(.5*e.xa)+Math.round(.5*e.xa*Math.random())),wr(e.i,n),Ln(n,r,t)}function Zr(e,t){e.na&&wt(e.na,(function(e,n){Yn(t,n,e)})),e.h&&Kn({},(function(e,n){Yn(t,n,e)}))}function es(e,t,n){n=Math.min(e.j.length,n);var r=e.h?Be(e.h.Va,e.h,e):null;e:{var s=e.j;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let i=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=t,0>n)t=Math.max(0,s[o].g-100),i=!1;else try{Ir(a,e,"req"+n+"_")}catch(e){r&&r(a)}}if(i){r=e.join("&");break e}}}return e=e.j.splice(0,n),t.F=e,r}function ts(e){if(!e.g&&!e.u){e.ba=1;var t=e.Ma;Gt||Jt(),Wt||(Gt(),Wt=!0),Qt.add(t,e),e.A=0}}function ns(e){return!(e.g||e.u||3<=e.A||(e.ba++,e.u=vn(Be(e.Ma,e),as(e,e.A)),e.A++,0))}function rs(e){null!=e.B&&(Pe.clearTimeout(e.B),e.B=null)}function ss(e){e.g=new Rn(e,e.l,"rpc",e.ba),null===e.o&&(e.g.I=e.s),e.g.O=0;var t=Wn(e.wa);Yn(t,"RID","rpc"),Yn(t,"SID",e.K),Yn(t,"AID",e.V),Yn(t,"CI",e.G?"0":"1"),!e.G&&e.qa&&Yn(t,"TO",e.qa),Yn(t,"TYPE","xmlhttp"),Zr(e,t),e.o&&e.s&&Kr(t,e.o,e.s),e.L&&e.g.setTimeout(e.L);var n=e.g;e=e.pa,n.L=1,n.A=Zn(Wn(t)),n.u=null,n.S=!0,xn(n,e)}function is(e){null!=e.v&&(Pe.clearTimeout(e.v),e.v=null)}function os(e,t){var n=null;if(e.g==t){is(e),rs(e),e.g=null;var r=2}else{if(!vr(e.i,t))return;n=t.F,_r(e.i,t),r=1}if(0!=e.H)if(t.i)if(1==r){n=t.u?t.u.length:0,t=Date.now()-t.G;var s=e.C;Vt(r=dn(),new yn(r,n)),Xr(e)}else ts(e);else if(3==(s=t.s)||0==s&&0<t.ca||!(1==r&&function(e,t){return!(yr(e.i)>=e.i.j-(e.m?1:0)||(e.m?(e.j=t.F.concat(e.j),0):1==e.H||2==e.H||e.C>=(e.cb?0:e.eb)||(e.m=vn(Be(e.Na,e,t),as(e,e.C)),e.C++,0)))}(e,t)||2==r&&ns(e)))switch(n&&0<n.length&&(t=e.i,t.i=t.i.concat(n)),s){case 1:cs(e,5);break;case 4:cs(e,10);break;case 3:cs(e,6);break;default:cs(e,2)}}function as(e,t){let n=e.ab+Math.floor(Math.random()*e.hb);return e.isActive()||(n*=2),n*t}function cs(e,t){if(e.l.info("Error code "+t),2==t){var n=null;e.h&&(n=null);var r=Be(e.pb,e);n||(n=new Gn("//www.google.com/images/cleardot.gif"),Pe.location&&"http"==Pe.location.protocol||Qn(n,"https"),Zn(n)),function(e,t){const n=new cn;if(Pe.Image){const r=new Image;r.onload=je(Sr,n,r,"TestLoadImage: loaded",!0,t),r.onerror=je(Sr,n,r,"TestLoadImage: error",!1,t),r.onabort=je(Sr,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=je(Sr,n,r,"TestLoadImage: timeout",!1,t),Pe.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else mn(2);e.H=0,e.h&&e.h.za(t),us(e),Jr(e)}function us(e){if(e.H=0,e.ma=[],e.h){const t=Er(e.i);0==t.length&&0==e.j.length||(He(e.ma,t),He(e.ma,e.j),e.i.i.length=0,Ke(e.j),e.j.length=0),e.h.ya()}}function hs(e,t,n){var r=n instanceof Gn?Wn(n):new Gn(n);if(""!=r.g)t&&(r.g=t+"."+r.g),Jn(r,r.m);else{var s=Pe.location;r=s.protocol,t=t?t+"."+s.hostname:s.hostname,s=+s.port;var i=new Gn(null);r&&Qn(i,r),t&&(i.g=t),s&&Jn(i,s),n&&(i.l=n),r=i}return n=e.F,t=e.Da,n&&t&&Yn(r,n,t),Yn(r,"VER",e.ra),Zr(e,r),r}function ls(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ha&&!e.va?new Pr(new Cr({ob:n})):new Pr(e.va)).Oa(e.J),t}function ds(){}function fs(){if(rt&&!(10<=Number(dt)))throw Error("Environmental error: no available transport.")}function ps(e,t){Ft.call(this),this.g=new Gr(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.Ca&&(e?e["X-WebChannel-Client-Profile"]=t.Ca:e={"X-WebChannel-Client-Profile":t.Ca}),this.g.U=e,(e=t&&t.cc)&&!Qe(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Qe(t)&&(this.g.F=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new ys(this)}function gs(e){Cn.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function ms(){An.call(this),this.status=1}function ys(e){this.g=e}function vs(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ws(e,t,n){n||(n=0);var r=Array(16);if("string"==typeof t)for(var s=0;16>s;++s)r[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];var i=e.g[3],o=t+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=(n=(s=(i=(t=n+(o<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^t&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(t^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(i^t))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(t^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(i^t))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^t&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(t^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^t^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^t)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~t))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~t))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~t))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(t=n+((o=t+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(t|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(t^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+r[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+i&4294967295}function _s(e,t){this.h=t;for(var n=[],r=!0,s=e.length-1;0<=s;s--){var i=0|e[s];r&&i==t||(n[s]=i,r=!1)}this.g=n}(Re=Pr.prototype).Oa=function(e){this.M=e},Re.ha=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+e);t=t?t.toUpperCase():"GET",this.I=e,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():In.g(),this.C=this.u?bn(this.u):bn(In),this.g.onreadystatechange=Be(this.La,this);try{this.G=!0,this.g.open(t,String(e),!0),this.G=!1}catch(e){return void Ur(this,e)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const e of r.keys())n.set(e,r.get(e))}r=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),s=Pe.FormData&&e instanceof Pe.FormData,!(0<=ze(Mr,t))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{jr(this),0<this.B&&((this.L=function(e){return rt&&"number"==typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Be(this.ua,this)):this.A=en(this.ua,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(e){Ur(this,e)}},Re.ua=function(){void 0!==Oe&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Vt(this,"timeout"),this.abort(8))},Re.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Vt(this,"complete"),Vt(this,"abort"),Br(this))},Re.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Br(this,!0)),Pr.$.N.call(this)},Re.La=function(){this.s||(this.G||this.v||this.l?Vr(this):this.kb())},Re.kb=function(){Vr(this)},Re.isActive=function(){return!!this.g},Re.da=function(){try{return 2<qr(this)?this.g.status:-1}catch(e){return-1}},Re.ja=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},Re.Wa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Or(t)}},Re.Ia=function(){return this.m},Re.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Re=Gr.prototype).ra=8,Re.H=1,Re.Na=function(e){if(this.m)if(this.m=null,1==this.H){if(!e){this.W=Math.floor(1e5*Math.random()),e=this.W++;const s=new Rn(this,this.l,e);let i=this.s;if(this.U&&(i?(i=_t(i),bt(i,this.U)):i=this.U),null!==this.o||this.O||(s.I=i,i=null),this.P)e:{for(var t=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(t+=r)){t=n;break e}if(4096===t||n===this.j.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=es(this,s,t),Yn(n=Wn(this.I),"RID",e),Yn(n,"CVER",22),this.F&&Yn(n,"X-HTTP-Session-Id",this.F),Zr(this,n),i&&(this.O?t="headers="+encodeURIComponent(String(zr(i)))+"&"+t:this.o&&Kr(n,this.o,i)),wr(this.i,s),this.bb&&Yn(n,"TYPE","init"),this.P?(Yn(n,"$req",t),Yn(n,"SID","null"),s.aa=!0,Ln(s,n,null)):Ln(s,n,t),this.H=2}}else 3==this.H&&(e?Yr(this,e):0==this.j.length||mr(this.i)||Yr(this))},Re.Ma=function(){if(this.u=null,ss(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var e=2*this.S;this.l.info("BP detection timer enabled: "+e),this.B=vn(Be(this.jb,this),e)}},Re.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,mn(10),Qr(this),ss(this))},Re.ib=function(){null!=this.v&&(this.v=null,Qr(this),ns(this),mn(19))},Re.pb=function(e){e?(this.l.info("Successfully pinged google.com"),mn(2)):(this.l.info("Failed to ping google.com"),mn(1))},Re.isActive=function(){return!!this.h&&this.h.isActive(this)},(Re=ds.prototype).Ba=function(){},Re.Aa=function(){},Re.za=function(){},Re.ya=function(){},Re.isActive=function(){return!0},Re.Va=function(){},fs.prototype.g=function(e,t){return new ps(e,t)},qe(ps,Ft),ps.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var e=this.g,t=this.l,n=this.h||void 0;mn(0),e.Y=t,e.na=n||{},e.G=e.aa,e.I=hs(e,null,e.Y),Xr(e)},ps.prototype.close=function(){Wr(this.g)},ps.prototype.u=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=jt(e),e=n);t.j.push(new class{constructor(e,t){this.g=e,this.map=t}}(t.fb++,e)),3==t.H&&Xr(t)},ps.prototype.N=function(){this.g.h=null,delete this.j,Wr(this.g),delete this.g,ps.$.N.call(this)},qe(gs,Cn),qe(ms,An),qe(ys,ds),ys.prototype.Ba=function(){Vt(this.g,"a")},ys.prototype.Aa=function(e){Vt(this.g,new gs(e))},ys.prototype.za=function(e){Vt(this.g,new ms)},ys.prototype.ya=function(){Vt(this.g,"b")},qe(vs,(function(){this.blockSize=-1})),vs.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},vs.prototype.j=function(e,t){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=this.m,s=this.h,i=0;i<t;){if(0==s)for(;i<=n;)ws(this,e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s++]=e.charCodeAt(i++),s==this.blockSize){ws(this,r),s=0;break}}else for(;i<t;)if(r[s++]=e[i++],s==this.blockSize){ws(this,r),s=0;break}}this.h=s,this.i+=t},vs.prototype.l=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.i;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.j(e),e=Array(16),t=n=0;4>t;++t)for(var r=0;32>r;r+=8)e[n++]=this.g[t]>>>r&255;return e};var Es={};function bs(e){return-128<=e&&128>e?function(e,t){var n=Es;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new _s([0|e],0>e?-1:0)}(e)}(e):new _s([0|e],0>e?-1:0)}function Ts(e){if(isNaN(e)||!isFinite(e))return Ss;if(0>e)return Ns(Ts(-e));for(var t=[],n=1,r=0;e>=n;r++)t[r]=e/n|0,n*=Is;return new _s(t,0)}var Is=4294967296,Ss=bs(0),Cs=bs(1),As=bs(16777216);function ks(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function Rs(e){return-1==e.h}function Ns(e){for(var t=e.g.length,n=[],r=0;r<t;r++)n[r]=~e.g[r];return new _s(n,~e.h).add(Cs)}function Ds(e,t){return e.add(Ns(t))}function Os(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function Ps(e,t){this.g=e,this.h=t}function Ls(e,t){if(ks(t))throw Error("division by zero");if(ks(e))return new Ps(Ss,Ss);if(Rs(e))return t=Ls(Ns(e),t),new Ps(Ns(t.g),Ns(t.h));if(Rs(t))return t=Ls(e,Ns(t)),new Ps(Ns(t.g),t.h);if(30<e.g.length){if(Rs(e)||Rs(t))throw Error("slowDivide_ only works with positive integers.");for(var n=Cs,r=t;0>=r.X(e);)n=xs(n),r=xs(r);var s=Ms(n,1),i=Ms(r,1);for(r=Ms(r,2),n=Ms(n,2);!ks(r);){var o=i.add(r);0>=o.X(e)&&(s=s.add(n),i=o),r=Ms(r,1),n=Ms(n,1)}return t=Ds(e,s.R(t)),new Ps(s,t)}for(s=Ss;0<=e.X(t);){for(n=Math.max(1,Math.floor(e.ea()/t.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(i=Ts(n)).R(t);Rs(o)||0<o.X(e);)o=(i=Ts(n-=r)).R(t);ks(i)&&(i=Cs),s=s.add(i),e=Ds(e,o)}return new Ps(s,e)}function xs(e){for(var t=e.g.length+1,n=[],r=0;r<t;r++)n[r]=e.D(r)<<1|e.D(r-1)>>>31;return new _s(n,e.h)}function Ms(e,t){var n=t>>5;t%=32;for(var r=e.g.length-n,s=[],i=0;i<r;i++)s[i]=0<t?e.D(i+n)>>>t|e.D(i+n+1)<<32-t:e.D(i+n);return new _s(s,e.h)}(Re=_s.prototype).ea=function(){if(Rs(this))return-Ns(this).ea();for(var e=0,t=1,n=0;n<this.g.length;n++){var r=this.D(n);e+=(0<=r?r:Is+r)*t,t*=Is}return e},Re.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(ks(this))return"0";if(Rs(this))return"-"+Ns(this).toString(e);for(var t=Ts(Math.pow(e,6)),n=this,r="";;){var s=Ls(n,t).g,i=((0<(n=Ds(n,s.R(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(ks(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},Re.D=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},Re.X=function(e){return Rs(e=Ds(this,e))?-1:ks(e)?0:1},Re.abs=function(){return Rs(this)?Ns(this):this},Re.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0,s=0;s<=t;s++){var i=r+(65535&this.D(s))+(65535&e.D(s)),o=(i>>>16)+(this.D(s)>>>16)+(e.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,n[s]=o<<16|i}return new _s(n,-2147483648&n[n.length-1]?-1:0)},Re.R=function(e){if(ks(this)||ks(e))return Ss;if(Rs(this))return Rs(e)?Ns(this).R(Ns(e)):Ns(Ns(this).R(e));if(Rs(e))return Ns(this.R(Ns(e)));if(0>this.X(As)&&0>e.X(As))return Ts(this.ea()*e.ea());for(var t=this.g.length+e.g.length,n=[],r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<e.g.length;s++){var i=this.D(r)>>>16,o=65535&this.D(r),a=e.D(s)>>>16,c=65535&e.D(s);n[2*r+2*s]+=o*c,Os(n,2*r+2*s),n[2*r+2*s+1]+=i*c,Os(n,2*r+2*s+1),n[2*r+2*s+1]+=o*a,Os(n,2*r+2*s+1),n[2*r+2*s+2]+=i*a,Os(n,2*r+2*s+2)}for(r=0;r<t;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=t;r<2*t;r++)n[r]=0;return new _s(n,0)},Re.gb=function(e){return Ls(this,e).h},Re.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)&e.D(r);return new _s(n,this.h&e.h)},Re.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)|e.D(r);return new _s(n,this.h|e.h)},Re.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],r=0;r<t;r++)n[r]=this.D(r)^e.D(r);return new _s(n,this.h^e.h)},fs.prototype.createWebChannel=fs.prototype.g,ps.prototype.send=ps.prototype.u,ps.prototype.open=ps.prototype.m,ps.prototype.close=ps.prototype.close,wn.NO_ERROR=0,wn.TIMEOUT=8,wn.HTTP_ERROR=6,_n.COMPLETE="complete",Tn.EventType=Sn,Sn.OPEN="a",Sn.CLOSE="b",Sn.ERROR="c",Sn.MESSAGE="d",Ft.prototype.listen=Ft.prototype.O,Pr.prototype.listenOnce=Pr.prototype.P,Pr.prototype.getLastError=Pr.prototype.Sa,Pr.prototype.getLastErrorCode=Pr.prototype.Ia,Pr.prototype.getStatus=Pr.prototype.da,Pr.prototype.getResponseJson=Pr.prototype.Wa,Pr.prototype.getResponseText=Pr.prototype.ja,Pr.prototype.send=Pr.prototype.ha,Pr.prototype.setWithCredentials=Pr.prototype.Oa,vs.prototype.digest=vs.prototype.l,vs.prototype.reset=vs.prototype.reset,vs.prototype.update=vs.prototype.j,_s.prototype.add=_s.prototype.add,_s.prototype.multiply=_s.prototype.R,_s.prototype.modulo=_s.prototype.gb,_s.prototype.compare=_s.prototype.X,_s.prototype.toNumber=_s.prototype.ea,_s.prototype.toString=_s.prototype.toString,_s.prototype.getBits=_s.prototype.D,_s.fromNumber=Ts,_s.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return Ns(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=Ts(Math.pow(n,8)),s=Ss,i=0;i<t.length;i+=8){var o=Math.min(8,t.length-i),a=parseInt(t.substring(i,i+o),n);8>o?(o=Ts(Math.pow(n,o)),s=s.R(o).add(Ts(a))):s=(s=s.R(r)).add(Ts(a))}return s};var Us=De.createWebChannelTransport=function(){return new fs},Fs=De.getStatEventTarget=function(){return dn()},Vs=De.ErrorCode=wn,Bs=De.EventType=_n,js=De.Event=hn,qs=De.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},$s=(De.FetchXmlHttpFactory=Cr,De.WebChannel=Tn),zs=De.XhrIo=Pr,Ks=De.Md5=vs,Hs=De.Integer=_s;const Gs="@firebase/firestore";class Ws{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ws.UNAUTHENTICATED=new Ws(null),Ws.GOOGLE_CREDENTIALS=new Ws("google-credentials-uid"),Ws.FIRST_PARTY=new Ws("first-party-uid"),Ws.MOCK_USER=new Ws("mock-user");let Qs="10.9.0";const Js=new U("@firebase/firestore");function Xs(){return Js.logLevel}function Ys(e,...t){if(Js.logLevel<=D.DEBUG){const n=t.map(ti);Js.debug(`Firestore (${Qs}): ${e}`,...n)}}function Zs(e,...t){if(Js.logLevel<=D.ERROR){const n=t.map(ti);Js.error(`Firestore (${Qs}): ${e}`,...n)}}function ei(e,...t){if(Js.logLevel<=D.WARN){const n=t.map(ti);Js.warn(`Firestore (${Qs}): ${e}`,...n)}}function ti(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function ni(e="Unexpected state"){const t=`FIRESTORE (${Qs}) INTERNAL ASSERTION FAILED: `+e;throw Zs(t),new Error(t)}function ri(e,t){e||ni()}function si(e,t){return e}const ii={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class oi extends g{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ai{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class ci{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ui{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Ws.UNAUTHENTICATED)))}shutdown(){}}class hi{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class li{constructor(e){this.t=e,this.currentUser=Ws.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let n=this.i;const r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new ai;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ai,e.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const t=s;e.enqueueRetryable((async()=>{await t.promise,await r(this.currentUser)}))},o=e=>{Ys("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(Ys("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ai)}}),0),i()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(Ys("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(ri("string"==typeof t.accessToken),new ci(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return ri(null===e||"string"==typeof e),new Ws(e)}}class di{constructor(e,t,n){this.l=e,this.h=t,this.P=n,this.type="FirstParty",this.user=Ws.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class fi{constructor(e,t,n){this.l=e,this.h=t,this.P=n}getToken(){return Promise.resolve(new di(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable((()=>t(Ws.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class pi{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class gi{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const n=e=>{null!=e.error&&Ys("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.R;return this.R=e.token,Ys("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const r=e=>{Ys("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.appCheck.addTokenListener(this.o)};this.A.onInit((e=>r(e))),setTimeout((()=>{if(!this.appCheck){const e=this.A.getImmediate({optional:!0});e?r(e):Ys("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(ri("string"==typeof e.token),this.R=e.token,new pi(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function mi(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}class yi{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=mi(40);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function vi(e,t){return e<t?-1:e>t?1:0}function wi(e,t,n){return e.length===t.length&&e.every(((e,r)=>n(e,t[r])))}class _i{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new oi(ii.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new oi(ii.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new oi(ii.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new oi(ii.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return _i.fromMillis(Date.now())}static fromDate(e){return _i.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor(1e6*(e-1e3*t));return new _i(t,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?vi(this.nanoseconds,e.nanoseconds):vi(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Ei{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Ei(e)}static min(){return new Ei(new _i(0,0))}static max(){return new Ei(new _i(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class bi{constructor(e,t,n){void 0===t?t=0:t>e.length&&ni(),void 0===n?n=e.length-t:n>e.length-t&&ni(),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===bi.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof bi?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let r=0;r<n;r++){const n=e.get(r),s=t.get(r);if(n<s)return-1;if(n>s)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ti extends bi{construct(e,t,n){return new Ti(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new oi(ii.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new Ti(t)}static emptyPath(){return new Ti([])}}const Ii=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Si extends bi{construct(e,t,n){return new Si(e,t,n)}static isValidIdentifier(e){return Ii.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Si.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Si(["__name__"])}static fromServerFormat(e){const t=[];let n="",r=0;const s=()=>{if(0===n.length)throw new oi(ii.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let i=!1;for(;r<e.length;){const t=e[r];if("\\"===t){if(r+1===e.length)throw new oi(ii.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new oi(ii.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?(i=!i,r++):"."!==t||i?(n+=t,r++):(s(),r++)}if(s(),i)throw new oi(ii.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Si(t)}static emptyPath(){return new Si([])}}class Ci{constructor(e){this.path=e}static fromPath(e){return new Ci(Ti.fromString(e))}static fromName(e){return new Ci(Ti.fromString(e).popFirst(5))}static empty(){return new Ci(Ti.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ti.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ti.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Ci(new Ti(e.slice()))}}function Ai(e){return new ki(e.readTime,e.key,-1)}class ki{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new ki(Ei.min(),Ci.empty(),-1)}static max(){return new ki(Ei.max(),Ci.empty(),-1)}}function Ri(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=Ci.comparator(e.documentKey,t.documentKey),0!==n?n:vi(e.largestBatchId,t.largestBatchId))}const Ni="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Di{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Oi(e){if(e.code!==ii.FAILED_PRECONDITION||e.message!==Ni)throw e;Ys("LocalStore","Unexpectedly lost primary lease")}class Pi{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&ni(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Pi(((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Pi?t:Pi.resolve(t)}catch(e){return Pi.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Pi.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Pi.reject(t)}static resolve(e){return new Pi(((t,n)=>{t(e)}))}static reject(e){return new Pi(((t,n)=>{n(e)}))}static waitFor(e){return new Pi(((t,n)=>{let r=0,s=0,i=!1;e.forEach((e=>{++r,e.next((()=>{++s,i&&s===r&&t()}),(e=>n(e)))})),i=!0,s===r&&t()}))}static or(e){let t=Pi.resolve(!1);for(const n of e)t=t.next((e=>e?Pi.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,r)=>{n.push(t.call(this,e,r))})),this.waitFor(n)}static mapArray(e,t){return new Pi(((n,r)=>{const s=e.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const c=a;t(e[c]).next((e=>{i[c]=e,++o,o===s&&n(i)}),(e=>r(e)))}}))}static doWhile(e,t){return new Pi(((n,r)=>{const s=()=>{!0===e()?t().next((()=>{s()}),r):n()};s()}))}}class Li{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new ai,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ui(e,t.error)):this.V.resolve()},this.transaction.onerror=t=>{const n=qi(t.target.error);this.V.reject(new Ui(e,n))}}static open(e,t,n,r){try{return new Li(t,e.transaction(r,n))}catch(e){throw new Ui(t,e)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(Ys("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Vi(t)}}class xi{constructor(e,t,n){this.name=e,this.version=t,this.p=n,12.2===xi.S(f())&&Zs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Ys("SimpleDb","Removing database:",e),Bi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!p())return!1;if(xi.C())return!0;const e=f(),t=xi.S(e),n=0<t&&t<10,r=xi.v(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||n||s)}static C(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.__PRIVATE_env)||void 0===e?void 0:e.F)}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(e){return this.db||(Ys("SimpleDb","Opening database:",this.name),this.db=await new Promise(((t,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=e=>{const n=e.target.result;t(n)},r.onblocked=()=>{n(new Ui(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=t=>{const r=t.target.error;"VersionError"===r.name?n(new oi(ii.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new oi(ii.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Ui(e,r))},r.onupgradeneeded=e=>{Ys("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);const t=e.target.result;this.p.N(t,r.transaction,e.oldVersion,this.version).next((()=>{Ys("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.L&&(this.db.onversionchange=e=>this.L(e)),this.db}B(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,n,r){const s="readonly"===t;let i=0;for(;;){++i;try{this.db=await this.O(e);const t=Li.open(this.db,e,s?"readonly":"readwrite",n),i=r(t).next((e=>(t.g(),e))).catch((e=>(t.abort(e),Pi.reject(e)))).toPromise();return i.catch((()=>{})),await t.m,i}catch(e){const t=e,n="FirebaseError"!==t.name&&i<3;if(Ys("SimpleDb","Transaction failed with error:",t.message,"Retrying:",n),this.close(),!n)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Mi{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Bi(this.k.delete())}}class Ui extends oi{constructor(e,t){super(ii.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Fi(e){return"IndexedDbTransactionError"===e.name}class Vi{constructor(e){this.store=e}put(e,t){let n;return void 0!==t?(Ys("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(Ys("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Bi(n)}add(e){return Ys("SimpleDb","ADD",this.store.name,e,e),Bi(this.store.add(e))}get(e){return Bi(this.store.get(e)).next((t=>(void 0===t&&(t=null),Ys("SimpleDb","GET",this.store.name,e,t),t)))}delete(e){return Ys("SimpleDb","DELETE",this.store.name,e),Bi(this.store.delete(e))}count(){return Ys("SimpleDb","COUNT",this.store.name),Bi(this.store.count())}W(e,t){const n=this.options(e,t),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const e=r.getAll(n.range);return new Pi(((t,n)=>{e.onerror=e=>{n(e.target.error)},e.onsuccess=e=>{t(e.target.result)}}))}{const e=this.cursor(n),t=[];return this.G(e,((e,n)=>{t.push(n)})).next((()=>t))}}j(e,t){const n=this.store.getAll(e,null===t?void 0:t);return new Pi(((e,t)=>{n.onerror=e=>{t(e.target.error)},n.onsuccess=t=>{e(t.target.result)}}))}H(e,t){Ys("SimpleDb","DELETE ALL",this.store.name);const n=this.options(e,t);n.J=!1;const r=this.cursor(n);return this.G(r,((e,t,n)=>n.delete()))}Y(e,t){let n;t?n=e:(n={},t=e);const r=this.cursor(n);return this.G(r,t)}Z(e){const t=this.cursor({});return new Pi(((n,r)=>{t.onerror=e=>{const t=qi(e.target.error);r(t)},t.onsuccess=t=>{const r=t.target.result;r?e(r.primaryKey,r.value).next((e=>{e?r.continue():n()})):n()}}))}G(e,t){const n=[];return new Pi(((r,s)=>{e.onerror=e=>{s(e.target.error)},e.onsuccess=e=>{const s=e.target.result;if(!s)return void r();const i=new Mi(s),o=t(s.primaryKey,s.value,i);if(o instanceof Pi){const e=o.catch((e=>(i.done(),Pi.reject(e))));n.push(e)}i.isDone?r():null===i.$?s.continue():s.continue(i.$)}})).next((()=>Pi.waitFor(n)))}options(e,t){let n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const n=this.store.index(e.index);return e.J?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Bi(e){return new Pi(((t,n)=>{e.onsuccess=e=>{const n=e.target.result;t(n)},e.onerror=e=>{const t=qi(e.target.error);n(t)}}))}let ji=!1;function qi(e){const t=xi.S(f());if(t>=12.2&&t<13){const t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){const e=new oi("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ji||(ji=!0,setTimeout((()=>{throw e}),0)),e}}return e}class $i{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.se(e),this.oe=e=>t.writeSequenceNumber(e))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}function zi(e){return null==e}function Ki(e){return 0===e&&1/e==-1/0}$i._e=-1;function Hi(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Gi(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Wi(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Qi{constructor(e,t){this.comparator=e,this.root=t||Xi.EMPTY}insert(e,t){return new Qi(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Xi.BLACK,null,null))}remove(e){return new Qi(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Xi.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ji(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ji(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ji(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ji(this.root,e,this.comparator,!0)}}class Ji{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Xi{constructor(e,t,n,r,s){this.key=e,this.value=t,this.color=null!=n?n:Xi.RED,this.left=null!=r?r:Xi.EMPTY,this.right=null!=s?s:Xi.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,s){return new Xi(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const s=n(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Xi.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Xi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Xi.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Xi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ni();if(this.right.isRed())throw ni();const e=this.left.check();if(e!==this.right.check())throw ni();return e+(this.isRed()?0:1)}}Xi.EMPTY=null,Xi.RED=!0,Xi.BLACK=!1,Xi.EMPTY=new class{constructor(){this.size=0}get key(){throw ni()}get value(){throw ni()}get color(){throw ni()}get left(){throw ni()}get right(){throw ni()}copy(e,t,n,r,s){return this}insert(e,t,n){return new Xi(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Yi{constructor(e){this.comparator=e,this.data=new Qi(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Zi(this.data.getIterator())}getIteratorFrom(e){return new Zi(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof Yi))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new Yi(this.comparator);return t.data=e,t}}class Zi{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class eo{constructor(e){this.fields=e,e.sort(Si.comparator)}static empty(){return new eo([])}unionWith(e){let t=new Yi(Si.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new eo(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return wi(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class to extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class no{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new to("Invalid base64 string: "+e):e}}(e);return new no(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new no(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return vi(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}no.EMPTY_BYTE_STRING=new no("");const ro=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function so(e){if(ri(!!e),"string"==typeof e){let t=0;const n=ro.exec(e);if(ri(!!n),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const r=new Date(e);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:io(e.seconds),nanos:io(e.nanos)}}function io(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function oo(e){return"string"==typeof e?no.fromBase64String(e):no.fromUint8Array(e)}function ao(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function co(e){const t=e.mapValue.fields.__previous_value__;return ao(t)?co(t):t}function uo(e){const t=so(e.mapValue.fields.__local_write_time__.timestampValue);return new _i(t.seconds,t.nanos)}class ho{constructor(e,t,n,r,s,i,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class lo{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new lo("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof lo&&e.projectId===this.projectId&&e.database===this.database}}const fo={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function po(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ao(e)?4:ko(e)?9007199254740991:10:ni()}function go(e,t){if(e===t)return!0;const n=po(e);if(n!==po(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return uo(e).isEqual(uo(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=so(e.timestampValue),r=so(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return oo(e.bytesValue).isEqual(oo(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return io(e.geoPointValue.latitude)===io(t.geoPointValue.latitude)&&io(e.geoPointValue.longitude)===io(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return io(e.integerValue)===io(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=io(e.doubleValue),r=io(t.doubleValue);return n===r?Ki(n)===Ki(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return wi(e.arrayValue.values||[],t.arrayValue.values||[],go);case 10:return function(e,t){const n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Hi(n)!==Hi(r))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===r[e]||!go(n[e],r[e])))return!1;return!0}(e,t);default:return ni()}}function mo(e,t){return void 0!==(e.values||[]).find((e=>go(e,t)))}function yo(e,t){if(e===t)return 0;const n=po(e),r=po(t);if(n!==r)return vi(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return vi(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=io(e.integerValue||e.doubleValue),r=io(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return vo(e.timestampValue,t.timestampValue);case 4:return vo(uo(e),uo(t));case 5:return vi(e.stringValue,t.stringValue);case 6:return function(e,t){const n=oo(e),r=oo(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){const t=vi(n[e],r[e]);if(0!==t)return t}return vi(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=vi(io(e.latitude),io(t.latitude));return 0!==n?n:vi(io(e.longitude),io(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){const n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){const t=yo(n[e],r[e]);if(t)return t}return vi(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===fo.mapValue&&t===fo.mapValue)return 0;if(e===fo.mapValue)return 1;if(t===fo.mapValue)return-1;const n=e.fields||{},r=Object.keys(n),s=t.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let e=0;e<r.length&&e<i.length;++e){const t=vi(r[e],i[e]);if(0!==t)return t;const o=yo(n[r[e]],s[i[e]]);if(0!==o)return o}return vi(r.length,i.length)}(e.mapValue,t.mapValue);default:throw ni()}}function vo(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return vi(e,t);const n=so(e),r=so(t),s=vi(n.seconds,r.seconds);return 0!==s?s:vi(n.nanos,r.nanos)}function wo(e){return _o(e)}function _o(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=so(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return oo(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return Ci.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const r of e.values||[])n?n=!1:t+=",",t+=_o(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",r=!0;for(const s of t)r?r=!1:n+=",",n+=`${s}:${_o(e.fields[s])}`;return n+"}"}(e.mapValue):ni()}function Eo(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function bo(e){return!!e&&"integerValue"in e}function To(e){return!!e&&"arrayValue"in e}function Io(e){return!!e&&"nullValue"in e}function So(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Co(e){return!!e&&"mapValue"in e}function Ao(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Gi(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Ao(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Ao(e.arrayValue.values[n]);return t}return Object.assign({},e)}function ko(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}class Ro{constructor(e){this.value=e}static empty(){return new Ro({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Co(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ao(t)}setAll(e){let t=Si.emptyPath(),n={},r=[];e.forEach(((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=s.popLast()}e?n[s.lastSegment()]=Ao(e):r.push(s.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,n,r)}delete(e){const t=this.field(e.popLast());Co(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return go(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];Co(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){Gi(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Ro(Ao(this.value))}}function No(e){const t=[];return Gi(e.fields,((e,n)=>{const r=new Si([e]);if(Co(n)){const e=No(n.mapValue).fields;if(0===e.length)t.push(r);else for(const n of e)t.push(r.child(n))}else t.push(r)})),new eo(t)}class Do{constructor(e,t,n,r,s,i,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(e){return new Do(e,0,Ei.min(),Ei.min(),Ei.min(),Ro.empty(),0)}static newFoundDocument(e,t,n,r){return new Do(e,1,t,Ei.min(),n,r,0)}static newNoDocument(e,t){return new Do(e,2,t,Ei.min(),Ei.min(),Ro.empty(),0)}static newUnknownDocument(e,t){return new Do(e,3,t,Ei.min(),Ei.min(),Ro.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Ei.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ro.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ro.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Ei.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Do&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Do(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Oo{constructor(e,t){this.position=e,this.inclusive=t}}function Po(e,t,n){let r=0;for(let s=0;s<e.position.length;s++){const i=t[s],o=e.position[s];if(r=i.field.isKeyField()?Ci.comparator(Ci.fromName(o.referenceValue),n.key):yo(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Lo(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!go(e.position[n],t.position[n]))return!1;return!0}class xo{constructor(e,t="asc"){this.field=e,this.dir=t}}function Mo(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class Uo{}class Fo extends Uo{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Ko(e,t,n):"array-contains"===t?new Qo(e,n):"in"===t?new Jo(e,n):"not-in"===t?new Xo(e,n):"array-contains-any"===t?new Yo(e,n):new Fo(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Ho(e,n):new Go(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(yo(t,this.value)):null!==t&&po(this.value)===po(t)&&this.matchesComparison(yo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return ni()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Vo extends Uo{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new Vo(e,t)}matches(e){return Bo(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Bo(e){return"and"===e.op}function jo(e){return function(e){for(const t of e.filters)if(t instanceof Vo)return!1;return!0}(e)&&Bo(e)}function qo(e){if(e instanceof Fo)return e.field.canonicalString()+e.op.toString()+wo(e.value);if(jo(e))return e.filters.map((e=>qo(e))).join(",");{const t=e.filters.map((e=>qo(e))).join(",");return`${e.op}(${t})`}}function $o(e,t){return e instanceof Fo?function(e,t){return t instanceof Fo&&e.op===t.op&&e.field.isEqual(t.field)&&go(e.value,t.value)}(e,t):e instanceof Vo?function(e,t){return t instanceof Vo&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,r)=>e&&$o(n,t.filters[r])),!0)}(e,t):void ni()}function zo(e){return e instanceof Fo?function(e){return`${e.field.canonicalString()} ${e.op} ${wo(e.value)}`}(e):e instanceof Vo?function(e){return e.op.toString()+" {"+e.getFilters().map(zo).join(" ,")+"}"}(e):"Filter"}class Ko extends Fo{constructor(e,t,n){super(e,t,n),this.key=Ci.fromName(n.referenceValue)}matches(e){const t=Ci.comparator(e.key,this.key);return this.matchesComparison(t)}}class Ho extends Fo{constructor(e,t){super(e,"in",t),this.keys=Wo(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Go extends Fo{constructor(e,t){super(e,"not-in",t),this.keys=Wo(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Wo(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>Ci.fromName(e.referenceValue)))}class Qo extends Fo{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return To(t)&&mo(t.arrayValue,this.value)}}class Jo extends Fo{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&mo(this.value.arrayValue,t)}}class Xo extends Fo{constructor(e,t){super(e,"not-in",t)}matches(e){if(mo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!mo(this.value.arrayValue,t)}}class Yo extends Fo{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!To(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>mo(this.value.arrayValue,e)))}}class Zo{constructor(e,t=null,n=[],r=[],s=null,i=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ce=null}}function ea(e,t=null,n=[],r=[],s=null,i=null,o=null){return new Zo(e,t,n,r,s,i,o)}function ta(e){const t=si(e);if(null===t.ce){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>qo(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),zi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>wo(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>wo(e))).join(",")),t.ce=e}return t.ce}function na(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Mo(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!$o(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Lo(e.startAt,t.startAt)&&Lo(e.endAt,t.endAt)}function ra(e){return Ci.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class sa{constructor(e,t=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function ia(e){return new sa(e)}function oa(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function aa(e){return null!==e.collectionGroup}function ca(e){const t=si(e);if(null===t.le){t.le=[];const e=new Set;for(const n of t.explicitOrderBy)t.le.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",r=function(e){let t=new Yi(Si.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);r.forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.le.push(new xo(r,n))})),e.has(Si.keyField().canonicalString())||t.le.push(new xo(Si.keyField(),n))}return t.le}function ua(e){const t=si(e);return t.he||(t.he=function(e,t){if("F"===e.limitType)return ea(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new xo(e.field,t)}));const n=e.endAt?new Oo(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Oo(e.startAt.position,e.startAt.inclusive):null;return ea(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(t,ca(e))),t.he}function ha(e,t){const n=e.filters.concat([t]);return new sa(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function la(e,t,n){return new sa(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function da(e,t){return na(ua(e),ua(t))&&e.limitType===t.limitType}function fa(e){return`${ta(ua(e))}|lt:${e.limitType}`}function pa(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>zo(e))).join(", ")}]`),zi(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>wo(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>wo(e))).join(",")),`Target(${t})`}(ua(e))}; limitType=${e.limitType})`}function ga(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Ci.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of ca(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const r=Po(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,ca(e),t)||e.endAt&&!function(e,t,n){const r=Po(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,ca(e),t))}(e,t)}function ma(e){return(t,n)=>{let r=!1;for(const s of ca(e)){const e=ya(s,t,n);if(0!==e)return e;r=r||s.field.isKeyField()}return 0}}function ya(e,t,n){const r=e.field.isKeyField()?Ci.comparator(t.key,n.key):function(e,t,n){const r=t.data.field(e),s=n.data.field(e);return null!==r&&null!==s?yo(r,s):ni()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return ni()}}class va{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,r]of n)if(this.equalsFn(t,e))return r}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Gi(this.inner,((t,n)=>{for(const[t,r]of n)e(t,r)}))}isEmpty(){return Wi(this.inner)}size(){return this.innerSize}}const wa=new Qi(Ci.comparator);function _a(){return wa}const Ea=new Qi(Ci.comparator);function ba(...e){let t=Ea;for(const n of e)t=t.insert(n.key,n);return t}function Ta(e){let t=Ea;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Ia(){return Ca()}function Sa(){return Ca()}function Ca(){return new va((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Aa=new Qi(Ci.comparator),ka=new Yi(Ci.comparator);function Ra(...e){let t=ka;for(const n of e)t=t.add(n);return t}const Na=new Yi(vi);function Da(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ki(t)?"-0":t}}function Oa(e){return{integerValue:""+e}}function Pa(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Ki(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?Oa(t):Da(e,t)}class La{constructor(){this._=void 0}}function xa(e,t,n){return e instanceof Fa?function(e,t){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&ao(t)&&(t=co(t)),t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Va?Ba(e,t):e instanceof ja?qa(e,t):function(e,t){const n=Ua(e,t),r=za(n)+za(e.Ie);return bo(n)&&bo(e.Ie)?Oa(r):Da(e.serializer,r)}(e,t)}function Ma(e,t,n){return e instanceof Va?Ba(e,t):e instanceof ja?qa(e,t):n}function Ua(e,t){return e instanceof $a?function(e){return bo(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Fa extends La{}class Va extends La{constructor(e){super(),this.elements=e}}function Ba(e,t){const n=Ka(t);for(const t of e.elements)n.some((e=>go(e,t)))||n.push(t);return{arrayValue:{values:n}}}class ja extends La{constructor(e){super(),this.elements=e}}function qa(e,t){let n=Ka(t);for(const t of e.elements)n=n.filter((e=>!go(e,t)));return{arrayValue:{values:n}}}class $a extends La{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function za(e){return io(e.integerValue||e.doubleValue)}function Ka(e){return To(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class Ha{constructor(e,t){this.version=e,this.transformResults=t}}class Ga{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ga}static exists(e){return new Ga(void 0,e)}static updateTime(e){return new Ga(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Wa(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Qa{}function Ja(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new oc(e.key,Ga.none()):new tc(e.key,e.data,Ga.none());{const n=e.data,r=Ro.empty();let s=new Yi(Si.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),s=s.add(e)}return new nc(e.key,r,new eo(s.toArray()),Ga.none())}}function Xa(e,t,n){e instanceof tc?function(e,t,n){const r=e.value.clone(),s=sc(e.fieldTransforms,t,n.transformResults);r.setAll(s),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof nc?function(e,t,n){if(!Wa(e.precondition,t))return void t.convertToUnknownDocument(n.version);const r=sc(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(rc(e)),s.setAll(r),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Ya(e,t,n,r){return e instanceof tc?function(e,t,n,r){if(!Wa(e.precondition,t))return n;const s=e.value.clone(),i=ic(e.fieldTransforms,r,t);return s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,r):e instanceof nc?function(e,t,n,r){if(!Wa(e.precondition,t))return n;const s=ic(e.fieldTransforms,r,t),i=t.data;return i.setAll(rc(e)),i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,r):function(e,t,n){return Wa(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Za(e,t){let n=null;for(const r of e.fieldTransforms){const e=t.data.field(r.field),s=Ua(r.transform,e||null);null!=s&&(null===n&&(n=Ro.empty()),n.set(r.field,s))}return n||null}function ec(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&wi(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Va&&t instanceof Va||e instanceof ja&&t instanceof ja?wi(e.elements,t.elements,go):e instanceof $a&&t instanceof $a?go(e.Ie,t.Ie):e instanceof Fa&&t instanceof Fa}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class tc extends Qa{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class nc extends Qa{constructor(e,t,n,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function rc(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=e.data.field(n);t.set(n,r)}})),t}function sc(e,t,n){const r=new Map;ri(e.length===n.length);for(let s=0;s<n.length;s++){const i=e[s],o=i.transform,a=t.data.field(i.field);r.set(i.field,Ma(o,a,n[s]))}return r}function ic(e,t,n){const r=new Map;for(const s of e){const e=s.transform,i=n.data.field(s.field);r.set(s.field,xa(e,i,t))}return r}class oc extends Qa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class ac extends Qa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class cc{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const r=this.mutations[t];r.key.isEqual(e.key)&&Xa(r,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=Ya(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=Ya(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Sa();return this.mutations.forEach((r=>{const s=e.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=t.has(r.key)?null:o;const a=Ja(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(Ei.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Ra())}isEqual(e){return this.batchId===e.batchId&&wi(this.mutations,e.mutations,((e,t)=>ec(e,t)))&&wi(this.baseMutations,e.baseMutations,((e,t)=>ec(e,t)))}}class uc{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){ri(e.mutations.length===n.length);let r=Aa;const s=e.mutations;for(let e=0;e<s.length;e++)r=r.insert(s[e].key,n[e].version);return new uc(e,t,n,r)}}class hc{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class lc{constructor(e,t){this.count=e,this.unchangedNames=t}}var dc,fc;function pc(e){if(void 0===e)return Zs("GRPC error has no .code"),ii.UNKNOWN;switch(e){case dc.OK:return ii.OK;case dc.CANCELLED:return ii.CANCELLED;case dc.UNKNOWN:return ii.UNKNOWN;case dc.DEADLINE_EXCEEDED:return ii.DEADLINE_EXCEEDED;case dc.RESOURCE_EXHAUSTED:return ii.RESOURCE_EXHAUSTED;case dc.INTERNAL:return ii.INTERNAL;case dc.UNAVAILABLE:return ii.UNAVAILABLE;case dc.UNAUTHENTICATED:return ii.UNAUTHENTICATED;case dc.INVALID_ARGUMENT:return ii.INVALID_ARGUMENT;case dc.NOT_FOUND:return ii.NOT_FOUND;case dc.ALREADY_EXISTS:return ii.ALREADY_EXISTS;case dc.PERMISSION_DENIED:return ii.PERMISSION_DENIED;case dc.FAILED_PRECONDITION:return ii.FAILED_PRECONDITION;case dc.ABORTED:return ii.ABORTED;case dc.OUT_OF_RANGE:return ii.OUT_OF_RANGE;case dc.UNIMPLEMENTED:return ii.UNIMPLEMENTED;case dc.DATA_LOSS:return ii.DATA_LOSS;default:return ni()}}(fc=dc||(dc={}))[fc.OK=0]="OK",fc[fc.CANCELLED=1]="CANCELLED",fc[fc.UNKNOWN=2]="UNKNOWN",fc[fc.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fc[fc.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fc[fc.NOT_FOUND=5]="NOT_FOUND",fc[fc.ALREADY_EXISTS=6]="ALREADY_EXISTS",fc[fc.PERMISSION_DENIED=7]="PERMISSION_DENIED",fc[fc.UNAUTHENTICATED=16]="UNAUTHENTICATED",fc[fc.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fc[fc.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fc[fc.ABORTED=10]="ABORTED",fc[fc.OUT_OF_RANGE=11]="OUT_OF_RANGE",fc[fc.UNIMPLEMENTED=12]="UNIMPLEMENTED",fc[fc.INTERNAL=13]="INTERNAL",fc[fc.UNAVAILABLE=14]="UNAVAILABLE",fc[fc.DATA_LOSS=15]="DATA_LOSS";const gc=new Hs([4294967295,4294967295],0);function mc(e){const t=(new TextEncoder).encode(e),n=new Ks;return n.update(t),new Uint8Array(n.digest())}function yc(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),i=t.getUint32(12,!0);return[new Hs([n,r],0),new Hs([s,i],0)]}class vc{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new wc(`Invalid padding: ${t}`);if(n<0)throw new wc(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new wc(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new wc(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=Hs.fromNumber(this.Te)}de(e,t,n){let r=e.add(t.multiply(Hs.fromNumber(n)));return 1===r.compare(gc)&&(r=new Hs([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(e){return 0!=(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.Te)return!1;const t=mc(e),[n,r]=yc(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);if(!this.Ae(t))return!1}return!0}static create(e,t,n){const r=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),i=new vc(s,r,t);return n.forEach((e=>i.insert(e))),i}insert(e){if(0===this.Te)return;const t=mc(e),[n,r]=yc(t);for(let e=0;e<this.hashCount;e++){const t=this.de(n,r,e);this.Re(t)}}Re(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class wc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class _c{constructor(e,t,n,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const r=new Map;return r.set(e,Ec.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new _c(Ei.min(),r,new Qi(vi),_a(),Ra())}}class Ec{constructor(e,t,n,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ec(n,t,Ra(),Ra(),Ra())}}class bc{constructor(e,t,n,r){this.Ve=e,this.removedTargetIds=t,this.key=n,this.me=r}}class Tc{constructor(e,t){this.targetId=e,this.fe=t}}class Ic{constructor(e,t,n=no.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class Sc{constructor(){this.ge=0,this.pe=kc(),this.ye=no.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=Ra(),t=Ra(),n=Ra();return this.pe.forEach(((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:ni()}})),new Ec(this.ye,this.we,e,t,n)}Fe(){this.Se=!1,this.pe=kc()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,ri(this.ge>=0)}Le(){this.Se=!0,this.we=!0}}class Cc{constructor(e){this.Be=e,this.ke=new Map,this.qe=_a(),this.Qe=Ac(),this.Ke=new Qi(vi)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,(t=>{const n=this.ze(t);switch(e.state){case 0:this.je(t)&&n.Ce(e.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(e.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(t);break;case 3:this.je(t)&&(n.Le(),n.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),n.Ce(e.resumeToken));break;default:ni()}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach(((e,n)=>{this.je(n)&&t(n)}))}Je(e){const t=e.targetId,n=e.fe.count,r=this.Ye(t);if(r){const s=r.target;if(ra(s))if(0===n){const e=new Ci(s.path);this.We(t,e,Do.newNoDocument(e,Ei.min()))}else ri(1===n);else{const r=this.Ze(t);if(r!==n){const n=this.Xe(e),s=n?this.et(n,e,r):1;if(0!==s){this.He(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,e)}}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=t;let i,o;try{i=oo(n).toUint8Array()}catch(e){if(e instanceof to)return ei("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new vc(i,r,s)}catch(e){return ei(e instanceof wc?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.Te?null:o}et(e,t,n){return t.fe.count===n-this.rt(e,t.targetId)?0:2}rt(e,t){const n=this.Be.getRemoteKeysForTarget(t);let r=0;return n.forEach((n=>{const s=this.Be.nt(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;e.mightContain(i)||(this.We(t,n,null),r++)})),r}it(e){const t=new Map;this.ke.forEach(((n,r)=>{const s=this.Ye(r);if(s){if(n.current&&ra(s.target)){const t=new Ci(s.target.path);null!==this.qe.get(t)||this.st(r,t)||this.We(r,t,Do.newNoDocument(t,e))}n.De&&(t.set(r,n.ve()),n.Fe())}}));let n=Ra();this.Qe.forEach(((e,t)=>{let r=!0;t.forEachWhile((e=>{const t=this.Ye(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)})),r&&(n=n.add(e))})),this.qe.forEach(((t,n)=>n.setReadTime(e)));const r=new _c(e,t,this.Ke,this.qe,n);return this.qe=_a(),this.Qe=Ac(),this.Ke=new Qi(vi),r}Ue(e,t){if(!this.je(e))return;const n=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,n),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,n){if(!this.je(e))return;const r=this.ze(e);this.st(e,t)?r.Me(t,1):r.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),n&&(this.qe=this.qe.insert(t,n))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new Sc,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new Yi(vi),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=null!==this.Ye(e);return t||Ys("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Be._t(e)}He(e){this.ke.set(e,new Sc),this.Be.getRemoteKeysForTarget(e).forEach((t=>{this.We(e,t,null)}))}st(e,t){return this.Be.getRemoteKeysForTarget(e).has(t)}}function Ac(){return new Qi(Ci.comparator)}function kc(){return new Qi(Ci.comparator)}const Rc={asc:"ASCENDING",desc:"DESCENDING"},Nc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Dc={and:"AND",or:"OR"};class Oc{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Pc(e,t){return e.useProto3Json||zi(t)?t:{value:t}}function Lc(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function xc(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Mc(e,t){return Lc(e,t.toTimestamp())}function Uc(e){return ri(!!e),Ei.fromTimestamp(function(e){const t=so(e);return new _i(t.seconds,t.nanos)}(e))}function Fc(e,t){return Vc(e,t).canonicalString()}function Vc(e,t){const n=function(e){return new Ti(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Bc(e){const t=Ti.fromString(e);return ri(su(t)),t}function jc(e,t){return Fc(e.databaseId,t.path)}function qc(e,t){const n=Bc(t);if(n.get(1)!==e.databaseId.projectId)throw new oi(ii.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new oi(ii.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Ci(Kc(n))}function $c(e,t){return Fc(e.databaseId,t)}function zc(e){return new Ti(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Kc(e){return ri(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Hc(e,t,n){return{name:jc(e,t),fields:n.value.mapValue.fields}}function Gc(e,t){return{documents:[$c(e,t.path)]}}function Wc(e,t){const n={structuredQuery:{}},r=t.path;let s;null!==t.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=$c(e,s);const i=function(e){if(0!==e.length)return nu(Vo.create(e,"and"))}(t.filters);i&&(n.structuredQuery.where=i);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:eu(e.field),direction:Xc(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Pc(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ut:n,parent:s}}function Qc(e){let t=function(e){const t=Bc(e);return 4===t.length?Ti.emptyPath():Kc(t)}(e.parent);const n=e.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){ri(1===r);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let i=[];n.where&&(i=function(e){const t=Jc(e);return t instanceof Vo&&jo(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new xo(tu(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,zi(t)?null:t}(n.limit));let c=null;n.startAt&&(c=function(e){const t=!!e.before,n=e.values||[];return new Oo(n,t)}(n.startAt));let u=null;return n.endAt&&(u=function(e){const t=!e.before,n=e.values||[];return new Oo(n,t)}(n.endAt)),function(e,t,n,r,s,i,o,a){return new sa(e,t,n,r,s,i,o,a)}(t,s,o,i,a,"F",c,u)}function Jc(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=tu(e.unaryFilter.field);return Fo.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=tu(e.unaryFilter.field);return Fo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=tu(e.unaryFilter.field);return Fo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=tu(e.unaryFilter.field);return Fo.create(s,"!=",{nullValue:"NULL_VALUE"});default:return ni()}}(e):void 0!==e.fieldFilter?function(e){return Fo.create(tu(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ni()}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Vo.create(e.compositeFilter.filters.map((e=>Jc(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return ni()}}(e.compositeFilter.op))}(e):ni()}function Xc(e){return Rc[e]}function Yc(e){return Nc[e]}function Zc(e){return Dc[e]}function eu(e){return{fieldPath:e.canonicalString()}}function tu(e){return Si.fromServerFormat(e.fieldPath)}function nu(e){return e instanceof Fo?function(e){if("=="===e.op){if(So(e.value))return{unaryFilter:{field:eu(e.field),op:"IS_NAN"}};if(Io(e.value))return{unaryFilter:{field:eu(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(So(e.value))return{unaryFilter:{field:eu(e.field),op:"IS_NOT_NAN"}};if(Io(e.value))return{unaryFilter:{field:eu(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:eu(e.field),op:Yc(e.op),value:e.value}}}(e):e instanceof Vo?function(e){const t=e.getFilters().map((e=>nu(e)));return 1===t.length?t[0]:{compositeFilter:{op:Zc(e.op),filters:t}}}(e):ni()}function ru(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function su(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class iu{constructor(e,t,n,r,s=Ei.min(),i=Ei.min(),o=no.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new iu(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new iu(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new iu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new iu(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ou{constructor(e){this.ct=e}}function au(e){const t=Qc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?la(t,t.limit,"L"):t}class cu{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(io(e.integerValue));else if("doubleValue"in e){const n=io(e.doubleValue);isNaN(n)?this.Et(t,13):(this.Et(t,15),Ki(n)?t.dt(0):t.dt(n))}else if("timestampValue"in e){const n=e.timestampValue;this.Et(t,20),"string"==typeof n?t.At(n):(t.At(`${n.seconds||""}`),t.dt(n.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(oo(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Et(t,45),t.dt(n.latitude||0),t.dt(n.longitude||0)}else"mapValue"in e?ko(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):ni()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){const n=e.fields||{};this.Et(t,55);for(const e of Object.keys(n))this.Rt(e,t),this.It(n[e],t)}wt(e,t){const n=e.values||[];this.Et(t,50);for(const e of n)this.It(e,t)}gt(e,t){this.Et(t,37),Ci.fromName(e).path.forEach((e=>{this.Et(t,60),this.St(e,t)}))}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}}cu.bt=new cu;class uu{constructor(){this._n=new hu}addToCollectionParentIndex(e,t){return this._n.add(t),Pi.resolve()}getCollectionParents(e,t){return Pi.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return Pi.resolve()}deleteFieldIndex(e,t){return Pi.resolve()}deleteAllFieldIndexes(e){return Pi.resolve()}createTargetIndexes(e,t){return Pi.resolve()}getDocumentsMatchingTarget(e,t){return Pi.resolve(null)}getIndexType(e,t){return Pi.resolve(0)}getFieldIndexes(e,t){return Pi.resolve([])}getNextCollectionGroupToUpdate(e){return Pi.resolve(null)}getMinOffset(e,t){return Pi.resolve(ki.min())}getMinOffsetFromCollectionGroup(e,t){return Pi.resolve(ki.min())}updateCollectionGroup(e,t,n){return Pi.resolve()}updateIndexEntries(e,t){return Pi.resolve()}}class hu{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Yi(Ti.comparator),s=!r.has(n);return this.index[t]=r.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new Yi(Ti.comparator)).toArray()}}new Uint8Array(0);class lu{constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}static withCacheSize(e){return new lu(e,lu.DEFAULT_COLLECTION_PERCENTILE,lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}lu.DEFAULT_COLLECTION_PERCENTILE=10,lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lu.DEFAULT=new lu(41943040,lu.DEFAULT_COLLECTION_PERCENTILE,lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lu.DISABLED=new lu(-1,0,0);class du{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new du(0)}static Ln(){return new du(-1)}}class fu{constructor(){this.changes=new va((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Do.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Pi.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class pu{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class gu{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((r=>(n=r,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&Ya(n.mutation,e,eo.empty(),_i.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Ra()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Ra()){const r=Ia();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,n).next((e=>{let t=ba();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Ia();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Ra())))}populateOverlays(e,t,n){const r=[];return n.forEach((e=>{t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,r){let s=_a();const i=Ca(),o=Ca();return t.forEach(((e,t)=>{const o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof nc)?s=s.insert(t.key,t):void 0!==o?(i.set(t.key,o.mutation.getFieldMask()),Ya(o.mutation,t,o.mutation.getFieldMask(),_i.now())):i.set(t.key,eo.empty())})),this.recalculateAndSaveOverlays(e,s).next((e=>(e.forEach(((e,t)=>i.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new pu(t,null!==(n=i.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Ca();let r=new Qi(((e,t)=>e-t)),s=Ra();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const s of e)s.keys().forEach((e=>{const i=t.get(e);if(null===i)return;let o=n.get(e)||eo.empty();o=s.applyToLocalView(i,o),n.set(e,o);const a=(r.get(s.batchId)||Ra()).add(e);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=Sa();c.forEach((e=>{if(!s.has(e)){const r=Ja(t.get(e),n.get(e));null!==r&&u.set(e,r),s=s.add(e)}})),i.push(this.documentOverlayCache.saveOverlays(e,a,u))}return Pi.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,r){return function(e){return Ci.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):aa(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-s.size):Pi.resolve(Ia());let o=-1,a=s;return i.next((t=>Pi.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(t)?Pi.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,s))).next((()=>this.computeViews(e,a,t,Ra()))).next((e=>({batchId:o,changes:Ta(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Ci(t)).next((e=>{let t=ba();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){const s=t.collectionGroup;let i=ba();return this.indexManager.getCollectionParents(e,s).next((o=>Pi.forEach(o,(o=>{const a=function(e,t){return new sa(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(s));return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next((e=>{e.forEach(((e,t)=>{i=i.insert(e,t)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(e,t,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,r)))).next((e=>{s.forEach(((t,n)=>{const r=n.getKey();null===e.get(r)&&(e=e.insert(r,Do.newInvalidDocument(r)))}));let n=ba();return e.forEach(((e,r)=>{const i=s.get(e);void 0!==i&&Ya(i.mutation,r,eo.empty(),_i.now()),ga(t,r)&&(n=n.insert(e,r))})),n}))}}class mu{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return Pi.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:Uc(e.createTime)}}(t)),Pi.resolve()}getNamedQuery(e,t){return Pi.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(e){return{name:e.name,query:au(e.bundledQuery),readTime:Uc(e.readTime)}}(t)),Pi.resolve()}}class yu{constructor(){this.overlays=new Qi(Ci.comparator),this.hr=new Map}getOverlay(e,t){return Pi.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ia();return Pi.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,r)=>{this.ht(e,t,r)})),Pi.resolve()}removeOverlaysForBatchId(e,t,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((e=>this.overlays=this.overlays.remove(e))),this.hr.delete(n)),Pi.resolve()}getOverlaysForCollection(e,t,n){const r=Ia(),s=t.length+1,i=new Ci(t.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const e=o.getNext().value,i=e.getKey();if(!t.isPrefixOf(i.path))break;i.path.length===s&&e.largestBatchId>n&&r.set(e.getKey(),e)}return Pi.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let s=new Qi(((e,t)=>e-t));const i=this.overlays.getIterator();for(;i.hasNext();){const e=i.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=Ia(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Ia(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=r)););return Pi.resolve(o)}ht(e,t,n){const r=this.overlays.get(n.key);if(null!==r){const e=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new hc(t,n));let s=this.hr.get(t);void 0===s&&(s=Ra(),this.hr.set(t,s)),this.hr.set(t,s.add(n.key))}}class vu{constructor(){this.Pr=new Yi(wu.Ir),this.Tr=new Yi(wu.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){const n=new wu(e,t);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Ar(new wu(e,t))}Rr(e,t){e.forEach((e=>this.removeReference(e,t)))}Vr(e){const t=new Ci(new Ti([])),n=new wu(t,e),r=new wu(t,e+1),s=[];return this.Tr.forEachInRange([n,r],(e=>{this.Ar(e),s.push(e.key)})),s}mr(){this.Pr.forEach((e=>this.Ar(e)))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){const t=new Ci(new Ti([])),n=new wu(t,e),r=new wu(t,e+1);let s=Ra();return this.Tr.forEachInRange([n,r],(e=>{s=s.add(e.key)})),s}containsKey(e){const t=new wu(e,0),n=this.Pr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class wu{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return Ci.comparator(e.key,t.key)||vi(e.pr,t.pr)}static Er(e,t){return vi(e.pr,t.pr)||Ci.comparator(e.key,t.key)}}class _u{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Yi(wu.Ir)}checkEmpty(e){return Pi.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){const s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new cc(s,t,n,r);this.mutationQueue.push(i);for(const t of r)this.wr=this.wr.add(new wu(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Pi.resolve(i)}lookupMutationBatch(e,t){return Pi.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,r=this.br(n),s=r<0?0:r;return Pi.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Pi.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(e){return Pi.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new wu(t,0),r=new wu(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,r],(e=>{const t=this.Sr(e.pr);s.push(t)})),Pi.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new Yi(vi);return t.forEach((e=>{const t=new wu(e,0),r=new wu(e,Number.POSITIVE_INFINITY);this.wr.forEachInRange([t,r],(e=>{n=n.add(e.pr)}))})),Pi.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,r=n.length+1;let s=n;Ci.isDocumentKey(s)||(s=s.child(""));const i=new wu(new Ci(s),0);let o=new Yi(vi);return this.wr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.pr)),!0)}),i),Pi.resolve(this.Dr(o))}Dr(e){const t=[];return e.forEach((e=>{const n=this.Sr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){ri(0===this.Cr(t.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return Pi.forEach(t.mutations,(r=>{const s=new wu(r.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)})).next((()=>{this.wr=n}))}Mn(e){}containsKey(e,t){const n=new wu(t,0),r=this.wr.firstAfterOrEqual(n);return Pi.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,Pi.resolve()}Cr(e,t){return this.br(e)}br(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Sr(e){const t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Eu{constructor(e){this.vr=e,this.docs=new Qi(Ci.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,r=this.docs.get(n),s=r?r.size:0,i=this.vr(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Pi.resolve(n?n.document.mutableCopy():Do.newInvalidDocument(t))}getEntries(e,t){let n=_a();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Do.newInvalidDocument(e))})),Pi.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let s=_a();const i=t.path,o=new Ci(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!i.isPrefixOf(e.path))break;e.path.length>i.length+1||Ri(Ai(o),n)<=0||(r.has(o.key)||ga(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Pi.resolve(s)}getAllFromCollectionGroup(e,t,n,r){ni()}Fr(e,t){return Pi.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new bu(this)}getSize(e){return Pi.resolve(this.size)}}class bu extends fu{constructor(e){super(),this.ar=e}applyChanges(e){const t=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?t.push(this.ar.addEntry(e,r)):this.ar.removeEntry(n)})),Pi.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}}class Tu{constructor(e){this.persistence=e,this.Mr=new va((e=>ta(e)),na),this.lastRemoteSnapshotVersion=Ei.min(),this.highestTargetId=0,this.Or=0,this.Nr=new vu,this.targetCount=0,this.Lr=du.Nn()}forEachTarget(e,t){return this.Mr.forEach(((e,n)=>t(n))),Pi.resolve()}getLastRemoteSnapshotVersion(e){return Pi.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Pi.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),Pi.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.Or&&(this.Or=t),Pi.resolve()}qn(e){this.Mr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Lr=new du(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,Pi.resolve()}updateTargetData(e,t){return this.qn(t),Pi.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,Pi.resolve()}removeTargets(e,t,n){let r=0;const s=[];return this.Mr.forEach(((i,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.Mr.delete(i),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)})),Pi.waitFor(s).next((()=>r))}getTargetCount(e){return Pi.resolve(this.targetCount)}getTargetData(e,t){const n=this.Mr.get(t)||null;return Pi.resolve(n)}addMatchingKeys(e,t,n){return this.Nr.dr(t,n),Pi.resolve()}removeMatchingKeys(e,t,n){this.Nr.Rr(t,n);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach((t=>{s.push(r.markPotentiallyOrphaned(e,t))})),Pi.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),Pi.resolve()}getMatchingKeysForTargetId(e,t){const n=this.Nr.gr(t);return Pi.resolve(n)}containsKey(e,t){return Pi.resolve(this.Nr.containsKey(t))}}class Iu{constructor(e,t){this.Br={},this.overlays={},this.kr=new $i(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Tu(this),this.indexManager=new uu,this.remoteDocumentCache=function(e){return new Eu(e)}((e=>this.referenceDelegate.Kr(e))),this.serializer=new ou(t),this.$r=new mu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new yu,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.Br[e.toKey()];return n||(n=new _u(t,this.referenceDelegate),this.Br[e.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,n){Ys("MemoryPersistence","Starting transaction:",e);const r=new Su(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((e=>this.referenceDelegate.Wr(r).next((()=>e)))).toPromise().then((e=>(r.raiseOnCommittedEvent(),e)))}Gr(e,t){return Pi.or(Object.values(this.Br).map((n=>()=>n.containsKey(e,t))))}}class Su extends Di{constructor(e){super(),this.currentSequenceNumber=e}}class Cu{constructor(e){this.persistence=e,this.zr=new vu,this.jr=null}static Hr(e){return new Cu(e)}get Jr(){if(this.jr)return this.jr;throw ni()}addReference(e,t,n){return this.zr.addReference(n,t),this.Jr.delete(n.toString()),Pi.resolve()}removeReference(e,t,n){return this.zr.removeReference(n,t),this.Jr.add(n.toString()),Pi.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),Pi.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach((e=>this.Jr.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.Jr.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ur(){this.jr=new Set}Wr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Pi.forEach(this.Jr,(n=>{const r=Ci.fromPath(n);return this.Yr(e,r).next((e=>{e||t.removeEntry(r,Ei.min())}))})).next((()=>(this.jr=null,t.apply(e))))}updateLimboDocument(e,t){return this.Yr(e,t).next((e=>{e?this.Jr.delete(t.toString()):this.Jr.add(t.toString())}))}Kr(e){return 0}Yr(e,t){return Pi.or([()=>Pi.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}}class Au{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.qi=n,this.Qi=r}static Ki(e,t){let n=Ra(),r=Ra();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new Au(e,t.fromCache,n,r)}}class ku{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Ru{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=!function(){var t;const n=null===(t=o())||void 0===t?void 0:t.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:xi.v(f())>0?6:4}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,n,r){const s={result:null};return this.ji(e,t).next((e=>{s.result=e})).next((()=>{if(!s.result)return this.Hi(e,t,r,n).next((e=>{s.result=e}))})).next((()=>{if(s.result)return;const n=new ku;return this.Ji(e,t,n).next((r=>{if(s.result=r,this.Ui)return this.Yi(e,t,n,r.size)}))})).next((()=>s.result))}Yi(e,t,n,r){return n.documentReadCount<this.Wi?(Xs()<=D.DEBUG&&Ys("QueryEngine","SDK will not create cache indexes for query:",pa(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),Pi.resolve()):(Xs()<=D.DEBUG&&Ys("QueryEngine","Query:",pa(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Xs()<=D.DEBUG&&Ys("QueryEngine","The SDK decides to create cache indexes for query:",pa(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ua(t))):Pi.resolve())}ji(e,t){if(oa(t))return Pi.resolve(null);let n=ua(t);return this.indexManager.getIndexType(e,n).next((r=>0===r?null:(null!==t.limit&&1===r&&(t=la(t,null,"F"),n=ua(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((r=>{const s=Ra(...r);return this.zi.getDocuments(e,s).next((r=>this.indexManager.getMinOffset(e,n).next((n=>{const i=this.Zi(t,r);return this.Xi(t,i,s,n.readTime)?this.ji(e,la(t,null,"F")):this.es(e,i,t,n)}))))})))))}Hi(e,t,n,r){return oa(t)||r.isEqual(Ei.min())?Pi.resolve(null):this.zi.getDocuments(e,n).next((s=>{const i=this.Zi(t,s);return this.Xi(t,i,n,r)?Pi.resolve(null):(Xs()<=D.DEBUG&&Ys("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),pa(t)),this.es(e,i,t,function(e,t){const n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,s=Ei.fromTimestamp(1e9===r?new _i(n+1,0):new _i(n,r));return new ki(s,Ci.empty(),t)}(r,-1)).next((e=>e)))}))}Zi(e,t){let n=new Yi(ma(e));return t.forEach(((t,r)=>{ga(e,r)&&(n=n.add(r))})),n}Xi(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ji(e,t,n){return Xs()<=D.DEBUG&&Ys("QueryEngine","Using full collection scan to execute query:",pa(t)),this.zi.getDocumentsMatchingQuery(e,t,ki.min(),n)}es(e,t,n,r){return this.zi.getDocumentsMatchingQuery(e,n,r).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}class Nu{constructor(e,t,n,r){this.persistence=e,this.ts=t,this.serializer=r,this.ns=new Qi(vi),this.rs=new va((e=>ta(e)),na),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(n)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new gu(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.ns)))}}async function Du(e,t){const n=si(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let r;return n.mutationQueue.getAllMutationBatches(e).next((s=>(r=s,n._s(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const s=[],i=[];let o=Ra();for(const e of r){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({us:e,removedBatchIds:s,addedBatchIds:i})))}))}))}function Ou(e){const t=si(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Qr.getLastRemoteSnapshotVersion(e)))}function Pu(e,t){const n=si(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function Lu(e,t,n){const r=si(e),s=r.ns.get(t),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(e=>r.persistence.referenceDelegate.removeTarget(e,s)))}catch(e){if(!Fi(e))throw e;Ys("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}r.ns=r.ns.remove(t),r.rs.delete(s.target)}function xu(e,t,n){const r=si(e);let s=Ei.min(),i=Ra();return r.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const r=si(e),s=r.rs.get(n);return void 0!==s?Pi.resolve(r.ns.get(s)):r.Qr.getTargetData(t,n)}(r,e,ua(t)).next((t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(e,t.targetId).next((e=>{i=e}))})).next((()=>r.ts.getDocumentsMatchingQuery(e,t,n?s:Ei.min(),n?i:Ra()))).next((e=>(function(e,t,n){let r=e.ss.get(t)||Ei.min();n.forEach(((e,t)=>{t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.ss.set(t,r)}(r,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,hs:i})))))}class Mu{constructor(){this.activeTargetIds=Na}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Uu{constructor(){this.no=new Mu,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,n){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new Mu,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Fu{io(e){}shutdown(){}}class Vu{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){Ys("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.uo)e(0)}ao(){Ys("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.uo)e(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Bu=null;function ju(){return null===Bu?Bu=268435456+Math.round(2147483648*Math.random()):Bu++,"0x"+Bu.toString(16)}const qu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class $u{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}}const zu="WebChannelConnection";class Ku extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=t+"://"+e.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(e,t,n,r,s){const i=ju(),o=this.bo(e,t.toUriEncodedString());Ys("RestConnection",`Sending RPC '${e}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,s),this.Co(e,o,a,n).then((t=>(Ys("RestConnection",`Received RPC '${e}' ${i}: `,t),t)),(t=>{throw ei("RestConnection",`RPC '${e}' ${i} failed with error: `,t,"url: ",o,"request:",n),t}))}vo(e,t,n,r,s,i){return this.So(e,t,n,r,s)}Do(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Qs,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}bo(e,t){const n=qu[e];return`${this.fo}/v1/${t}:${n}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,n,r){const s=ju();return new Promise(((i,o)=>{const a=new zs;a.setWithCredentials(!0),a.listenOnce(Bs.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Vs.NO_ERROR:const t=a.getResponseJson();Ys(zu,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case Vs.TIMEOUT:Ys(zu,`RPC '${e}' ${s} timed out`),o(new oi(ii.DEADLINE_EXCEEDED,"Request time out"));break;case Vs.HTTP_ERROR:const n=a.getStatus();if(Ys(zu,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(ii).indexOf(t)>=0?t:ii.UNKNOWN}(t.status);o(new oi(e,t.message))}else o(new oi(ii.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new oi(ii.UNAVAILABLE,"Connection failed."));break;default:ni()}}finally{Ys(zu,`RPC '${e}' ${s} completed.`)}}));const c=JSON.stringify(r);Ys(zu,`RPC '${e}' ${s} sending request:`,r),a.send(t,"POST",c,n,15)}))}Fo(e,t,n){const r=ju(),s=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=Us(),o=Fs(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const u=s.join("");Ys(zu,`Creating RPC '${e}' stream ${r}: ${u}`,a);const h=i.createWebChannel(u,a);let l=!1,d=!1;const f=new $u({lo:t=>{d?Ys(zu,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(l||(Ys(zu,`Opening RPC '${e}' stream ${r} transport.`),h.open(),l=!0),Ys(zu,`RPC '${e}' stream ${r} sending:`,t),h.send(t))},ho:()=>h.close()}),p=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return p(h,$s.EventType.OPEN,(()=>{d||Ys(zu,`RPC '${e}' stream ${r} transport opened.`)})),p(h,$s.EventType.CLOSE,(()=>{d||(d=!0,Ys(zu,`RPC '${e}' stream ${r} transport closed`),f.Vo())})),p(h,$s.EventType.ERROR,(t=>{d||(d=!0,ei(zu,`RPC '${e}' stream ${r} transport errored:`,t),f.Vo(new oi(ii.UNAVAILABLE,"The operation could not be completed")))})),p(h,$s.EventType.MESSAGE,(t=>{var n;if(!d){const s=t.data[0];ri(!!s);const i=s,o=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){Ys(zu,`RPC '${e}' stream ${r} received error:`,o);const t=o.status;let n=function(e){const t=dc[e];if(void 0!==t)return pc(t)}(t),s=o.message;void 0===n&&(n=ii.INTERNAL,s="Unknown error status: "+t+" with message "+o.message),d=!0,f.Vo(new oi(n,s)),h.close()}else Ys(zu,`RPC '${e}' stream ${r} received:`,s),f.mo(s)}})),p(o,js.STAT_EVENT,(t=>{t.stat===qs.PROXY?Ys(zu,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===qs.NOPROXY&&Ys(zu,`RPC '${e}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function Hu(){return"undefined"!=typeof document?document:null}function Gu(e){return new Oc(e,!0)}class Wu{constructor(e,t,n=1e3,r=1.5,s=6e4){this.oi=e,this.timerId=t,this.Mo=n,this.xo=r,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();const t=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Bo),r=Math.max(0,t-n);r>0&&Ys("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Bo=Date.now(),e()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Lo&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){null!==this.Lo&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}}class Qu{constructor(e,t,n,r,s,i,o,a){this.oi=e,this.$o=n,this.Uo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Wu(e,t)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(e){this.n_(),this.stream.send(e)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(e,t){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==e?this.jo.reset():t&&t.code===ii.RESOURCE_EXHAUSTED?(Zs(t.toString()),Zs("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===ii.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.To(t)}i_(){}auth(){this.state=1;const e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.Wo===t&&this.o_(e,n)}),(t=>{e((()=>{const e=new oi(ii.UNKNOWN,"Fetching auth token failed: "+t.message);return this.__(e)}))}))}o_(e,t){const n=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((e=>{n((()=>this.__(e)))})),this.stream.onMessage((e=>{n((()=>this.onMessage(e)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(e){return Ys("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget((()=>this.Wo===e?t():(Ys("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ju extends Qu{constructor(e,t,n,r,s,i){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:ni()}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],i=function(e,t){return e.useProto3Json?(ri(void 0===t||"string"==typeof t),no.fromBase64String(t||"")):(ri(void 0===t||t instanceof Uint8Array),no.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?ii.UNKNOWN:pc(e.code);return new oi(t,e.message||"")}(o);n=new Ic(r,s,i,a||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=qc(e,r.document.name),i=Uc(r.document.updateTime),o=r.document.createTime?Uc(r.document.createTime):Ei.min(),a=new Ro({mapValue:{fields:r.document.fields}}),c=Do.newFoundDocument(s,i,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new bc(u,h,c.key,c)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=qc(e,r.document),i=r.readTime?Uc(r.readTime):Ei.min(),o=Do.newNoDocument(s,i),a=r.removedTargetIds||[];n=new bc([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=qc(e,r.document),i=r.removedTargetIds||[];n=new bc([],i,s,null)}else{if(!("filter"in t))return ni();{t.filter;const e=t.filter;e.targetId;const{count:r=0,unchangedNames:s}=e,i=new lc(r,s),o=e.targetId;n=new Tc(o,i)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return Ei.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?Ei.min():t.readTime?Uc(t.readTime):Ei.min()}(e);return this.listener.u_(t,n)}c_(e){const t={};t.database=zc(this.serializer),t.addTarget=function(e,t){let n;const r=t.target;if(n=ra(r)?{documents:Gc(e,r)}:{query:Wc(e,r).ut},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=xc(e,t.resumeToken);const r=Pc(e,t.expectedCount);null!==r&&(n.expectedCount=r)}else if(t.snapshotVersion.compareTo(Ei.min())>0){n.readTime=Lc(e,t.snapshotVersion.toTimestamp());const r=Pc(e,t.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ni()}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.t_(t)}l_(e){const t={};t.database=zc(this.serializer),t.removeTarget=e,this.t_(t)}}class Xu extends Qu{constructor(e,t,n,r,s,i){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,i),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(ri(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();const t=function(e,t){return e&&e.length>0?(ri(void 0!==t),e.map((e=>function(e,t){let n=e.updateTime?Uc(e.updateTime):Uc(t);return n.isEqual(Ei.min())&&(n=Uc(t)),new Ha(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=Uc(e.commitTime);return this.listener.T_(n,t)}return ri(!e.writeResults||0===e.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const e={};e.database=zc(this.serializer),this.t_(e)}I_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>function(e,t){let n;if(t instanceof tc)n={update:Hc(e,t.key,t.value)};else if(t instanceof oc)n={delete:jc(e,t.key)};else if(t instanceof nc)n={update:Hc(e,t.key,t.data),updateMask:ru(t.fieldMask)};else{if(!(t instanceof ac))return ni();n={verify:jc(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Fa)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Va)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ja)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof $a)return{fieldPath:t.field.canonicalString(),increment:n.Ie};throw ni()}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Mc(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:ni()}(e,t.precondition)),n}(this.serializer,e)))};this.t_(t)}}class Yu extends class{}{constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new oi(ii.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.So(e,Vc(t,n),r,s,i))).catch((e=>{throw"FirebaseError"===e.name?(e.code===ii.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new oi(ii.UNKNOWN,e.toString())}))}vo(e,t,n,r,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.vo(e,Vc(t,n),r,i,o,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===ii.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new oi(ii.UNKNOWN,e.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class Zu{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(e){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,"Online"===e&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(Zs(t),this.g_=!1):Ys("OnlineStateTracker",t)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class eh{constructor(e,t,n,r,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io((e=>{n.enqueueAndForget((async()=>{uh(this)&&(Ys("RemoteStore","Restarting streams for network reachability change."),await async function(e){const t=si(e);t.v_.add(4),await nh(t),t.x_.set("Unknown"),t.v_.delete(4),await th(t)}(this))}))})),this.x_=new Zu(n,r)}}async function th(e){if(uh(e))for(const t of e.F_)await t(!0)}async function nh(e){for(const t of e.F_)await t(!1)}function rh(e,t){const n=si(e);n.C_.has(t.targetId)||(n.C_.set(t.targetId,t),ch(n)?ah(n):Ch(n).Jo()&&ih(n,t))}function sh(e,t){const n=si(e),r=Ch(n);n.C_.delete(t),r.Jo()&&oh(n,t),0===n.C_.size&&(r.Jo()?r.Xo():uh(n)&&n.x_.set("Unknown"))}function ih(e,t){if(e.O_.Oe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(Ei.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}Ch(e).c_(t)}function oh(e,t){e.O_.Oe(t),Ch(e).l_(t)}function ah(e){e.O_=new Cc({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),_t:t=>e.C_.get(t)||null,nt:()=>e.datastore.serializer.databaseId}),Ch(e).start(),e.x_.p_()}function ch(e){return uh(e)&&!Ch(e).Ho()&&e.C_.size>0}function uh(e){return 0===si(e).v_.size}function hh(e){e.O_=void 0}async function lh(e){e.C_.forEach(((t,n)=>{ih(e,t)}))}async function dh(e,t){hh(e),ch(e)?(e.x_.S_(t),ah(e)):e.x_.set("Unknown")}async function fh(e,t,n){if(e.x_.set("Online"),t instanceof Ic&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const r of t.targetIds)e.C_.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.C_.delete(r),e.O_.removeTarget(r))}(e,t)}catch(n){Ys("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),await ph(e,n)}else if(t instanceof bc?e.O_.$e(t):t instanceof Tc?e.O_.Je(t):e.O_.Ge(t),!n.isEqual(Ei.min()))try{const t=await Ou(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.O_.it(t);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.C_.get(r);s&&e.C_.set(r,s.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const r=e.C_.get(t);if(!r)return;e.C_.set(t,r.withResumeToken(no.EMPTY_BYTE_STRING,r.snapshotVersion)),oh(e,t);const s=new iu(r.target,t,n,r.sequenceNumber);ih(e,s)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){Ys("RemoteStore","Failed to raise snapshot:",t),await ph(e,t)}}async function ph(e,t,n){if(!Fi(t))throw t;e.v_.add(1),await nh(e),e.x_.set("Offline"),n||(n=()=>Ou(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{Ys("RemoteStore","Retrying IndexedDB access"),await n(),e.v_.delete(1),await th(e)}))}function gh(e,t){return t().catch((n=>ph(e,n,t)))}async function mh(e){const t=si(e),n=Ah(t);let r=t.D_.length>0?t.D_[t.D_.length-1].batchId:-1;for(;yh(t);)try{const e=await Pu(t.localStore,r);if(null===e){0===t.D_.length&&n.Xo();break}r=e.batchId,vh(t,e)}catch(e){await ph(t,e)}wh(t)&&_h(t)}function yh(e){return uh(e)&&e.D_.length<10}function vh(e,t){e.D_.push(t);const n=Ah(e);n.Jo()&&n.P_&&n.I_(t.mutations)}function wh(e){return uh(e)&&!Ah(e).Ho()&&e.D_.length>0}function _h(e){Ah(e).start()}async function Eh(e){Ah(e).d_()}async function bh(e){const t=Ah(e);for(const n of e.D_)t.I_(n.mutations)}async function Th(e,t,n){const r=e.D_.shift(),s=uc.from(r,t,n);await gh(e,(()=>e.remoteSyncer.applySuccessfulWrite(s))),await mh(e)}async function Ih(e,t){t&&Ah(e).P_&&await async function(e,t){if(function(e){return function(e){switch(e){default:return ni();case ii.CANCELLED:case ii.UNKNOWN:case ii.DEADLINE_EXCEEDED:case ii.RESOURCE_EXHAUSTED:case ii.INTERNAL:case ii.UNAVAILABLE:case ii.UNAUTHENTICATED:return!1;case ii.INVALID_ARGUMENT:case ii.NOT_FOUND:case ii.ALREADY_EXISTS:case ii.PERMISSION_DENIED:case ii.FAILED_PRECONDITION:case ii.ABORTED:case ii.OUT_OF_RANGE:case ii.UNIMPLEMENTED:case ii.DATA_LOSS:return!0}}(e)&&e!==ii.ABORTED}(t.code)){const n=e.D_.shift();Ah(e).Zo(),await gh(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await mh(e)}}(e,t),wh(e)&&_h(e)}async function Sh(e,t){const n=si(e);n.asyncQueue.verifyOperationInProgress(),Ys("RemoteStore","RemoteStore received new credentials");const r=uh(n);n.v_.add(3),await nh(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.v_.delete(3),await th(n)}function Ch(e){return e.N_||(e.N_=function(e,t,n){const r=si(e);return r.R_(),new Ju(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:lh.bind(null,e),To:dh.bind(null,e),u_:fh.bind(null,e)}),e.F_.push((async t=>{t?(e.N_.Zo(),ch(e)?ah(e):e.x_.set("Unknown")):(await e.N_.stop(),hh(e))}))),e.N_}function Ah(e){return e.L_||(e.L_=function(e,t,n){const r=si(e);return r.R_(),new Xu(t,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(e.datastore,e.asyncQueue,{Po:Eh.bind(null,e),To:Ih.bind(null,e),E_:bh.bind(null,e),T_:Th.bind(null,e)}),e.F_.push((async t=>{t?(e.L_.Zo(),await mh(e)):(await e.L_.stop(),e.D_.length>0&&(Ys("RemoteStore",`Stopping write stream with ${e.D_.length} pending writes`),e.D_=[]))}))),e.L_}class kh{constructor(e,t,n,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new ai,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,s){const i=Date.now()+n,o=new kh(e,t,i,r,s);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new oi(ii.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Rh(e,t){if(Zs("AsyncQueue",`${t}: ${e}`),Fi(e))return new oi(ii.UNAVAILABLE,`${t}: ${e}`);throw e}class Nh{constructor(e){this.comparator=e?(t,n)=>e(t,n)||Ci.comparator(t.key,n.key):(e,t)=>Ci.comparator(e.key,t.key),this.keyedMap=ba(),this.sortedSet=new Qi(this.comparator)}static emptySet(e){return new Nh(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Nh))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new Nh;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class Dh{constructor(){this.B_=new Qi(Ci.comparator)}track(e){const t=e.doc.key,n=this.B_.get(t);n?0!==e.type&&3===n.type?this.B_=this.B_.insert(t,e):3===e.type&&1!==n.type?this.B_=this.B_.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.B_=this.B_.remove(t):1===e.type&&2===n.type?this.B_=this.B_.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):ni():this.B_=this.B_.insert(t,e)}k_(){const e=[];return this.B_.inorderTraversal(((t,n)=>{e.push(n)})),e}}class Oh{constructor(e,t,n,r,s,i,o,a,c){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(e,t,n,r,s){const i=[];return t.forEach((e=>{i.push({type:0,doc:e})})),new Oh(e,t,Nh.emptySet(t),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&da(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class Ph{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some((e=>e.U_()))}}class Lh{constructor(){this.queries=new va((e=>fa(e)),da),this.onlineState="Unknown",this.W_=new Set}}function xh(e,t){const n=si(e);let r=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.Q_)t.z_(e)&&(r=!0);s.q_=e}}r&&Uh(n)}function Mh(e,t,n){const r=si(e),s=r.queries.get(t);if(s)for(const e of s.Q_)e.onError(n);r.queries.delete(t)}function Uh(e){e.W_.forEach((e=>{e.next()}))}var Fh,Vh;(Vh=Fh||(Fh={})).j_="default",Vh.Cache="cache";class Bh{constructor(e,t,n){this.query=e,this.H_=t,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=n||{}}z_(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new Oh(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.J_?this.Z_(e)&&(this.H_.next(e),t=!0):this.X_(e,this.onlineState)&&(this.ea(e),t=!0),this.Y_=e,t}onError(e){this.H_.error(e)}G_(e){this.onlineState=e;let t=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,e)&&(this.ea(this.Y_),t=!0),t}X_(e,t){if(!e.fromCache)return!0;if(!this.U_())return!0;const n="Offline"!==t;return(!this.options.ta||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Z_(e){if(e.docChanges.length>0)return!0;const t=this.Y_&&this.Y_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ea(e){e=Oh.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.J_=!0,this.H_.next(e)}U_(){return this.options.source!==Fh.Cache}}class jh{constructor(e){this.key=e}}class qh{constructor(e){this.key=e}}class $h{constructor(e,t){this.query=e,this.ua=t,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=Ra(),this.mutatedKeys=Ra(),this.ha=ma(e),this.Pa=new Nh(this.ha)}get Ia(){return this.ua}Ta(e,t){const n=t?t.Ea:new Dh,r=t?t.Pa:this.Pa;let s=t?t.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal(((e,t)=>{const u=r.get(e),h=ga(this.query,t)?t:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.da(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.ha(h,a)>0||c&&this.ha(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),s=d?s.add(e):s.delete(e)):(i=i.delete(e),s=s.delete(e)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const e="F"===this.query.limitType?i.last():i.first();i=i.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{Pa:i,Ea:n,Xi:o,mutatedKeys:s}}da(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){const s=this.Pa;this.Pa=e.Pa,this.mutatedKeys=e.mutatedKeys;const i=e.Ea.k_();i.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ni()}};return n(e)-n(t)}(e.type,t.type)||this.ha(e.doc,t.doc))),this.Aa(n),r=null!=r&&r;const o=t&&!r?this.Ra():[],a=0===this.la.size&&this.current&&!r?1:0,c=a!==this.ca;return this.ca=a,0!==i.length||c?{snapshot:new Oh(this.query,e.Pa,s,i,e.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),Va:o}:{Va:o}}G_(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new Dh,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(e){return!this.ua.has(e)&&!!this.Pa.has(e)&&!this.Pa.get(e).hasLocalMutations}Aa(e){e&&(e.addedDocuments.forEach((e=>this.ua=this.ua.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.ua=this.ua.delete(e))),this.current=e.current)}Ra(){if(!this.current)return[];const e=this.la;this.la=Ra(),this.Pa.forEach((e=>{this.ma(e.key)&&(this.la=this.la.add(e.key))}));const t=[];return e.forEach((e=>{this.la.has(e)||t.push(new qh(e))})),this.la.forEach((n=>{e.has(n)||t.push(new jh(n))})),t}fa(e){this.ua=e.hs,this.la=Ra();const t=this.Ta(e.documents);return this.applyChanges(t,!0)}ga(){return Oh.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,0===this.ca,this.hasCachedResults)}}class zh{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Kh{constructor(e){this.key=e,this.pa=!1}}class Hh{constructor(e,t,n,r,s,i){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.ya={},this.wa=new va((e=>fa(e)),da),this.Sa=new Map,this.ba=new Set,this.Da=new Qi(Ci.comparator),this.Ca=new Map,this.va=new vu,this.Fa={},this.Ma=new Map,this.xa=du.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return!0===this.Oa}}async function Gh(e,t,n=!0){const r=fl(e);let s;const i=r.wa.get(t);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.ga()):s=await Qh(r,t,n,!0),s}async function Wh(e,t){const n=fl(e);await Qh(n,t,!0,!1)}async function Qh(e,t,n,r){const s=await function(e,t){const n=si(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let r;return n.Qr.getTargetData(e,t).next((s=>s?(r=s,Pi.resolve(r)):n.Qr.allocateTargetId(e).next((s=>(r=new iu(t,s,"TargetPurposeListen",e.currentSequenceNumber),n.Qr.addTargetData(e,r).next((()=>r)))))))})).then((e=>{const r=n.ns.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(e.targetId,e),n.rs.set(t,e.targetId)),e}))}(e.localStore,ua(t)),i=s.targetId,o=n?e.sharedClientState.addLocalQueryTarget(i):"not-current";let a;return r&&(a=await async function(e,t,n,r,s){e.Na=(t,n,r)=>async function(e,t,n,r){let s=t.view.Ta(n);s.Xi&&(s=await xu(e.localStore,t.query,!1).then((({documents:e})=>t.view.Ta(e,s))));const i=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(s,e.isPrimaryClient,i,o);return al(e,t.targetId,a.Va),a.snapshot}(e,t,n,r);const i=await xu(e.localStore,t,!0),o=new $h(t,i.hs),a=o.Ta(i.documents),c=Ec.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,s),u=o.applyChanges(a,e.isPrimaryClient,c);al(e,n,u.Va);const h=new zh(t,n,o);return e.wa.set(t,h),e.Sa.has(n)?e.Sa.get(n).push(t):e.Sa.set(n,[t]),u.snapshot}(e,t,i,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&rh(e.remoteStore,s),a}async function Jh(e,t,n){const r=si(e),s=r.wa.get(t),i=r.Sa.get(s.targetId);if(i.length>1)return r.Sa.set(s.targetId,i.filter((e=>!da(e,t)))),void r.wa.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Lu(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),n&&sh(r.remoteStore,s.targetId),il(r,s.targetId)})).catch(Oi)):(il(r,s.targetId),await Lu(r.localStore,s.targetId,!0))}async function Xh(e,t){const n=si(e),r=n.wa.get(t),s=n.Sa.get(r.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),sh(n.remoteStore,r.targetId))}async function Yh(e,t){const n=si(e);try{const e=await function(e,t){const n=si(e),r=t.snapshotVersion;let s=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const i=n.os.newChangeBuffer({trackRemovals:!0});s=n.ns;const o=[];t.targetChanges.forEach(((i,a)=>{const c=s.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(e,i.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(e,i.addedDocuments,a))));let u=c.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?u=u.withResumeToken(no.EMPTY_BYTE_STRING,Ei.min()).withLastLimboFreeSnapshotVersion(Ei.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,r)),s=s.insert(a,u),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,i)&&o.push(n.Qr.updateTargetData(e,u))}));let a=_a(),c=Ra();if(t.documentUpdates.forEach((r=>{t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(function(e,t,n){let r=Ra(),s=Ra();return n.forEach((e=>r=r.add(e))),t.getEntries(e,r).next((e=>{let r=_a();return n.forEach(((n,i)=>{const o=e.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(Ei.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):Ys("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{cs:r,ls:s}}))}(e,i,t.documentUpdates).next((e=>{a=e.cs,c=e.ls}))),!r.isEqual(Ei.min())){const t=n.Qr.getLastRemoteSnapshotVersion(e).next((t=>n.Qr.setTargetsMetadata(e,e.currentSequenceNumber,r)));o.push(t)}return Pi.waitFor(o).next((()=>i.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,c))).next((()=>a))})).then((e=>(n.ns=s,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const r=n.Ca.get(t);r&&(ri(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?r.pa=!0:e.modifiedDocuments.size>0?ri(r.pa):e.removedDocuments.size>0&&(ri(r.pa),r.pa=!1))})),await hl(n,e,t)}catch(e){await Oi(e)}}function Zh(e,t,n){const r=si(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const e=[];r.wa.forEach(((n,r)=>{const s=r.view.G_(t);s.snapshot&&e.push(s.snapshot)})),function(e,t){const n=si(e);n.onlineState=t;let r=!1;n.queries.forEach(((e,n)=>{for(const e of n.Q_)e.G_(t)&&(r=!0)})),r&&Uh(n)}(r.eventManager,t),e.length&&r.ya.u_(e),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function el(e,t,n){const r=si(e);r.sharedClientState.updateQueryState(t,"rejected",n);const s=r.Ca.get(t),i=s&&s.key;if(i){let e=new Qi(Ci.comparator);e=e.insert(i,Do.newNoDocument(i,Ei.min()));const n=Ra().add(i),s=new _c(Ei.min(),new Map,new Qi(vi),e,n);await Yh(r,s),r.Da=r.Da.remove(i),r.Ca.delete(t),ul(r)}else await Lu(r.localStore,t,!1).then((()=>il(r,t,n))).catch(Oi)}async function tl(e,t){const n=si(e),r=t.batch.batchId;try{const e=await function(e,t){const n=si(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const r=t.batch.keys(),s=n.os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){const s=n.batch,i=s.keys();let o=Pi.resolve();return i.forEach((e=>{o=o.next((()=>r.getEntry(t,e))).next((t=>{const i=n.docVersions.get(e);ri(null!==i),t.version.compareTo(i)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,s)))}(n,e,t,s).next((()=>s.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Ra();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(n.localStore,t);sl(n,r,null),rl(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await hl(n,e)}catch(e){await Oi(e)}}async function nl(e,t,n){const r=si(e);try{const e=await function(e,t){const n=si(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let r;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(ri(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,r,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r))).next((()=>n.localDocuments.getDocuments(e,r)))}))}(r.localStore,t);sl(r,t,n),rl(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),await hl(r,e)}catch(n){await Oi(n)}}function rl(e,t){(e.Ma.get(t)||[]).forEach((e=>{e.resolve()})),e.Ma.delete(t)}function sl(e,t,n){const r=si(e);let s=r.Fa[r.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),r.Fa[r.currentUser.toKey()]=s}}function il(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const r of e.Sa.get(t))e.wa.delete(r),n&&e.ya.La(r,n);e.Sa.delete(t),e.isPrimaryClient&&e.va.Vr(t).forEach((t=>{e.va.containsKey(t)||ol(e,t)}))}function ol(e,t){e.ba.delete(t.path.canonicalString());const n=e.Da.get(t);null!==n&&(sh(e.remoteStore,n),e.Da=e.Da.remove(t),e.Ca.delete(n),ul(e))}function al(e,t,n){for(const r of n)r instanceof jh?(e.va.addReference(r.key,t),cl(e,r)):r instanceof qh?(Ys("SyncEngine","Document no longer in limbo: "+r.key),e.va.removeReference(r.key,t),e.va.containsKey(r.key)||ol(e,r.key)):ni()}function cl(e,t){const n=t.key,r=n.path.canonicalString();e.Da.get(n)||e.ba.has(r)||(Ys("SyncEngine","New document in limbo: "+n),e.ba.add(r),ul(e))}function ul(e){for(;e.ba.size>0&&e.Da.size<e.maxConcurrentLimboResolutions;){const t=e.ba.values().next().value;e.ba.delete(t);const n=new Ci(Ti.fromString(t)),r=e.xa.next();e.Ca.set(r,new Kh(n)),e.Da=e.Da.insert(n,r),rh(e.remoteStore,new iu(ua(ia(n.path)),r,"TargetPurposeLimboResolution",$i._e))}}async function hl(e,t,n){const r=si(e),s=[],i=[],o=[];r.wa.isEmpty()||(r.wa.forEach(((e,a)=>{o.push(r.Na(a,t,n).then((e=>{if((e||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==e?void 0:e.fromCache)?"not-current":"current"),e){s.push(e);const t=Au.Ki(a.targetId,e);i.push(t)}})))})),await Promise.all(o),r.ya.u_(s),await async function(e,t){const n=si(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Pi.forEach(t,(t=>Pi.forEach(t.qi,(r=>n.persistence.referenceDelegate.addReference(e,t.targetId,r))).next((()=>Pi.forEach(t.Qi,(r=>n.persistence.referenceDelegate.removeReference(e,t.targetId,r)))))))))}catch(e){if(!Fi(e))throw e;Ys("LocalStore","Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.ns.get(t),r=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(t,s)}}}(r.localStore,i))}async function ll(e,t){const n=si(e);if(!n.currentUser.isEqual(t)){Ys("SyncEngine","User change. New user:",t.toKey());const e=await Du(n.localStore,t);n.currentUser=t,function(e,t){e.Ma.forEach((e=>{e.forEach((e=>{e.reject(new oi(ii.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Ma.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await hl(n,e.us)}}function dl(e,t){const n=si(e),r=n.Ca.get(t);if(r&&r.pa)return Ra().add(r.key);{let e=Ra();const r=n.Sa.get(t);if(!r)return e;for(const t of r){const r=n.wa.get(t);e=e.unionWith(r.view.Ia)}return e}}function fl(e){const t=si(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=Yh.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=dl.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=el.bind(null,t),t.ya.u_=xh.bind(null,t.eventManager),t.ya.La=Mh.bind(null,t.eventManager),t}function pl(e){const t=si(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=tl.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=nl.bind(null,t),t}class gl{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Gu(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return function(e,t,n,r){return new Nu(e,t,n,r)}(this.persistence,new Ru,e.initialUser,this.serializer)}createPersistence(e){return new Iu(Cu.Hr,this.serializer)}createSharedClientState(e){return new Uu}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class ml{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Zh(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=ll.bind(null,this.syncEngine),await async function(e,t){const n=si(e);t?(n.v_.delete(2),await th(n)):t||(n.v_.add(2),await nh(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new Lh}createDatastore(e){const t=Gu(e.databaseInfo.databaseId),n=function(e){return new Ku(e)}(e.databaseInfo);return function(e,t,n,r){return new Yu(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,r,s){return new eh(e,t,n,r,s)}(this.localStore,this.datastore,e.asyncQueue,(e=>Zh(this.syncEngine,e,0)),Vu.D()?new Vu:new Fu)}createSyncEngine(e,t){return function(e,t,n,r,s,i,o){const a=new Hh(e,t,n,r,s,i);return o&&(a.Oa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e;await async function(e){const t=si(e);Ys("RemoteStore","RemoteStore shutting down."),t.v_.add(5),await nh(t),t.M_.shutdown(),t.x_.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate()}}class yl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.qa(this.observer.next,e)}error(e){this.observer.error?this.qa(this.observer.error,e):Zs("Uncaught Error in snapshot listener:",e.toString())}Qa(){this.muted=!0}qa(e,t){this.muted||setTimeout((()=>{this.muted||e(t)}),0)}}class vl{constructor(e,t,n,r){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=Ws.UNAUTHENTICATED,this.clientId=yi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async e=>{Ys("FirestoreClient","Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(Ys("FirestoreClient","Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new oi(ii.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ai;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=Rh(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function wl(e,t){e.asyncQueue.verifyOperationInProgress(),Ys("FirestoreClient","Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener((async e=>{r.isEqual(e)||(await Du(t.localStore,e),r=e)})),t.persistence.setDatabaseDeletedListener((()=>e.terminate())),e._offlineComponents=t}async function _l(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){Ys("FirestoreClient","Using user provided OfflineComponentProvider");try{await wl(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===ii.FAILED_PRECONDITION||e.code===ii.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;ei("Error using user provided cache. Falling back to memory cache: "+n),await wl(e,new gl)}}else Ys("FirestoreClient","Using default OfflineComponentProvider"),await wl(e,new gl);return e._offlineComponents}(e);Ys("FirestoreClient","Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Sh(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Sh(t.remoteStore,n))),e._onlineComponents=t}async function El(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(Ys("FirestoreClient","Using user provided OnlineComponentProvider"),await _l(e,e._uninitializedComponentsProvider._online)):(Ys("FirestoreClient","Using default OnlineComponentProvider"),await _l(e,new ml))),e._onlineComponents}async function bl(e){const t=await El(e),n=t.eventManager;return n.onListen=Gh.bind(null,t.syncEngine),n.onUnlisten=Jh.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=Wh.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Xh.bind(null,t.syncEngine),n}function Tl(e,t,n={}){const r=new ai;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,r,s){const i=new yl({next:n=>{t.enqueueAndForget((()=>async function(e,t){const n=si(e),r=t.query;let s=3;const i=n.queries.get(r);if(i){const e=i.Q_.indexOf(t);e>=0&&(i.Q_.splice(e,1),0===i.Q_.length?s=t.U_()?0:1:!i.K_()&&t.U_()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(e,o))),n.fromCache&&"server"===r.source?s.reject(new oi(ii.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),o=new Bh(n,i,{includeMetadataChanges:!0,ta:!0});return async function(e,t){const n=si(e);let r=3;const s=t.query;let i=n.queries.get(s);i?!i.K_()&&t.U_()&&(r=2):(i=new Ph,r=t.U_()?0:1);try{switch(r){case 0:i.q_=await n.onListen(s,!0);break;case 1:i.q_=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(e){const n=Rh(e,`Initialization of query '${pa(t.query)}' failed`);return void t.onError(n)}n.queries.set(s,i),i.Q_.push(t),t.G_(n.onlineState),i.q_&&t.z_(i.q_)&&Uh(n)}(e,o)}(await bl(e),e.asyncQueue,t,n,r))),r.promise}function Il(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Sl=new Map;function Cl(e,t,n){if(!n)throw new oi(ii.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function Al(e){if(!Ci.isDocumentKey(e))throw new oi(ii.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function kl(e){if(Ci.isDocumentKey(e))throw new oi(ii.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function Rl(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":ni()}function Nl(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new oi(ii.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Rl(e);throw new oi(ii.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}class Dl{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new oi(ii.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new oi(ii.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new oi(ii.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Il(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new oi(ii.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new oi(ii.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new oi(ii.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ol{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Dl({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new oi(ii.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new oi(ii.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Dl(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ui;switch(e.type){case"firstParty":return new fi(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new oi(ii.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Sl.get(e);t&&(Ys("ComponentProvider","Removing Datastore"),Sl.delete(e),t.terminate())}(this),Promise.resolve()}}class Pl{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new Pl(this.firestore,e,this._query)}}class Ll{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new xl(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ll(this.firestore,e,this._key)}}class xl extends Pl{constructor(e,t,n){super(e,t,ia(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ll(this.firestore,null,new Ci(e))}withConverter(e){return new xl(this.firestore,e,this._path)}}function Ml(e,t,...n){if(e=S(e),Cl("collection","path",t),e instanceof Ol){const r=Ti.fromString(t,...n);return kl(r),new xl(e,null,r)}{if(!(e instanceof Ll||e instanceof xl))throw new oi(ii.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Ti.fromString(t,...n));return kl(r),new xl(e.firestore,null,r)}}function Ul(e,t,...n){if(e=S(e),1===arguments.length&&(t=yi.newId()),Cl("doc","path",t),e instanceof Ol){const r=Ti.fromString(t,...n);return Al(r),new Ll(e,null,new Ci(r))}{if(!(e instanceof Ll||e instanceof xl))throw new oi(ii.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Ti.fromString(t,...n));return Al(r),new Ll(e.firestore,e instanceof xl?e.converter:null,new Ci(r))}}class Fl{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new Wu(this,"async_queue_retry"),this.cu=()=>{const e=Hu();e&&Ys("AsyncQueue","Visibility state changed to "+e.visibilityState),this.jo.Ko()};const e=Hu();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.lu(),this.hu(e)}enterRestrictedMode(e){if(!this.iu){this.iu=!0,this.au=e||!1;const t=Hu();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.cu)}}enqueue(e){if(this.lu(),this.iu)return new Promise((()=>{}));const t=new ai;return this.hu((()=>this.iu&&this.au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.ru.push(e),this.Pu())))}async Pu(){if(0!==this.ru.length){try{await this.ru[0](),this.ru.shift(),this.jo.reset()}catch(e){if(!Fi(e))throw e;Ys("AsyncQueue","Operation failed with retryable error: "+e)}this.ru.length>0&&this.jo.qo((()=>this.Pu()))}}hu(e){const t=this.nu.then((()=>(this._u=!0,e().catch((e=>{this.ou=e,this._u=!1;const t=function(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Zs("INTERNAL UNHANDLED ERROR: ",t),e})).then((e=>(this._u=!1,e))))));return this.nu=t,t}enqueueAfterDelay(e,t,n){this.lu(),this.uu.indexOf(e)>-1&&(t=0);const r=kh.createAndSchedule(this,e,t,n,(e=>this.Iu(e)));return this.su.push(r),r}lu(){this.ou&&ni()}verifyOperationInProgress(){}async Tu(){let e;do{e=this.nu,await e}while(e!==this.nu)}Eu(e){for(const t of this.su)if(t.timerId===e)return!0;return!1}du(e){return this.Tu().then((()=>{this.su.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.su)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tu()}))}Au(e){this.uu.push(e)}Iu(e){const t=this.su.indexOf(e);this.su.splice(t,1)}}class Vl extends Ol{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new Fl,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||jl(this),this._firestoreClient.terminate()}}function Bl(e){return e._firestoreClient||jl(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function jl(e){var t,n,r;const s=e._freezeSettings(),i=function(e,t,n,r){return new ho(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,Il(r.experimentalLongPollingOptions),r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s);e._firestoreClient=new vl(e._authCredentials,e._appCheckCredentials,e._queue,i),(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(e._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class ql{constructor(e){this._byteString=e}static fromBase64String(e){try{return new ql(no.fromBase64String(e))}catch(e){throw new oi(ii.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new ql(no.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class $l{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new oi(ii.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Si(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class zl{constructor(e){this._methodName=e}}class Kl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new oi(ii.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new oi(ii.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return vi(this._lat,e._lat)||vi(this._long,e._long)}}const Hl=/^__.*__$/;class Gl{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new nc(e,this.data,this.fieldMask,t,this.fieldTransforms):new tc(e,this.data,t,this.fieldTransforms)}}function Wl(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ni()}}class Ql{constructor(e,t,n,r,s,i){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.Ru(),this.fieldTransforms=s||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(e){return new Ql(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.mu({path:n,gu:!1});return r.pu(e),r}yu(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.mu({path:n,gu:!1});return r.Ru(),r}wu(e){return this.mu({path:void 0,gu:!0})}Su(e){return od(e,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Ru(){if(this.path)for(let e=0;e<this.path.length;e++)this.pu(this.path.get(e))}pu(e){if(0===e.length)throw this.Su("Document fields must not be empty");if(Wl(this.Vu)&&Hl.test(e))throw this.Su('Document fields cannot begin and end with "__"')}}class Jl{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||Gu(e)}Cu(e,t,n,r=!1){return new Ql({Vu:e,methodName:t,Du:n,path:Si.emptyPath(),gu:!1,bu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Xl(e){const t=e._freezeSettings(),n=Gu(e._databaseId);return new Jl(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Yl(e,t,n,r,s,i={}){const o=e.Cu(i.merge||i.mergeFields?2:0,t,n,s);nd("Data must be an object, but it was:",o,r);const a=ed(r,o);let c,u;if(i.merge)c=new eo(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const e=[];for(const r of i.mergeFields){const s=rd(t,r,n);if(!o.contains(s))throw new oi(ii.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);ad(e,s)||e.push(s)}c=new eo(e),u=o.fieldTransforms.filter((e=>c.covers(e.field)))}else c=null,u=o.fieldTransforms;return new Gl(new Ro(a),c,u)}function Zl(e,t){if(td(e=S(e)))return nd("Unsupported field value:",t,e),ed(e,t);if(e instanceof zl)return function(e,t){if(!Wl(t.Vu))throw t.Su(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Su(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.gu&&4!==t.Vu)throw t.Su("Nested arrays are not supported");return function(e,t){const n=[];let r=0;for(const s of e){let e=Zl(s,t.wu(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=S(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Pa(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=_i.fromDate(e);return{timestampValue:Lc(t.serializer,n)}}if(e instanceof _i){const n=new _i(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Lc(t.serializer,n)}}if(e instanceof Kl)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof ql)return{bytesValue:xc(t.serializer,e._byteString)};if(e instanceof Ll){const n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Su(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Fc(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Su(`Unsupported field value: ${Rl(e)}`)}(e,t)}function ed(e,t){const n={};return Wi(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Gi(e,((e,r)=>{const s=Zl(r,t.fu(e));null!=s&&(n[e]=s)})),{mapValue:{fields:n}}}function td(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof _i||e instanceof Kl||e instanceof ql||e instanceof Ll||e instanceof zl)}function nd(e,t,n){if(!td(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){const r=Rl(n);throw"an object"===r?t.Su(e+" a custom object"):t.Su(e+" "+r)}}function rd(e,t,n){if((t=S(t))instanceof $l)return t._internalPath;if("string"==typeof t)return id(e,t);throw od("Field path arguments must be of type string or ",e,!1,void 0,n)}const sd=new RegExp("[~\\*/\\[\\]]");function id(e,t,n){if(t.search(sd)>=0)throw od(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new $l(...t.split("."))._internalPath}catch(r){throw od(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function od(e,t,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${r}`),o&&(c+=` in document ${s}`),c+=")"),new oi(ii.INVALID_ARGUMENT,a+e+c)}function ad(e,t){return e.some((e=>e.isEqual(t)))}class cd{constructor(e,t,n,r,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ll(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new ud(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(hd("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class ud extends cd{data(){return super.data()}}function hd(e,t){return"string"==typeof t?id(e,t):t instanceof $l?t._internalPath:t._delegate._internalPath}class ld{}class dd extends ld{}class fd extends dd{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new fd(e,t,n)}_apply(e){const t=this._parse(e);return yd(e._query,t),new Pl(e.firestore,e.converter,ha(e._query,t))}_parse(e){const t=Xl(e.firestore),n=function(e,t,n,r,s,i,o){let a;if(s.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new oi(ii.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){md(o,i);const t=[];for(const n of o)t.push(gd(r,e,n));a={arrayValue:{values:t}}}else a=gd(r,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||md(o,i),a=function(e,t,n,r=!1){return Zl(n,e.Cu(r?4:3,t))}(n,"where",o,"in"===i||"not-in"===i);return Fo.create(s,i,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}class pd extends ld{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new pd(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Vo.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const r=t.getFlattenedFilters();for(const e of r)yd(n,e),n=ha(n,e)}(e._query,t),new Pl(e.firestore,e.converter,ha(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function gd(e,t,n){if("string"==typeof(n=S(n))){if(""===n)throw new oi(ii.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!aa(t)&&-1!==n.indexOf("/"))throw new oi(ii.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=t.path.child(Ti.fromString(n));if(!Ci.isDocumentKey(r))throw new oi(ii.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Eo(e,new Ci(r))}if(n instanceof Ll)return Eo(e,n._key);throw new oi(ii.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Rl(n)}.`)}function md(e,t){if(!Array.isArray(e)||0===e.length)throw new oi(ii.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function yd(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new oi(ii.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new oi(ii.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class vd{convertValue(e,t="none"){switch(po(e)){case 0:return null;case 1:return e.booleanValue;case 2:return io(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(oo(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw ni()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Gi(e,((e,r)=>{n[e]=this.convertValue(r,t)})),n}convertGeoPoint(e){return new Kl(io(e.latitude),io(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=co(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(uo(e));default:return null}}convertTimestamp(e){const t=so(e);return new _i(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=Ti.fromString(e);ri(su(n));const r=new lo(n.get(1),n.get(3)),s=new Ci(n.popFirst(5));return r.isEqual(t)||Zs(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function wd(e,t,n){let r;return r=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,r}class _d{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ed extends cd{constructor(e,t,n,r,s,i){super(e,t,n,r,i),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new bd(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(hd("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}class bd extends Ed{data(e={}){return super.data(e)}}class Td{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new _d(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new bd(this._firestore,this._userDataWriter,n.key,n,new _d(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new oi(ii.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const r=new bd(e._firestore,e._userDataWriter,n.doc.key,n.doc,new _d(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const r=new bd(e._firestore,e._userDataWriter,t.doc.key,t.doc,new _d(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,i=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),i=n.indexOf(t.doc.key)),{type:Id(t.type),doc:r,oldIndex:s,newIndex:i}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Id(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ni()}}class Sd extends vd{constructor(e){super(),this.firestore=e}convertBytes(e){return new ql(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ll(this.firestore,null,t)}}function Cd(e){e=Nl(e,Pl);const t=Nl(e.firestore,Vl),n=Bl(t),r=new Sd(t);return function(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new oi(ii.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(e._query),Tl(n,e._query).then((n=>new Td(t,r,e,n)))}function Ad(e,t){return function(e,t){const n=new ai;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const r=pl(e);try{const e=await function(e,t){const n=si(e),r=_i.now(),s=t.reduce(((e,t)=>e.add(t.key)),Ra());let i,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=_a(),c=Ra();return n.os.getEntries(e,s).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(c=c.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((s=>{i=s;const o=[];for(const e of t){const t=Za(e,i.get(e.key).overlayedDocument);null!=t&&o.push(new nc(e.key,t,No(t.value.mapValue),Ga.exists(!0)))}return n.mutationQueue.addMutationBatch(e,r,o,t)})).next((t=>{o=t;const r=t.applyToLocalDocumentSet(i,c);return n.documentOverlayCache.saveOverlays(e,t.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:Ta(i)})))}(r.localStore,t);r.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let r=e.Fa[e.currentUser.toKey()];r||(r=new Qi(vi)),r=r.insert(t,n),e.Fa[e.currentUser.toKey()]=r}(r,e.batchId,n),await hl(r,e.changes),await mh(r.remoteStore)}catch(e){const t=Rh(e,"Failed to persist write");n.reject(t)}}(await function(e){return El(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(Bl(e),t)}function kd(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(e);s<r.length;s++)t.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(e,r[s])&&(n[r[s]]=e[r[s]])}return n}new WeakMap,function(e,t=!0){!function(e){Qs=e}(pe),he(new C("firestore",((e,{instanceIdentifier:n,options:r})=>{const s=e.getProvider("app").getImmediate(),i=new Vl(new li(e.getProvider("auth-internal")),new gi(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new oi(ii.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new lo(e.options.projectId,t)}(s,n),s);return r=Object.assign({useFetchStreams:t},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),ye(Gs,"4.5.0",e),ye(Gs,"4.5.0","esm2017")}(),Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const Rd=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},Nd=new m("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Dd=new U("@firebase/auth");function Od(e,...t){Dd.logLevel<=D.ERROR&&Dd.error(`Auth (${pe}): ${e}`,...t)}function Pd(e,...t){throw xd(e,...t)}function Ld(e,...t){return xd(e,...t)}function xd(e,...t){if("string"!=typeof e){const n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return Nd.create(e,...t)}function Md(e,t,...n){if(!e)throw xd(t,...n)}function Ud(e){const t="INTERNAL ASSERTION FAILED: "+e;throw Od(t),new Error(t)}function Fd(e,t){e||Ud(t)}function Vd(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Bd(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}function jd(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Bd()||"https:"===Bd()||function(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}()||"connection"in navigator))||navigator.onLine}class qd{constructor(e,t){this.shortDelay=e,this.longDelay=t,Fd(t>e,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(f())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return jd()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function $d(e,t){Fd(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class zd{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void Ud("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void Ud("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void Ud("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Kd={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Hd=new qd(3e4,6e4);function Gd(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function Wd(e,t,n,r,s={}){return Qd(e,s,(async()=>{let s={},i={};r&&("GET"===t?i=r:s={body:JSON.stringify(r)});const o=_(Object.assign({key:e.config.apiKey},i)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),zd.fetch()(Xd(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},s))}))}async function Qd(e,t,n){e._canInitEmulator=!1;const r=Object.assign(Object.assign({},Kd),t);try{const t=new Zd(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const i=await s.json();if("needConfirmation"in i)throw ef(e,"account-exists-with-different-credential",i);if(s.ok&&!("errorMessage"in i))return i;{const t=s.ok?i.errorMessage:i.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw ef(e,"credential-already-in-use",i);if("EMAIL_EXISTS"===n)throw ef(e,"email-already-in-use",i);if("USER_DISABLED"===n)throw ef(e,"user-disabled",i);const a=r[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(e,t,n){const r=Object.assign(Object.assign({},Rd()),{[t]:n});return new m("auth","Firebase",r).create(t,{appName:e.name})}(e,a,o);Pd(e,a)}}catch(t){if(t instanceof g)throw t;Pd(e,"network-request-failed",{message:String(t)})}}async function Jd(e,t,n,r,s={}){const i=await Wd(e,t,n,r,s);return"mfaPendingCredential"in i&&Pd(e,"multi-factor-auth-required",{_serverResponse:i}),i}function Xd(e,t,n,r){const s=`${t}${n}?${r}`;return e.config.emulator?$d(e.config,s):`${e.config.apiScheme}://${s}`}function Yd(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Zd{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(Ld(this.auth,"network-request-failed"))),Hd.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function ef(e,t,n){const r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Ld(e,t,r);return s.customData._tokenResponse=n,s}function tf(e){return void 0!==e&&void 0!==e.enterprise}class nf{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Yd(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}}function rf(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function sf(e){return 1e3*Number(e)}function of(e){const[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return Od("JWT malformed, contained fewer than 3 sections"),null;try{const e=i(n);return e?JSON.parse(e):(Od("Failed to decode base64 JWT payload"),null)}catch(e){return Od("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}async function af(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof g&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class cf{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class uf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=rf(this.lastLoginAt),this.creationTime=rf(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function hf(e){var t;const n=e.auth,r=await e.getIdToken(),s=await af(e,async function(e,t){return Wd(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:r}));Md(null==s?void 0:s.users.length,n,"internal-error");const i=s.users[0];e._notifyReloadListener(i);const o=(null===(t=i.providerUserInfo)||void 0===t?void 0:t.length)?i.providerUserInfo.map((e=>{var{providerId:t}=e,n=kd(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,u=o,[...c.filter((e=>!u.some((t=>t.providerId===e.providerId)))),...u]);var c,u;const h=e.isAnonymous,l=!(e.email&&i.passwordHash||(null==a?void 0:a.length)),d=!!h&&l,f={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new uf(i.createdAt,i.lastLoginAt),isAnonymous:d};Object.assign(e,f)}class lf{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Md(e.idToken,"internal-error"),Md(void 0!==e.idToken,"internal-error"),Md(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=of(e);return Md(t,"internal-error"),Md(void 0!==t.exp,"internal-error"),Md(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return Md(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:r,expiresIn:s}=await async function(e,t){const n=await Qd(e,{},(async()=>{const n=_({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:s}=e.config,i=Xd(e,r,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",zd.fetch()(i,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,r,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:r,expirationTime:s}=t,i=new lf;return n&&(Md("string"==typeof n,"internal-error",{appName:e}),i.refreshToken=n),r&&(Md("string"==typeof r,"internal-error",{appName:e}),i.accessToken=r),s&&(Md("number"==typeof s,"internal-error",{appName:e}),i.expirationTime=s),i}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new lf,this.toJSON())}_performRefresh(){return Ud("not implemented")}}function df(e,t){Md("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ff{constructor(e){var{uid:t,auth:n,stsTokenManager:r}=e,s=kd(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new cf(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new uf(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await af(this,this.stsTokenManager.getToken(this.auth,e));return Md(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=S(e),r=await n.getIdToken(t),s=of(r);Md(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i="object"==typeof s.firebase?s.firebase:void 0,o=null==i?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:rf(sf(s.auth_time)),issuedAtTime:rf(sf(s.iat)),expirationTime:rf(sf(s.exp)),signInProvider:o||null,signInSecondFactor:(null==i?void 0:i.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=S(e);await hf(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(Md(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ff(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Md(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await hf(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await af(this,async function(e,t){return Wd(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,r,s,i,o,a,c,u;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,l=null!==(r=t.email)&&void 0!==r?r:void 0,d=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,f=null!==(i=t.photoURL)&&void 0!==i?i:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,g=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,y=null!==(u=t.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:_,providerData:E,stsTokenManager:b}=t;Md(v&&b,e,"internal-error");const T=lf.fromJSON(this.name,b);Md("string"==typeof v,e,"internal-error"),df(h,e.name),df(l,e.name),Md("boolean"==typeof w,e,"internal-error"),Md("boolean"==typeof _,e,"internal-error"),df(d,e.name),df(f,e.name),df(p,e.name),df(g,e.name),df(m,e.name),df(y,e.name);const I=new ff({uid:v,auth:e,email:l,emailVerified:w,displayName:h,isAnonymous:_,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:T,createdAt:m,lastLoginAt:y});return E&&Array.isArray(E)&&(I.providerData=E.map((e=>Object.assign({},e)))),g&&(I._redirectEventId=g),I}static async _fromIdTokenResponse(e,t,n=!1){const r=new lf;r.updateFromServerResponse(t);const s=new ff({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await hf(s),s}}const pf=new Map;function gf(e){Fd(e instanceof Function,"Expected a class definition");let t=pf.get(e);return t?(Fd(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,pf.set(e,t),t)}class mf{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}mf.type="NONE";const yf=mf;function vf(e,t,n){return`firebase:${e}:${t}:${n}`}class wf{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:s}=this.auth;this.fullUserKey=vf(this.userKey,r.apiKey,s),this.fullPersistenceKey=vf("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ff._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new wf(gf(yf),e,n);const r=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let s=r[0]||gf(yf);const i=vf(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(i);if(t){const r=ff._fromJSON(e,t);n!==s&&(o=r),s=n;break}}catch(e){}const a=r.filter((e=>e._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(i,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==s)try{await e._remove(i)}catch(e){}}))),new wf(s,e,n)):new wf(s,e,n)}}function _f(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(If(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Ef(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Cf(t))return"Blackberry";if(Af(t))return"Webos";if(bf(t))return"Safari";if((t.includes("chrome/")||Tf(t))&&!t.includes("edge/"))return"Chrome";if(Sf(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Ef(e=f()){return/firefox\//i.test(e)}function bf(e=f()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Tf(e=f()){return/crios\//i.test(e)}function If(e=f()){return/iemobile/i.test(e)}function Sf(e=f()){return/android/i.test(e)}function Cf(e=f()){return/blackberry/i.test(e)}function Af(e=f()){return/webos/i.test(e)}function kf(e=f()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function Rf(e=f()){return kf(e)||Sf(e)||Af(e)||Cf(e)||/windows phone/i.test(e)||If(e)}function Nf(e,t=[]){let n;switch(e){case"Browser":n=_f(f());break;case"Worker":n=`${_f(f())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${pe}/${r}`}class Df{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,r)=>{try{n(e(t))}catch(e){r(e)}}));n.onAbort=t,this.queue.push(n);const r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class Of{constructor(e){var t,n,r,s;const i=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=i.minPasswordLength)&&void 0!==t?t:6,i.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=i.maxPasswordLength),void 0!==i.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=i.containsLowercaseCharacter),void 0!==i.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=i.containsUppercaseCharacter),void 0!==i.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=i.containsNumericCharacter),void 0!==i.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=i.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(r=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==r?r:"",this.forceUpgradeOnSignin=null!==(s=e.forceUpgradeOnSignin)&&void 0!==s&&s,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,r,s,i,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(r=a.containsLowercaseLetter)||void 0===r||r),a.isValid&&(a.isValid=null===(s=a.containsUppercaseLetter)||void 0===s||s),a.isValid&&(a.isValid=null===(i=a.containsNumericCharacter)||void 0===i||i),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class Pf{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new xf(this),this.idTokenSubscription=new xf(this),this.beforeStateQueue=new Df(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Nd,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=gf(t)),this._initializationPromise=this.queue((async()=>{var n,r;if(!this._deleted&&(this.persistenceManager=await wf.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(r=this.currentUser)||void 0===r?void 0:r.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null==r?void 0:r._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==i||!(null==o?void 0:o.user)||(r=o.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Md(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await hf(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?S(e):null;return t&&Md(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Md(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(gf(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return Wd(e,"GET","/v2/passwordPolicy",Gd(e,t))}(this),t=new Of(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new m("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return Wd(e,"POST","/v2/accounts:revokeToken",Gd(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&gf(e)||this._popupRedirectResolver;Md(t,this,"argument-error"),this.redirectPersistenceManager=await wf.create(this,[gf(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t);let i=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Md(o,this,"internal-error"),o.then((()=>{i||s(this.currentUser)})),"function"==typeof t){const s=e.addObserver(t,n,r);return()=>{i=!0,s()}}{const n=e.addObserver(t);return()=>{i=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Md(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Nf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t}async _getAppCheckToken(){var e;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){Dd.logLevel<=D.WARN&&Dd.warn(`Auth (${pe}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function Lf(e){return S(e)}class xf{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new T(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return Md(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Mf={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Uf(e){return Mf.loadJS(e)}function Ff(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Vf{constructor(e){this.type="recaptcha-enterprise",this.auth=Lf(e)}async verify(e="verify",t=!1){function n(t,n,r){const s=window.grecaptcha;tf(s)?s.enterprise.ready((()=>{s.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n("NO_RECAPTCHA")}))})):r(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((e,r)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{(async function(e,t){return Wd(e,"GET","/v2/recaptchaConfig",Gd(e,t))})(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((r=>{if(void 0!==r.recaptchaKey){const n=new nf(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((s=>{if(!t&&tf(window.grecaptcha))n(s,e,r);else{if("undefined"==typeof window)return void r(new Error("RecaptchaVerifier is only supported in browser"));let t=Mf.recaptchaEnterpriseScript;0!==t.length&&(t+=s),Uf(t).then((()=>{n(s,e,r)})).catch((e=>{r(e)}))}})).catch((e=>{r(e)}))}))}}async function Bf(e,t,n,r=!1){const s=new Vf(e);let i;try{i=await s.verify(n)}catch(e){i=await s.verify(n,!0)}const o=Object.assign({},t);return r?Object.assign(o,{captchaResp:i}):Object.assign(o,{captchaResponse:i}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function jf(e,t,n,r){var s;if(null===(s=e._getRecaptchaConfig())||void 0===s?void 0:s.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Bf(e,t,n,"getOobCode"===n);return r(e,s)}return r(e,t).catch((async s=>{if("auth/missing-recaptcha-token"===s.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await Bf(e,t,n,"getOobCode"===n);return r(e,s)}return Promise.reject(s)}))}function qf(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function $f(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class zf{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ud("not implemented")}_getIdTokenResponse(e){return Ud("not implemented")}_linkToIdToken(e,t){return Ud("not implemented")}_getReauthenticationResolver(e){return Ud("not implemented")}}async function Kf(e,t){return Wd(e,"POST","/v1/accounts:signUp",t)}async function Hf(e,t){return Jd(e,"POST","/v1/accounts:signInWithPassword",Gd(e,t))}class Gf extends zf{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new Gf(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Gf(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return jf(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",Hf);case"emailLink":return async function(e,t){return Jd(e,"POST","/v1/accounts:signInWithEmailLink",Gd(e,t))}(e,{email:this._email,oobCode:this._password});default:Pd(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return jf(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Kf);case"emailLink":return async function(e,t){return Jd(e,"POST","/v1/accounts:signInWithEmailLink",Gd(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:Pd(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Wf(e,t){return Jd(e,"POST","/v1/accounts:signInWithIdp",Gd(e,t))}class Qf extends zf{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Qf(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Pd("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:r}=t,s=kd(t,["providerId","signInMethod"]);if(!n||!r)return null;const i=new Qf(n,r);return i.idToken=s.idToken||void 0,i.accessToken=s.accessToken||void 0,i.secret=s.secret,i.nonce=s.nonce,i.pendingToken=s.pendingToken||null,i}_getIdTokenResponse(e){return Wf(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Wf(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Wf(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=_(t)}return e}}const Jf={USER_NOT_FOUND:"user-not-found"};class Xf extends zf{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Xf({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Xf({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return Jd(e,"POST","/v1/accounts:signInWithPhoneNumber",Gd(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await Jd(e,"POST","/v1/accounts:signInWithPhoneNumber",Gd(e,t));if(n.temporaryProof)throw ef(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return Jd(e,"POST","/v1/accounts:signInWithPhoneNumber",Gd(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Jf)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}=e;return n||t||r||s?new Xf({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:s}):null}}class Yf{constructor(e){var t,n,r,s,i,o;const a=E(b(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(r=a.mode)&&void 0!==r?r:null);Md(c&&u&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=u,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(i=a.languageCode)&&void 0!==i?i:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=E(b(e)).link,n=t?E(b(t)).deep_link_id:null,r=E(b(e)).deep_link_id;return(r?E(b(r)).link:null)||r||n||t||e}(e);try{return new Yf(t)}catch(e){return null}}}class Zf{constructor(){this.providerId=Zf.PROVIDER_ID}static credential(e,t){return Gf._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=Yf.parseLink(t);return Md(n,"argument-error"),Gf._fromEmailAndCode(e,n.code,n.tenantId)}}Zf.PROVIDER_ID="password",Zf.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Zf.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class ep{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class tp extends ep{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class np extends tp{constructor(){super("facebook.com")}static credential(e){return Qf._fromParams({providerId:np.PROVIDER_ID,signInMethod:np.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return np.credentialFromTaggedObject(e)}static credentialFromError(e){return np.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return np.credential(e.oauthAccessToken)}catch(e){return null}}}np.FACEBOOK_SIGN_IN_METHOD="facebook.com",np.PROVIDER_ID="facebook.com";class rp extends tp{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Qf._fromParams({providerId:rp.PROVIDER_ID,signInMethod:rp.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return rp.credentialFromTaggedObject(e)}static credentialFromError(e){return rp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return rp.credential(t,n)}catch(e){return null}}}rp.GOOGLE_SIGN_IN_METHOD="google.com",rp.PROVIDER_ID="google.com";class sp extends tp{constructor(){super("github.com")}static credential(e){return Qf._fromParams({providerId:sp.PROVIDER_ID,signInMethod:sp.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return sp.credentialFromTaggedObject(e)}static credentialFromError(e){return sp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return sp.credential(e.oauthAccessToken)}catch(e){return null}}}sp.GITHUB_SIGN_IN_METHOD="github.com",sp.PROVIDER_ID="github.com";class ip extends tp{constructor(){super("twitter.com")}static credential(e,t){return Qf._fromParams({providerId:ip.PROVIDER_ID,signInMethod:ip.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ip.credentialFromTaggedObject(e)}static credentialFromError(e){return ip.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ip.credential(t,n)}catch(e){return null}}}async function op(e,t){return Jd(e,"POST","/v1/accounts:signUp",Gd(e,t))}ip.TWITTER_SIGN_IN_METHOD="twitter.com",ip.PROVIDER_ID="twitter.com";class ap{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){const s=await ff._fromIdTokenResponse(e,n,r),i=cp(n);return new ap({user:s,providerId:i,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const r=cp(n);return new ap({user:e,providerId:r,_tokenResponse:n,operationType:t})}}function cp(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class up extends g{constructor(e,t,n,r){var s;super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,up.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new up(e,t,n,r)}}function hp(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw up._fromErrorAndOperation(e,n,t,r);throw n}))}async function lp(e,t,n=!1){const r="signIn",s=await hp(e,r,t),i=await ap._fromIdTokenResponse(e,r,s);return n||await e._updateCurrentUser(i.user),i}async function dp(e){const t=Lf(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}new WeakMap;const fp="__sak";class pp{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(fp,"1"),this.storage.removeItem(fp),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class gp extends pp{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=f();return bf(e)||kf(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=Rf(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const r=this.storage.getItem(n);if(e.newValue!==r)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const r=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);!function(){const e=f();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||s===e.newValue||e.newValue===e.oldValue?r():setTimeout(r,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}gp.type="LOCAL";const mp=gp;class yp extends pp{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}yp.type="SESSION";const vp=yp;class wp{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new wp(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:r,data:s}=t.data,i=this.handlersMap[r];if(!(null==i?void 0:i.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:r});const o=Array.from(i).map((async e=>e(t.origin,s))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:r,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function _p(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}wp.receivers=[];class Ep{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const r="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!r)throw new Error("connection_unavailable");let s,i;return new Promise(((o,a)=>{const c=_p("",20);r.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);i={messageChannel:r,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(u),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(u),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(i),r.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[r.port2])})).finally((()=>{i&&this.removeMessageHandler(i)}))}}function bp(){return window}function Tp(){return void 0!==bp().WorkerGlobalScope&&"function"==typeof bp().importScripts}const Ip="firebaseLocalStorageDb",Sp="firebaseLocalStorage",Cp="fbase_key";class Ap{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function kp(e,t){return e.transaction([Sp],t?"readwrite":"readonly").objectStore(Sp)}function Rp(){const e=indexedDB.open(Ip,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Sp,{keyPath:Cp})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Sp)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Ip);return new Ap(e).toPromise()}(),t(await Rp()))}))}))}async function Np(e,t,n){const r=kp(e,!0).put({[Cp]:t,value:n});return new Ap(r).toPromise()}function Dp(e,t){const n=kp(e,!0).delete(t);return new Ap(n).toPromise()}class Op{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Rp()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Tp()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=wp._getInstance(Tp()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Ep(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Rp();return await Np(e,fp,"1"),await Dp(e,fp),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Np(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=kp(e,!1).get(t),r=await new Ap(n).toPromise();return void 0===r?null:r.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Dp(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=kp(e,!1).getAll();return new Ap(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:r,value:s}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(s)&&(this.notifyListeners(r,s),t.push(r));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Op.type="LOCAL";const Pp=Op;Ff("rcb"),new qd(3e4,6e4);class Lp{constructor(e){this.providerId=Lp.PROVIDER_ID,this.auth=Lf(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var r;const s=await n.verify();try{let i;if(Md("string"==typeof s,e,"argument-error"),Md("recaptcha"===n.type,e,"argument-error"),i="string"==typeof t?{phoneNumber:t}:t,"session"in i){const t=i.session;if("phoneNumber"in i){Md("enroll"===t.type,e,"internal-error");const n=await function(e,t){return Wd(e,"POST","/v2/accounts/mfaEnrollment:start",Gd(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,recaptchaToken:s}});return n.phoneSessionInfo.sessionInfo}{Md("signin"===t.type,e,"internal-error");const n=(null===(r=i.multiFactorHint)||void 0===r?void 0:r.uid)||i.multiFactorUid;Md(n,e,"missing-multi-factor-info");const o=await function(e,t){return Wd(e,"POST","/v2/accounts/mfaSignIn:start",Gd(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return Wd(e,"POST","/v1/accounts:sendVerificationCode",Gd(e,t))}(e,{phoneNumber:i.phoneNumber,recaptchaToken:s});return t}}finally{n._reset()}}(this.auth,e,S(t))}static credential(e,t){return Xf._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Lp.credentialFromTaggedObject(t)}static credentialFromError(e){return Lp.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?Xf._fromTokenResponse(t,n):null}}Lp.PROVIDER_ID="phone",Lp.PHONE_SIGN_IN_METHOD="phone";class xp extends zf{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Wf(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Wf(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Wf(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Mp(e){return lp(e.auth,new xp(e),e.bypassAuthState)}function Up(e){const{auth:t,user:n}=e;return Md(n,t,"internal-error"),async function(e,t,n=!1){const{auth:r}=e,s="reauthenticate";try{const i=await af(e,hp(r,s,t,e),n);Md(i.idToken,r,"internal-error");const o=of(i.idToken);Md(o,r,"internal-error");const{sub:a}=o;return Md(e.uid===a,r,"user-mismatch"),ap._forOperation(e,s,i)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&Pd(r,"user-mismatch"),e}}(n,new xp(e),e.bypassAuthState)}async function Fp(e){const{auth:t,user:n}=e;return Md(n,t,"internal-error"),async function(e,t,n=!1){const r=await af(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return ap._forOperation(e,"link",r)}(n,new xp(e),e.bypassAuthState)}class Vp{constructor(e,t,n,r,s=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:r,tenantId:s,error:i,type:o}=e;if(i)return void this.reject(i);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Mp;case"linkViaPopup":case"linkViaRedirect":return Fp;case"reauthViaPopup":case"reauthViaRedirect":return Up;default:Pd(this.auth,"internal-error")}}resolve(e){Fd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Fd(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Bp=new qd(2e3,1e4);class jp extends Vp{constructor(e,t,n,r,s){super(e,t,r,s),this.provider=n,this.authWindow=null,this.pollId=null,jp.currentPopupAction&&jp.currentPopupAction.cancel(),jp.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Md(e,this.auth,"internal-error"),e}async onExecution(){Fd(1===this.filter.length,"Popup operations only handle one event");const e=_p();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(Ld(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(Ld(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,jp.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(Ld(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Bp.get())};e()}}jp.currentPopupAction=null;const qp="pendingRedirect",$p=new Map;class zp extends Vp{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=$p.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return vf(qp,e.config.apiKey,e.name)}(t),r=function(e){return gf(e._redirectPersistence)}(e);if(!await r._isAvailable())return!1;const s="true"===await r._get(n);return await r._remove(n),s}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}$p.set(this.auth._key(),e)}return this.bypassAuthState||$p.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Kp(e,t){$p.set(e._key(),t)}async function Hp(e,t,n=!1){const r=Lf(e),s=function(e,t){return t?gf(t):(Md(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(r,t),i=new zp(r,s,n),o=await i.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class Gp{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Qp(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!Qp(e)){const r=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(Ld(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Wp(e))}saveEventToCache(e){this.cachedEventUids.add(Wp(e)),this.lastProcessedEventTime=Date.now()}}function Wp(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function Qp({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const Jp=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Xp=/^https?/;function Yp(e){const t=Vd(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===r}if(!Xp.test(n))return!1;if(Jp.test(e))return r===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const Zp=new qd(3e4,6e4);function eg(){const e=bp().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function tg(e){return new Promise(((t,n)=>{var r,s,i;function o(){eg(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{eg(),n(Ld(e,"network-request-failed"))},timeout:Zp.get()})}if(null===(s=null===(r=bp().gapi)||void 0===r?void 0:r.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(i=bp().gapi)||void 0===i?void 0:i.load)){const t=Ff("iframefcb");return bp()[t]=()=>{gapi.load?o():n(Ld(e,"network-request-failed"))},Uf(`${Mf.gapiScript}?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw ng=null,e}))}let ng=null;const rg=new qd(5e3,15e3),sg="__/auth/iframe",ig="emulator/auth/iframe",og={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ag=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function cg(e){const t=e.config;Md(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?$d(t,ig):`https://${e.config.authDomain}/${sg}`,r={apiKey:t.apiKey,appName:e.name,v:pe},s=ag.get(e.config.apiHost);s&&(r.eid=s);const i=e._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${_(r).slice(1)}`}const ug={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class hg{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const lg=encodeURIComponent("fac");async function dg(e,t,n,r,s,i){Md(e.config.authDomain,e,"auth-domain-config-required"),Md(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:pe,eventId:s};if(t instanceof ep){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(i||{}))o[e]=t}if(t instanceof tp){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];const c=await e._getAppCheckToken(),u=c?`#${lg}=${encodeURIComponent(c)}`:"";return`${function({config:e}){return e.emulator?$d(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${_(a).slice(1)}${u}`}const fg="webStorageSupport",pg=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=vp,this._completeRedirectFn=Hp,this._overrideRedirectResult=Kp}async _openPopup(e,t,n,r){var s;return Fd(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(e,t,n,r=500,s=600){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},ug),{width:r.toString(),height:s.toString(),top:i,left:o}),u=f().toLowerCase();n&&(a=Tf(u)?"_blank":n),Ef(u)&&(t=t||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=f()){var t;return kf(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}(t||"",a),new hg(null);const l=window.open(t||"",a,h);Md(l,e,"popup-blocked");try{l.focus()}catch(e){}return new hg(l)}(e,await dg(e,t,n,Vd(),r),_p())}async _openRedirect(e,t,n,r){return await this._originValidation(e),s=await dg(e,t,n,Vd(),r),bp().location.href=s,new Promise((()=>{}));var s}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(Fd(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return ng=ng||tg(e),ng}(e),n=bp().gapi;return Md(n,e,"internal-error"),t.open({where:document.body,url:cg(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:og,dontclear:!0},(t=>new Promise((async(n,r)=>{await t.restyle({setHideOnLeave:!1});const s=Ld(e,"network-request-failed"),i=bp().setTimeout((()=>{r(s)}),rg.get());function o(){bp().clearTimeout(i),n(t)}t.ping(o).then(o,(()=>{r(s)}))}))))}(e),n=new Gp(e);return t.register("authEvent",(t=>(Md(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(fg,{type:fg},(n=>{var r;const s=null===(r=null==n?void 0:n[0])||void 0===r?void 0:r[fg];void 0!==s&&t(!!s),Pd(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return Wd(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Yp(e))return}catch(e){}Pd(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Rf()||bf()||kf()}};var gg="@firebase/auth",mg="1.6.2";class yg{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Md(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const vg=h("authIdTokenMaxAge")||300;let wg=null;var _g;!function(e){Mf=e}({loadJS:e=>new Promise(((t,n)=>{const r=document.createElement("script");var s,i;r.setAttribute("src",e),r.onload=t,r.onerror=e=>{const t=Ld("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(null!==(i=null===(s=document.getElementsByTagName("head"))||void 0===s?void 0:s[0])&&void 0!==i?i:document).appendChild(r)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="}),_g="Browser",he(new C("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:i,authDomain:o}=n.options;Md(i&&!i.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:i,authDomain:o,clientPlatform:_g,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Nf(_g)},c=new Pf(n,r,s,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],r=(Array.isArray(n)?n:[n]).map(gf);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(r,null==t?void 0:t.popupRedirectResolver)}(c,t),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),he(new C("auth-internal",(e=>(e=>new yg(e))(Lf(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),ye(gg,mg,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(_g)),ye(gg,mg,"esm2017");const Eg="firebasestorage.googleapis.com",bg="storageBucket";class Tg extends g{constructor(e,t,n=0){super(Cg(e),`Firebase Storage: ${t} (${Cg(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Tg.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Cg(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}\n${this.customData.serverResponse}`:this.message=this._baseMessage}}var Ig,Sg;function Cg(e){return"storage/"+e}function Ag(){return new Tg(Ig.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function kg(e){return new Tg(Ig.INVALID_ARGUMENT,e)}function Rg(){return new Tg(Ig.APP_DELETED,"The Firebase app was deleted.")}function Ng(e,t){return new Tg(Ig.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function Dg(e){throw new Tg(Ig.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(Ig||(Ig={}));class Og{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=Og.makeFromUrl(e,t)}catch(t){return new Og(e,"")}if(""===n.path)return n;throw r=e,new Tg(Ig.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+r+"'.");var r}static makeFromUrl(e,t){let n=null;const r="([A-Za-z0-9.\\-_]+)",s=new RegExp("^gs://"+r+"(/(.*))?$","i");function i(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:s,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),indices:{bucket:1,path:3},postModify:i},{regex:new RegExp(`^https?://${t===Eg?"(?:storage.googleapis.com|storage.cloud.google.com)":t}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:i}];for(let t=0;t<a.length;t++){const r=a[t],s=r.regex.exec(e);if(s){const e=s[r.indices.bucket];let t=s[r.indices.path];t||(t=""),n=new Og(e,t),r.postModify(n);break}}if(null==n)throw function(e){return new Tg(Ig.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return n}}class Pg{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function Lg(e){return"string"==typeof e||e instanceof String}function xg(e){return Mg()&&e instanceof Blob}function Mg(){return"undefined"!=typeof Blob}function Ug(e,t,n,r){if(r<t)throw kg(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw kg(`Invalid value for '${e}'. Expected ${n} or less.`)}function Fg(e,t,n){let r=t;return null==n&&(r=`https://${t}`),`${n}://${r}/v0${e}`}function Vg(e){const t=encodeURIComponent;let n="?";for(const r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n=n.slice(0,-1),n}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(Sg||(Sg={}));class Bg{constructor(e,t,n,r,s,i,o,a,c,u,h,l=!0){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=s,this.additionalRetryCodes_=i,this.callback_=o,this.errorCallback_=a,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.retry=l,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise(((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()}))}start_(){const e=(e,t)=>{const n=this.resolve_,r=this.reject_,s=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(s,s.getResponse());!function(e){return void 0!==e}(e)?n():n(e)}catch(e){r(e)}else if(null!==s){const e=Ag();e.serverResponse=s.getErrorText(),this.errorCallback_?r(this.errorCallback_(s,e)):r(e)}else t.canceled?r(this.appDelete_?Rg():new Tg(Ig.CANCELED,"User canceled the upload/download.")):r(new Tg(Ig.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?e(0,new jg(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,s=null,i=null,o=!1,a=0;function c(){return 2===a}let u=!1;function h(...e){u||(u=!0,t.apply(null,e))}function l(t){s=setTimeout((()=>{s=null,e(f,c())}),t)}function d(){i&&clearTimeout(i)}function f(e,...t){if(u)return void d();if(e)return d(),void h.call(null,e,...t);if(c()||o)return d(),void h.call(null,e,...t);let n;r<64&&(r*=2),1===a?(a=2,n=0):n=1e3*(r+Math.random()),l(n)}let p=!1;function g(e){p||(p=!0,d(),u||(null!==s?(e||(a=2),clearTimeout(s),l(0)):e||(a=1)))}return l(0),i=setTimeout((()=>{o=!0,g(!0)}),n),g}(((e,t)=>{if(t)return void e(!1,new jg(!1,null,!0));const n=this.connectionFactory_();this.pendingConnection_=n;const r=e=>{const t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.body_,this.headers_).then((()=>{null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;const t=n.getErrorCode()===Sg.NO_ERROR,s=n.getStatus();if(!t||function(e,t){const n=e>=500&&e<600,r=-1!==[408,429].indexOf(e),s=-1!==t.indexOf(e);return n||r||s}(s,this.additionalRetryCodes_)&&this.retry){const t=n.getErrorCode()===Sg.ABORT;return void e(!1,new jg(!1,null,t))}const i=-1!==this.successCodes_.indexOf(s);e(!0,new jg(i,n))}))}),e,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&function(e){e(!1)}(this.backoffId_),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class jg{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}function qg(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function $g(...e){const t=qg();if(void 0!==t){const n=new t;for(let t=0;t<e.length;t++)n.append(e[t]);return n.getBlob()}if(Mg())return new Blob(e);throw new Tg(Ig.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}const zg={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Kg{constructor(e,t){this.data=e,this.contentType=t||null}}function Hg(e){const t=[];for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<=127?t.push(r):r<=2047?t.push(192|r>>6,128|63&r):55296==(64512&r)?n<e.length-1&&56320==(64512&e.charCodeAt(n+1))?(r=65536|(1023&r)<<10|1023&e.charCodeAt(++n),t.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r)):t.push(239,191,189):56320==(64512&r)?t.push(239,191,189):t.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(t)}function Gg(e,t){switch(e){case zg.BASE64:{const n=-1!==t.indexOf("-"),r=-1!==t.indexOf("_");if(n||r)throw Ng(e,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break}case zg.BASE64URL:{const n=-1!==t.indexOf("+"),r=-1!==t.indexOf("/");if(n||r)throw Ng(e,"Invalid character '"+(n?"+":"/")+"' found: is it base64 encoded?");t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=function(e){if("undefined"==typeof atob)throw new Tg(Ig.UNSUPPORTED_ENVIRONMENT,"base-64 is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.");return atob(e)}(t)}catch(t){if(t.message.includes("polyfill"))throw t;throw Ng(e,"Invalid character found")}const r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);return r}class Wg{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw Ng(zg.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const n=t[1]||null;var r,s;null!=n&&(this.base64=(s=";base64",(r=n).length>=7&&r.substring(r.length-7)===s),this.contentType=this.base64?n.substring(0,n.length-7):n),this.rest=e.substring(e.indexOf(",")+1)}}class Qg{constructor(e,t){let n=0,r="";xg(e)?(this.data_=e,n=e.size,r=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),n=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),n=e.length),this.size_=n,this.type_=r}size(){return this.size_}type(){return this.type_}slice(e,t){if(xg(this.data_)){const i=(n=this.data_,r=e,s=t,n.webkitSlice?n.webkitSlice(r,s):n.mozSlice?n.mozSlice(r,s):n.slice?n.slice(r,s):null);return null===i?null:new Qg(i)}var n,r,s;{const n=new Uint8Array(this.data_.buffer,e,t-e);return new Qg(n,!0)}}static getBlob(...e){if(Mg()){const t=e.map((e=>e instanceof Qg?e.data_:e));return new Qg($g.apply(null,t))}{const t=e.map((e=>Lg(e)?function(e,t){switch(e){case zg.RAW:return new Kg(Hg(t));case zg.BASE64:case zg.BASE64URL:return new Kg(Gg(e,t));case zg.DATA_URL:return new Kg(function(e){const t=new Wg(e);return t.base64?Gg(zg.BASE64,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(e){throw Ng(zg.DATA_URL,"Malformed data URL.")}return Hg(t)}(t.rest)}(t),new Wg(t).contentType)}throw Ag()}(zg.RAW,e).data:e.data_));let n=0;t.forEach((e=>{n+=e.byteLength}));const r=new Uint8Array(n);let s=0;return t.forEach((e=>{for(let t=0;t<e.length;t++)r[s++]=e[t]})),new Qg(r,!0)}}uploadData(){return this.data_}}function Jg(e){let t;try{t=JSON.parse(e)}catch(e){return null}return function(e){return"object"==typeof e&&!Array.isArray(e)}(t)?t:null}function Xg(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Yg(e,t){return t}class Zg{constructor(e,t,n,r){this.server=e,this.local=t||e,this.writable=!!n,this.xform=r||Yg}}let em=null;function tm(){if(em)return em;const e=[];e.push(new Zg("bucket")),e.push(new Zg("generation")),e.push(new Zg("metageneration")),e.push(new Zg("name","fullPath",!0));const t=new Zg("name");t.xform=function(e,t){return function(e){return!Lg(e)||e.length<2?e:Xg(e)}(t)},e.push(t);const n=new Zg("size");return n.xform=function(e,t){return void 0!==t?Number(t):t},e.push(n),e.push(new Zg("timeCreated")),e.push(new Zg("updated")),e.push(new Zg("md5Hash",null,!0)),e.push(new Zg("cacheControl",null,!0)),e.push(new Zg("contentDisposition",null,!0)),e.push(new Zg("contentEncoding",null,!0)),e.push(new Zg("contentLanguage",null,!0)),e.push(new Zg("contentType",null,!0)),e.push(new Zg("metadata","customMetadata",!0)),em=e,em}function nm(e,t,n){const r=Jg(t);return null===r?null:function(e,t,n){const r={type:"file"},s=n.length;for(let e=0;e<s;e++){const s=n[e];r[s.local]=s.xform(r,t[s.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const n=e.bucket,r=e.fullPath,s=new Og(n,r);return t._makeStorageReference(s)}})}(r,e),r}(e,r,n)}class rm{constructor(e,t,n,r){this.url=e,this.method=t,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function sm(e){if(!e)throw Ag()}function im(e){return function(t,n){let r;var s,i;return 401===t.getStatus()?r=t.getErrorText().includes("Firebase App Check token is invalid")?new Tg(Ig.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new Tg(Ig.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(i=e.bucket,r=new Tg(Ig.QUOTA_EXCEEDED,"Quota for bucket '"+i+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(s=e.path,r=new Tg(Ig.UNAUTHORIZED,"User does not have permission to access '"+s+"'.")):r=n,r.status=t.getStatus(),r.serverResponse=n.serverResponse,r}}function om(e,t,n,r,s){const i=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"},a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const c=function(e,t,n){const r=Object.assign({},n);return r.fullPath=e.path,r.size=t.size(),r.contentType||(r.contentType=function(e,t){return t&&t.type()||"application/octet-stream"}(0,t)),r}(t,r,s),u="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+function(e,t){const n={},r=t.length;for(let s=0;s<r;s++){const r=t[s];r.writable&&(n[r.server]=e[r.local])}return JSON.stringify(n)}(c,n)+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",h="\r\n--"+a+"--",l=Qg.getBlob(u,r,h);if(null===l)throw new Tg(Ig.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.");const d={name:c.fullPath},f=Fg(i,e.host,e._protocol),p=e.maxUploadRetryTime,g=new rm(f,"POST",function(e,t){return function(n,r){const s=nm(e,r,t);return sm(null!==s),s}}(e,n),p);return g.urlParams=d,g.headers=o,g.body=l.uploadData(),g.errorHandler=im(t),g}let am=null;class cm{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Sg.NO_ERROR,this.sendPromise_=new Promise((e=>{this.xhr_.addEventListener("abort",(()=>{this.errorCode_=Sg.ABORT,e()})),this.xhr_.addEventListener("error",(()=>{this.errorCode_=Sg.NETWORK_ERROR,e()})),this.xhr_.addEventListener("load",(()=>{e()}))}))}send(e,t,n,r){if(this.sent_)throw Dg("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==r)for(const e in r)r.hasOwnProperty(e)&&this.xhr_.setRequestHeader(e,r[e].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Dg("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Dg("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw Dg("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Dg("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class um extends cm{initXhr(){this.xhr_.responseType="text"}}function hm(){return am?am():new um}class lm{constructor(e,t){this._service=e,this._location=t instanceof Og?t:Og.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new lm(e,t)}get root(){const e=new Og(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return Xg(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new Og(this._location.bucket,e);return new lm(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new Tg(Ig.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function dm(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,n){const r=Fg(t.fullServerUrl(),e.host,e._protocol),s=e.maxOperationRetryTime,i=new rm(r,"GET",function(e,t){return function(n,r){const s=nm(e,r,t);return sm(null!==s),function(e,t,n,r){const s=Jg(t);if(null===s)return null;if(!Lg(s.downloadTokens))return null;const i=s.downloadTokens;if(0===i.length)return null;const o=encodeURIComponent;return i.split(",").map((t=>{const s=e.bucket,i=e.fullPath;return Fg("/b/"+o(s)+"/o/"+o(i),n,r)+Vg({alt:"media",token:t})}))[0]}(s,r,e.host,e._protocol)}}(e,n),s);return i.errorHandler=function(e){const t=im(e);return function(n,r){let s=t(n,r);var i;return 404===n.getStatus()&&(i=e.path,s=new Tg(Ig.OBJECT_NOT_FOUND,"Object '"+i+"' does not exist.")),s.serverResponse=r.serverResponse,s}}(t),i}(e.storage,e._location,tm());return e.storage.makeRequestWithTokens(t,hm).then((e=>{if(null===e)throw new Tg(Ig.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e}))}function fm(e,t){if(e instanceof gm){const n=e;if(null==n._bucket)throw new Tg(Ig.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+bg+"' property when initializing the app?");const r=new lm(n,n._bucket);return null!=t?fm(r,t):r}return void 0!==t?function(e,t){const n=function(e,t){const n=t.split("/").filter((e=>e.length>0)).join("/");return 0===e.length?n:e+"/"+n}(e._location.path,t),r=new Og(e._location.bucket,n);return new lm(e.storage,r)}(e,t):e}function pm(e,t){const n=null==t?void 0:t[bg];return null==n?null:Og.makeFromBucketSpec(n,e)}class gm{constructor(e,t,n,r,s){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=s,this._bucket=null,this._host=Eg,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=r?Og.makeFromBucketSpec(r,this._host):pm(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=Og.makeFromBucketSpec(this._url,e):this._bucket=pm(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Ug("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Ug("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach((e=>e.cancel())),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new lm(this,e)}_makeRequest(e,t,n,r,s=!0){if(this._deleted)return new Pg(Rg());{const i=function(e,t,n,r,s,i,o=!0){const a=Vg(e.urlParams),c=e.url+a,u=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(u,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(u,n),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!=t?t:"AppManager")}(u,i),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(u,r),new Bg(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,s,o)}(e,this._appId,n,r,t,this._firebaseVersion,s);return this._requests.add(i),i.getPromise().then((()=>this._requests.delete(i)),(()=>this._requests.delete(i))),i}}async makeRequestWithTokens(e,t){const[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}const mm="@firebase/storage",ym="0.12.2",vm="storage";function wm(e,t){return function(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof gm)return new lm(e,t);throw kg("To use ref(service, url), the first argument must be a Storage instance.")}return fm(e,t)}(e=S(e),t)}he(new C(vm,(function(e,{instanceIdentifier:t}){const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return new gm(n,r,s,t,pe)}),"PUBLIC").setMultipleInstances(!0)),ye(mm,ym,""),ye(mm,ym,"esm2017");const _m=ge({apiKey:"AIzaSyD-HYIh8x0onCBChk1wlSDlWIeSUdaFXNM",authDomain:"dcatest-2ee5f.firebaseapp.com",projectId:"dcatest-2ee5f",storageBucket:"dcatest-2ee5f.appspot.com",messagingSenderId:"634779052994",appId:"1:634779052994:web:e23d3ec2eb58c9d2f6045b",measurementId:"G-V8GF33RZ1M"}),Em=function(e,t){const n="string"==typeof e?e:"(default)",r=le("object"==typeof e?e:me(),"firestore").getImmediate({identifier:n});if(!r._initialized){const e=c("firestore");e&&function(e,t,n,r={}){var s;const i=(e=Nl(e,Ol))._getSettings(),o=`${t}:${n}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&ei("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),e._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=Ws.MOCK_USER;else{t=d(r.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new oi(ii.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ws(i)}e._authCredentials=new hi(new ci(t,n))}}(r,...e)}return r}(_m),bm=function(e=me()){const t=le(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=le(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(v(n.getOptions(),null!=t?t:{}))return e;Pd(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:pg,persistence:[Pp,mp,vp]}),r=h("authTokenSyncURL");if(r&&r.match(/^\/[^\/].*/)){const e=(s=r,async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>vg)return;const r=null==t?void 0:t.token;wg!==r&&(wg=r,await fetch(s,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});!function(e,t,n){S(e).beforeAuthStateChanged(t,n)}(n,e,(()=>e(n.currentUser))),function(t,n,r,s){S(t).onIdTokenChanged((t=>e(t)),void 0,void 0)}(n)}var s;const i=a("auth");return i&&function(e,t,n){const r=Lf(e);Md(r._canInitEmulator,r,"emulator-config-failed"),Md(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");const s=!!(null==n?void 0:n.disableWarnings),i=qf(t),{host:o,port:a}=function(e){const t=qf(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const e=s[1];return{host:e,port:$f(r.substr(e.length+1))}}{const[e,t]=r.split(":");return{host:e,port:$f(t)}}}(t),c=null===a?"":`:${a}`;r.config.emulator={url:`${i}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${i}`),n}(_m),Tm=function(e=me(),t){const n=le(e=S(e),vm).getImmediate({identifier:t}),r=c("storage");return r&&function(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`,e._protocol="http";const{mockUserToken:s}=r;s&&(e._overrideAuthToken="string"==typeof s?s:d(s,e.app.options.projectId))}(e,t,n,r)}(n,...r),n}(),Im=e=>{(function(e,t,n){return async function(e,t){return lp(Lf(e),t)}(S(e),Zf.credential(t,n)).catch((async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&dp(e),t}))})(bm,e.email,e.password).then((async e=>{const t=e.user;console.log(t.uid)})).catch((e=>{const t=e.code,n=e.message;console.error(t,n)}))},Sm=async e=>{const t=function(e,t,...n){let r=[];t instanceof ld&&r.push(t),r=r.concat(n),function(e){const t=e.filter((e=>e instanceof pd)).length,n=e.filter((e=>e instanceof fd)).length;if(t>1||t>0&&n>0)throw new oi(ii.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const t of r)e=t._apply(e);return e}(Ml(Em,"posts"),function(e,t,n){const r=hd("where","idUser");return fd._create(r,"==",n)}(0,0,e)),n=await Cd(t),r=[];return n.forEach((e=>{const t=e.data();r.push(Object.assign({id:e.id},t))})),r},Cm=async(e,t)=>{(function(e,t,n){return function(e,t,n){e._throwIfRoot("uploadBytes");const r=om(e.storage,e._location,tm(),new Qg(t,!0),n);return e.storage.makeRequestWithTokens(r,hm).then((t=>({metadata:t,ref:e})))}(e=S(e),t,void 0)})(wm(Tm,"imgsProfile/"+t),e).then((e=>{console.log("Uploaded a blob or file!")}))},Am={email:"",password:""};class km extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}changeEmail(e){var t;Am.email=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value}changePassword(e){var t;Am.password=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value}submitForm(){Im(Am)}render(){var e,t,n,r;const s=this.ownerDocument.createElement("h1");s.innerText="Iniciar sesión",null===(e=this.shadowRoot)||void 0===e||e.appendChild(s);const i=this.ownerDocument.createElement("input");i.placeholder="Correo electronico",i.addEventListener("change",this.changeEmail),null===(t=this.shadowRoot)||void 0===t||t.appendChild(i);const o=this.ownerDocument.createElement("input");o.placeholder="Contraseña",o.addEventListener("change",this.changePassword),null===(n=this.shadowRoot)||void 0===n||n.appendChild(o);const a=this.ownerDocument.createElement("button");a.innerText="Iniciar sesión",a.addEventListener("click",this.submitForm),null===(r=this.shadowRoot)||void 0===r||r.appendChild(a)}}customElements.define("app-login",km);const Rm={email:"",password:"",age:""};class Nm extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"})}connectedCallback(){this.render()}changeEmail(e){var t;Rm.email=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value}changePassword(e){var t;Rm.password=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value}changeAge(e){var t;Rm.age=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value}submitForm(){(e=>{(async function(e,t,n){const r=Lf(e),s=jf(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",op),i=await s.catch((t=>{throw"auth/password-does-not-meet-requirements"===t.code&&dp(e),t})),o=await ap._fromIdTokenResponse(r,"signIn",i);return await r._updateCurrentUser(o.user),o})(bm,e.email,e.password).then((async t=>{const n=t.user;console.log(n.uid);try{const t=Ul(Em,"users",n.uid),r={age:e.age};await function(e,t,n){e=Nl(e,Ll);const r=Nl(e.firestore,Vl),s=wd(e.converter,t,n);return Ad(r,[Yl(Xl(r),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,Ga.none())])}(t,r),alert("Se creó el usuario")}catch(e){console.error(e)}})).catch((e=>{const t=e.code,n=e.message;console.error(t,n)}))})(Rm)}async render(){var e,t,n,r,s;const i=this.ownerDocument.createElement("h1");i.innerText="Registrarme",null===(e=this.shadowRoot)||void 0===e||e.appendChild(i);const o=this.ownerDocument.createElement("input");o.placeholder="Correo electronico",o.addEventListener("change",this.changeEmail),null===(t=this.shadowRoot)||void 0===t||t.appendChild(o);const a=this.ownerDocument.createElement("input");a.placeholder="Contraseña",a.addEventListener("change",this.changePassword),null===(n=this.shadowRoot)||void 0===n||n.appendChild(a);const c=this.ownerDocument.createElement("input");c.placeholder="Edad",c.addEventListener("change",this.changeAge),null===(r=this.shadowRoot)||void 0===r||r.appendChild(c);const u=this.ownerDocument.createElement("button");u.innerText="Registrarme",u.addEventListener("click",this.submitForm),null===(s=this.shadowRoot)||void 0===s||s.appendChild(u)}}var Dm;customElements.define("app-register",Nm),function(e){e.LOGIN="LOGIN",e.DASHBOARD="DASHBOARD",e.REGISTER="REGISTER",e.PROFILE="PROFILE"}(Dm||(Dm={}));const Om=e=>({action:"NAVIGATE",payload:e});!function(e,t,n,r){S(e).onAuthStateChanged((e=>{e?(null!==e.uid&&xm((e=>({action:"SETUSER",payload:e}))(e.uid)),xm(Om(Dm.DASHBOARD))):xm(Om(Dm.LOGIN))}),void 0,void 0)}(bm);let Pm={screen:Dm.LOGIN,posts:[],user:"",postsProfile:[]},Lm=[];const xm=e=>{const t=((e,t)=>{const{action:n,payload:r}=e;switch(n){case"NAVIGATE":t.screen=r;break;case"GETPOSTS":t.posts=r;break;case"GETPOSTSPROFILE":t.postsProfile=r;break;case"SETUSER":t.user=r}return t})(e,JSON.parse(JSON.stringify(Pm)));Pm=t,Lm.forEach((e=>e.render()))},Mm=e=>{Lm=[...Lm,e]},Um={artistName:"",price:0,idUser:""};class Fm extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),Mm(this)}async connectedCallback(){if(0===Pm.posts.length){const e=await(async()=>({action:"GETPOSTS",payload:await(async()=>{const e=await Cd(Ml(Em,"posts")),t=[];return e.forEach((e=>{const n=e.data();t.push(Object.assign({id:e.id},n))})),t})()}))();xm(e)}else this.render()}submitForm(){Um.idUser=Pm.user,(async e=>{try{const t=await function(e,t){const n=Nl(e.firestore,Vl),r=Ul(e),s=wd(e.converter,t);return Ad(n,[Yl(Xl(e.firestore),"addDoc",r._key,s,null!==e.converter,{}).toMutation(r._key,Ga.exists(!1))]).then((()=>r))}(Ml(Em,"posts"),e);console.log("Document written with ID: ",t.id)}catch(e){console.error("Error adding document: ",e)}})(Um)}goProfile(){xm(Om(Dm.PROFILE))}changeName(e){var t;Um.artistName=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value}changePrice(e){var t;Um.price=Number(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value)}render(){var e,t,n,r,s,i;const o=this.ownerDocument.createElement("h1");o.innerText="Dashboard",null===(e=this.shadowRoot)||void 0===e||e.appendChild(o);const a=this.ownerDocument.createElement("input");a.placeholder="Artist Name",a.addEventListener("change",this.changeName),null===(t=this.shadowRoot)||void 0===t||t.appendChild(a);const c=this.ownerDocument.createElement("input");c.placeholder="Price",c.addEventListener("change",this.changePrice),null===(n=this.shadowRoot)||void 0===n||n.appendChild(c);const u=this.ownerDocument.createElement("button");u.innerText="Save",u.addEventListener("click",this.submitForm),null===(r=this.shadowRoot)||void 0===r||r.appendChild(u);const h=this.ownerDocument.createElement("button");h.innerText="Go to my profile",h.addEventListener("click",this.goProfile),null===(s=this.shadowRoot)||void 0===s||s.appendChild(h);const l=this.ownerDocument.createElement("input");l.type="file",l.addEventListener("change",(()=>{var e;const t=null===(e=l.files)||void 0===e?void 0:e[0];t&&Cm(t,Pm.user)})),null===(i=this.shadowRoot)||void 0===i||i.appendChild(l),Pm.posts.forEach((e=>{var t,n;const r=this.ownerDocument.createElement("p");r.innerText=e.artistName,null===(t=this.shadowRoot)||void 0===t||t.appendChild(r);const s=this.ownerDocument.createElement("p");s.innerText=e.price,null===(n=this.shadowRoot)||void 0===n||n.appendChild(s)}))}}customElements.define("app-dashboard",Fm);class Vm extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),Mm(this)}async connectedCallback(){if(0===Pm.postsProfile.length){const e=await(async e=>({action:"GETPOSTSPROFILE",payload:await Sm(e)}))(Pm.user);xm(e)}else this.render()}async render(){var e,t;const n=this.ownerDocument.createElement("h1");n.innerText="Profile",null===(e=this.shadowRoot)||void 0===e||e.appendChild(n);const r=await(async e=>{const t=wm(Tm,"imgsProfile/"+e);return await function(e){return dm(e=S(e))}(wm(t)).then((e=>e)).catch((e=>{console.error(e)}))})(Pm.user),s=this.ownerDocument.createElement("img");s.src=String(r),null===(t=this.shadowRoot)||void 0===t||t.appendChild(s),Pm.postsProfile.forEach((e=>{var t,n;const r=this.ownerDocument.createElement("p");r.innerText=e.artistName,null===(t=this.shadowRoot)||void 0===t||t.appendChild(r);const s=this.ownerDocument.createElement("p");s.innerText=e.price,null===(n=this.shadowRoot)||void 0===n||n.appendChild(s)}))}}customElements.define("app-profile",Vm);class Bm extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),Mm(this)}connectedCallback(){this.render()}render(){var e,t,n,r;switch(this.shadowRoot&&(this.shadowRoot.innerHTML=""),Pm.screen){case Dm.DASHBOARD:const s=this.ownerDocument.createElement("app-dashboard");null===(e=this.shadowRoot)||void 0===e||e.appendChild(s);break;case Dm.LOGIN:const i=this.ownerDocument.createElement("app-login");null===(t=this.shadowRoot)||void 0===t||t.appendChild(i);break;case Dm.REGISTER:const o=this.ownerDocument.createElement("app-register");null===(n=this.shadowRoot)||void 0===n||n.appendChild(o);break;case Dm.PROFILE:const a=this.ownerDocument.createElement("app-profile");null===(r=this.shadowRoot)||void 0===r||r.appendChild(a)}}}customElements.define("app-container",Bm)})();